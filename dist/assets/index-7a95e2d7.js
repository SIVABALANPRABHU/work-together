(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function Hv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ff={exports:{}},Jo={},Nf={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ps=Symbol.for("react.element"),$v=Symbol.for("react.portal"),Gv=Symbol.for("react.fragment"),Qv=Symbol.for("react.strict_mode"),Jv=Symbol.for("react.profiler"),Yv=Symbol.for("react.provider"),Xv=Symbol.for("react.context"),Zv=Symbol.for("react.forward_ref"),ey=Symbol.for("react.suspense"),ty=Symbol.for("react.memo"),ny=Symbol.for("react.lazy"),fd=Symbol.iterator;function iy(t){return t===null||typeof t!="object"?null:(t=fd&&t[fd]||t["@@iterator"],typeof t=="function"?t:null)}var Mf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Df=Object.assign,Lf={};function lr(t,e,n){this.props=t,this.context=e,this.refs=Lf,this.updater=n||Mf}lr.prototype.isReactComponent={};lr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};lr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Af(){}Af.prototype=lr.prototype;function Gl(t,e,n){this.props=t,this.context=e,this.refs=Lf,this.updater=n||Mf}var Ql=Gl.prototype=new Af;Ql.constructor=Gl;Df(Ql,lr.prototype);Ql.isPureReactComponent=!0;var pd=Array.isArray,Uf=Object.prototype.hasOwnProperty,Jl={current:null},jf={key:!0,ref:!0,__self:!0,__source:!0};function Bf(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Uf.call(e,i)&&!jf.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:ps,type:t,key:s,ref:o,props:r,_owner:Jl.current}}function ry(t,e){return{$$typeof:ps,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Yl(t){return typeof t=="object"&&t!==null&&t.$$typeof===ps}function sy(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var md=/\/+/g;function Ca(t,e){return typeof t=="object"&&t!==null&&t.key!=null?sy(""+t.key):e.toString(36)}function Bs(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ps:case $v:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Ca(o,0):i,pd(r)?(n="",t!=null&&(n=t.replace(md,"$&/")+"/"),Bs(r,e,n,"",function(l){return l})):r!=null&&(Yl(r)&&(r=ry(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(md,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",pd(t))for(var a=0;a<t.length;a++){s=t[a];var c=i+Ca(s,a);o+=Bs(s,e,n,c,r)}else if(c=iy(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=i+Ca(s,a++),o+=Bs(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ks(t,e,n){if(t==null)return t;var i=[],r=0;return Bs(t,i,"","",function(s){return e.call(n,s,r++)}),i}function oy(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ye={current:null},Vs={transition:null},ay={ReactCurrentDispatcher:Ye,ReactCurrentBatchConfig:Vs,ReactCurrentOwner:Jl};function Vf(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:ks,forEach:function(t,e,n){ks(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ks(t,function(){e++}),e},toArray:function(t){return ks(t,function(e){return e})||[]},only:function(t){if(!Yl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=lr;G.Fragment=Gv;G.Profiler=Jv;G.PureComponent=Gl;G.StrictMode=Qv;G.Suspense=ey;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ay;G.act=Vf;G.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Df({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Jl.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Uf.call(e,c)&&!jf.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:ps,type:t.type,key:r,ref:s,props:i,_owner:o}};G.createContext=function(t){return t={$$typeof:Xv,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Yv,_context:t},t.Consumer=t};G.createElement=Bf;G.createFactory=function(t){var e=Bf.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:Zv,render:t}};G.isValidElement=Yl;G.lazy=function(t){return{$$typeof:ny,_payload:{_status:-1,_result:t},_init:oy}};G.memo=function(t,e){return{$$typeof:ty,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=Vs.transition;Vs.transition={};try{t()}finally{Vs.transition=e}};G.unstable_act=Vf;G.useCallback=function(t,e){return Ye.current.useCallback(t,e)};G.useContext=function(t){return Ye.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return Ye.current.useDeferredValue(t)};G.useEffect=function(t,e){return Ye.current.useEffect(t,e)};G.useId=function(){return Ye.current.useId()};G.useImperativeHandle=function(t,e,n){return Ye.current.useImperativeHandle(t,e,n)};G.useInsertionEffect=function(t,e){return Ye.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return Ye.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return Ye.current.useMemo(t,e)};G.useReducer=function(t,e,n){return Ye.current.useReducer(t,e,n)};G.useRef=function(t){return Ye.current.useRef(t)};G.useState=function(t){return Ye.current.useState(t)};G.useSyncExternalStore=function(t,e,n){return Ye.current.useSyncExternalStore(t,e,n)};G.useTransition=function(){return Ye.current.useTransition()};G.version="18.3.1";Nf.exports=G;var q=Nf.exports;const cy=Hv(q);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ly=q,uy=Symbol.for("react.element"),dy=Symbol.for("react.fragment"),hy=Object.prototype.hasOwnProperty,fy=ly.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,py={key:!0,ref:!0,__self:!0,__source:!0};function zf(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)hy.call(e,i)&&!py.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:uy,type:t,key:s,ref:o,props:r,_owner:fy.current}}Jo.Fragment=dy;Jo.jsx=zf;Jo.jsxs=zf;Ff.exports=Jo;var T=Ff.exports,pc={},Wf={exports:{}},gt={},qf={exports:{}},Kf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(A,W){var z=A.length;A.push(W);e:for(;0<z;){var re=z-1>>>1,he=A[re];if(0<r(he,W))A[re]=W,A[z]=he,z=re;else break e}}function n(A){return A.length===0?null:A[0]}function i(A){if(A.length===0)return null;var W=A[0],z=A.pop();if(z!==W){A[0]=z;e:for(var re=0,he=A.length,Vt=he>>>1;re<Vt;){var yt=2*(re+1)-1,Tn=A[yt],ct=yt+1,Ci=A[ct];if(0>r(Tn,z))ct<he&&0>r(Ci,Tn)?(A[re]=Ci,A[ct]=z,re=ct):(A[re]=Tn,A[yt]=z,re=yt);else if(ct<he&&0>r(Ci,z))A[re]=Ci,A[ct]=z,re=ct;else break e}}return W}function r(A,W){var z=A.sortIndex-W.sortIndex;return z!==0?z:A.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,g=!1,y=!1,k=!1,E=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function f(A){for(var W=n(l);W!==null;){if(W.callback===null)i(l);else if(W.startTime<=A)i(l),W.sortIndex=W.expirationTime,e(c,W);else break;W=n(l)}}function v(A){if(k=!1,f(A),!y)if(n(c)!==null)y=!0,Cn(C);else{var W=n(l);W!==null&&nn(v,W.startTime-A)}}function C(A,W){y=!1,k&&(k=!1,p(_),_=-1),g=!0;var z=h;try{for(f(W),d=n(c);d!==null&&(!(d.expirationTime>W)||A&&!j());){var re=d.callback;if(typeof re=="function"){d.callback=null,h=d.priorityLevel;var he=re(d.expirationTime<=W);W=t.unstable_now(),typeof he=="function"?d.callback=he:d===n(c)&&i(c),f(W)}else i(c);d=n(c)}if(d!==null)var Vt=!0;else{var yt=n(l);yt!==null&&nn(v,yt.startTime-W),Vt=!1}return Vt}finally{d=null,h=z,g=!1}}var b=!1,P=null,_=-1,N=5,I=-1;function j(){return!(t.unstable_now()-I<N)}function K(){if(P!==null){var A=t.unstable_now();I=A;var W=!0;try{W=P(!0,A)}finally{W?de():(b=!1,P=null)}}else b=!1}var de;if(typeof m=="function")de=function(){m(K)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,$e=Ue.port2;Ue.port1.onmessage=K,de=function(){$e.postMessage(null)}}else de=function(){E(K,0)};function Cn(A){P=A,b||(b=!0,de())}function nn(A,W){_=E(function(){A(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_continueExecution=function(){y||g||(y=!0,Cn(C))},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(A){switch(h){case 1:case 2:case 3:var W=3;break;default:W=h}var z=h;h=W;try{return A()}finally{h=z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(A,W){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var z=h;h=A;try{return W()}finally{h=z}},t.unstable_scheduleCallback=function(A,W,z){var re=t.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?re+z:re):z=re,A){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=z+he,A={id:u++,callback:W,priorityLevel:A,startTime:z,expirationTime:he,sortIndex:-1},z>re?(A.sortIndex=z,e(l,A),n(c)===null&&A===n(l)&&(k?(p(_),_=-1):k=!0,nn(v,z-re))):(A.sortIndex=he,e(c,A),y||g||(y=!0,Cn(C))),A},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(A){var W=h;return function(){var z=h;h=W;try{return A.apply(this,arguments)}finally{h=z}}}})(Kf);qf.exports=Kf;var my=qf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gy=q,mt=my;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Hf=new Set,Gr={};function vi(t,e){Zi(t,e),Zi(t+"Capture",e)}function Zi(t,e){for(Gr[t]=e,t=0;t<e.length;t++)Hf.add(e[t])}var mn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mc=Object.prototype.hasOwnProperty,vy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gd={},vd={};function yy(t){return mc.call(vd,t)?!0:mc.call(gd,t)?!1:vy.test(t)?vd[t]=!0:(gd[t]=!0,!1)}function ky(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Sy(t,e,n,i){if(e===null||typeof e>"u"||ky(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ze[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ze[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ze[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ze[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ze[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ze[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ze[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ze[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ze[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Xl=/[\-:]([a-z])/g;function Zl(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Xl,Zl);ze[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Xl,Zl);ze[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Xl,Zl);ze[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ze[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});ze.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ze[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function eu(t,e,n,i){var r=ze.hasOwnProperty(e)?ze[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Sy(e,n,r,i)&&(n=null),i||r===null?yy(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Sn=gy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ss=Symbol.for("react.element"),Pi=Symbol.for("react.portal"),_i=Symbol.for("react.fragment"),tu=Symbol.for("react.strict_mode"),gc=Symbol.for("react.profiler"),$f=Symbol.for("react.provider"),Gf=Symbol.for("react.context"),nu=Symbol.for("react.forward_ref"),vc=Symbol.for("react.suspense"),yc=Symbol.for("react.suspense_list"),iu=Symbol.for("react.memo"),_n=Symbol.for("react.lazy"),Qf=Symbol.for("react.offscreen"),yd=Symbol.iterator;function pr(t){return t===null||typeof t!="object"?null:(t=yd&&t[yd]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,Ta;function xr(t){if(Ta===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ta=e&&e[1]||""}return`
`+Ta+t}var ba=!1;function wa(t,e){if(!t||ba)return"";ba=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var i=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){i=l}t.call(e.prototype)}else{try{throw Error()}catch(l){i=l}t()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var c=`
`+r[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{ba=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?xr(t):""}function Cy(t){switch(t.tag){case 5:return xr(t.type);case 16:return xr("Lazy");case 13:return xr("Suspense");case 19:return xr("SuspenseList");case 0:case 2:case 15:return t=wa(t.type,!1),t;case 11:return t=wa(t.type.render,!1),t;case 1:return t=wa(t.type,!0),t;default:return""}}function kc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _i:return"Fragment";case Pi:return"Portal";case gc:return"Profiler";case tu:return"StrictMode";case vc:return"Suspense";case yc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gf:return(t.displayName||"Context")+".Consumer";case $f:return(t._context.displayName||"Context")+".Provider";case nu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case iu:return e=t.displayName||null,e!==null?e:kc(t.type)||"Memo";case _n:e=t._payload,t=t._init;try{return kc(t(e))}catch{}}return null}function Ty(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kc(e);case 8:return e===tu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Hn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Jf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function by(t){var e=Jf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Cs(t){t._valueTracker||(t._valueTracker=by(t))}function Yf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Jf(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function vo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Sc(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function kd(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Hn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Xf(t,e){e=e.checked,e!=null&&eu(t,"checked",e,!1)}function Cc(t,e){Xf(t,e);var n=Hn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Tc(t,e.type,n):e.hasOwnProperty("defaultValue")&&Tc(t,e.type,Hn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Sd(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Tc(t,e,n){(e!=="number"||vo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ir=Array.isArray;function Vi(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Hn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function bc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Cd(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(Ir(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Hn(n)}}function Zf(t,e){var n=Hn(e.value),i=Hn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Td(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ep(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wc(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ep(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ts,tp=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ts=Ts||document.createElement("div"),Ts.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ts.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Lr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wy=["Webkit","ms","Moz","O"];Object.keys(Lr).forEach(function(t){wy.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Lr[e]=Lr[t]})});function np(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Lr.hasOwnProperty(t)&&Lr[t]?(""+e).trim():e+"px"}function ip(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=np(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Ey=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ec(t,e){if(e){if(Ey[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function Pc(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _c=null;function ru(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Rc=null,zi=null,Wi=null;function bd(t){if(t=vs(t)){if(typeof Rc!="function")throw Error(O(280));var e=t.stateNode;e&&(e=ta(e),Rc(t.stateNode,t.type,e))}}function rp(t){zi?Wi?Wi.push(t):Wi=[t]:zi=t}function sp(){if(zi){var t=zi,e=Wi;if(Wi=zi=null,bd(t),e)for(t=0;t<e.length;t++)bd(e[t])}}function op(t,e){return t(e)}function ap(){}var Ea=!1;function cp(t,e,n){if(Ea)return t(e,n);Ea=!0;try{return op(t,e,n)}finally{Ea=!1,(zi!==null||Wi!==null)&&(ap(),sp())}}function Jr(t,e){var n=t.stateNode;if(n===null)return null;var i=ta(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var xc=!1;if(mn)try{var mr={};Object.defineProperty(mr,"passive",{get:function(){xc=!0}}),window.addEventListener("test",mr,mr),window.removeEventListener("test",mr,mr)}catch{xc=!1}function Py(t,e,n,i,r,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var Ar=!1,yo=null,ko=!1,Ic=null,_y={onError:function(t){Ar=!0,yo=t}};function Ry(t,e,n,i,r,s,o,a,c){Ar=!1,yo=null,Py.apply(_y,arguments)}function xy(t,e,n,i,r,s,o,a,c){if(Ry.apply(this,arguments),Ar){if(Ar){var l=yo;Ar=!1,yo=null}else throw Error(O(198));ko||(ko=!0,Ic=l)}}function yi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function lp(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function wd(t){if(yi(t)!==t)throw Error(O(188))}function Iy(t){var e=t.alternate;if(!e){if(e=yi(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return wd(r),t;if(s===i)return wd(r),e;s=s.sibling}throw Error(O(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==i)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function up(t){return t=Iy(t),t!==null?dp(t):null}function dp(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=dp(t);if(e!==null)return e;t=t.sibling}return null}var hp=mt.unstable_scheduleCallback,Ed=mt.unstable_cancelCallback,Oy=mt.unstable_shouldYield,Fy=mt.unstable_requestPaint,be=mt.unstable_now,Ny=mt.unstable_getCurrentPriorityLevel,su=mt.unstable_ImmediatePriority,fp=mt.unstable_UserBlockingPriority,So=mt.unstable_NormalPriority,My=mt.unstable_LowPriority,pp=mt.unstable_IdlePriority,Yo=null,Gt=null;function Dy(t){if(Gt&&typeof Gt.onCommitFiberRoot=="function")try{Gt.onCommitFiberRoot(Yo,t,void 0,(t.current.flags&128)===128)}catch{}}var At=Math.clz32?Math.clz32:Uy,Ly=Math.log,Ay=Math.LN2;function Uy(t){return t>>>=0,t===0?32:31-(Ly(t)/Ay|0)|0}var bs=64,ws=4194304;function Or(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Co(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Or(a):(s&=o,s!==0&&(i=Or(s)))}else o=n&~r,o!==0?i=Or(o):s!==0&&(i=Or(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-At(e),r=1<<n,i|=t[n],e&=~r;return i}function jy(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function By(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-At(s),a=1<<o,c=r[o];c===-1?(!(a&n)||a&i)&&(r[o]=jy(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function Oc(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function mp(){var t=bs;return bs<<=1,!(bs&4194240)&&(bs=64),t}function Pa(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ms(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-At(e),t[e]=n}function Vy(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-At(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function ou(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-At(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var te=0;function gp(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var vp,au,yp,kp,Sp,Fc=!1,Es=[],Dn=null,Ln=null,An=null,Yr=new Map,Xr=new Map,xn=[],zy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pd(t,e){switch(t){case"focusin":case"focusout":Dn=null;break;case"dragenter":case"dragleave":Ln=null;break;case"mouseover":case"mouseout":An=null;break;case"pointerover":case"pointerout":Yr.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xr.delete(e.pointerId)}}function gr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=vs(e),e!==null&&au(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function Wy(t,e,n,i,r){switch(e){case"focusin":return Dn=gr(Dn,t,e,n,i,r),!0;case"dragenter":return Ln=gr(Ln,t,e,n,i,r),!0;case"mouseover":return An=gr(An,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Yr.set(s,gr(Yr.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Xr.set(s,gr(Xr.get(s)||null,t,e,n,i,r)),!0}return!1}function Cp(t){var e=ii(t.target);if(e!==null){var n=yi(e);if(n!==null){if(e=n.tag,e===13){if(e=lp(n),e!==null){t.blockedOn=e,Sp(t.priority,function(){yp(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function zs(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Nc(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);_c=i,n.target.dispatchEvent(i),_c=null}else return e=vs(n),e!==null&&au(e),t.blockedOn=n,!1;e.shift()}return!0}function _d(t,e,n){zs(t)&&n.delete(e)}function qy(){Fc=!1,Dn!==null&&zs(Dn)&&(Dn=null),Ln!==null&&zs(Ln)&&(Ln=null),An!==null&&zs(An)&&(An=null),Yr.forEach(_d),Xr.forEach(_d)}function vr(t,e){t.blockedOn===e&&(t.blockedOn=null,Fc||(Fc=!0,mt.unstable_scheduleCallback(mt.unstable_NormalPriority,qy)))}function Zr(t){function e(r){return vr(r,t)}if(0<Es.length){vr(Es[0],t);for(var n=1;n<Es.length;n++){var i=Es[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Dn!==null&&vr(Dn,t),Ln!==null&&vr(Ln,t),An!==null&&vr(An,t),Yr.forEach(e),Xr.forEach(e),n=0;n<xn.length;n++)i=xn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<xn.length&&(n=xn[0],n.blockedOn===null);)Cp(n),n.blockedOn===null&&xn.shift()}var qi=Sn.ReactCurrentBatchConfig,To=!0;function Ky(t,e,n,i){var r=te,s=qi.transition;qi.transition=null;try{te=1,cu(t,e,n,i)}finally{te=r,qi.transition=s}}function Hy(t,e,n,i){var r=te,s=qi.transition;qi.transition=null;try{te=4,cu(t,e,n,i)}finally{te=r,qi.transition=s}}function cu(t,e,n,i){if(To){var r=Nc(t,e,n,i);if(r===null)La(t,e,i,bo,n),Pd(t,i);else if(Wy(r,t,e,n,i))i.stopPropagation();else if(Pd(t,i),e&4&&-1<zy.indexOf(t)){for(;r!==null;){var s=vs(r);if(s!==null&&vp(s),s=Nc(t,e,n,i),s===null&&La(t,e,i,bo,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else La(t,e,i,null,n)}}var bo=null;function Nc(t,e,n,i){if(bo=null,t=ru(i),t=ii(t),t!==null)if(e=yi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=lp(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return bo=t,null}function Tp(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ny()){case su:return 1;case fp:return 4;case So:case My:return 16;case pp:return 536870912;default:return 16}default:return 16}}var Fn=null,lu=null,Ws=null;function bp(){if(Ws)return Ws;var t,e=lu,n=e.length,i,r="value"in Fn?Fn.value:Fn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Ws=r.slice(t,1<i?1-i:void 0)}function qs(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ps(){return!0}function Rd(){return!1}function vt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ps:Rd,this.isPropagationStopped=Rd,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ps)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ps)},persist:function(){},isPersistent:Ps}),e}var ur={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uu=vt(ur),gs=ve({},ur,{view:0,detail:0}),$y=vt(gs),_a,Ra,yr,Xo=ve({},gs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:du,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yr&&(yr&&t.type==="mousemove"?(_a=t.screenX-yr.screenX,Ra=t.screenY-yr.screenY):Ra=_a=0,yr=t),_a)},movementY:function(t){return"movementY"in t?t.movementY:Ra}}),xd=vt(Xo),Gy=ve({},Xo,{dataTransfer:0}),Qy=vt(Gy),Jy=ve({},gs,{relatedTarget:0}),xa=vt(Jy),Yy=ve({},ur,{animationName:0,elapsedTime:0,pseudoElement:0}),Xy=vt(Yy),Zy=ve({},ur,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),e0=vt(Zy),t0=ve({},ur,{data:0}),Id=vt(t0),n0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},r0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function s0(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=r0[t])?!!e[t]:!1}function du(){return s0}var o0=ve({},gs,{key:function(t){if(t.key){var e=n0[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=qs(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?i0[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:du,charCode:function(t){return t.type==="keypress"?qs(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qs(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),a0=vt(o0),c0=ve({},Xo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Od=vt(c0),l0=ve({},gs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:du}),u0=vt(l0),d0=ve({},ur,{propertyName:0,elapsedTime:0,pseudoElement:0}),h0=vt(d0),f0=ve({},Xo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),p0=vt(f0),m0=[9,13,27,32],hu=mn&&"CompositionEvent"in window,Ur=null;mn&&"documentMode"in document&&(Ur=document.documentMode);var g0=mn&&"TextEvent"in window&&!Ur,wp=mn&&(!hu||Ur&&8<Ur&&11>=Ur),Fd=String.fromCharCode(32),Nd=!1;function Ep(t,e){switch(t){case"keyup":return m0.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pp(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ri=!1;function v0(t,e){switch(t){case"compositionend":return Pp(e);case"keypress":return e.which!==32?null:(Nd=!0,Fd);case"textInput":return t=e.data,t===Fd&&Nd?null:t;default:return null}}function y0(t,e){if(Ri)return t==="compositionend"||!hu&&Ep(t,e)?(t=bp(),Ws=lu=Fn=null,Ri=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return wp&&e.locale!=="ko"?null:e.data;default:return null}}var k0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Md(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!k0[t.type]:e==="textarea"}function _p(t,e,n,i){rp(i),e=wo(e,"onChange"),0<e.length&&(n=new uu("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var jr=null,es=null;function S0(t){Up(t,0)}function Zo(t){var e=Oi(t);if(Yf(e))return t}function C0(t,e){if(t==="change")return e}var Rp=!1;if(mn){var Ia;if(mn){var Oa="oninput"in document;if(!Oa){var Dd=document.createElement("div");Dd.setAttribute("oninput","return;"),Oa=typeof Dd.oninput=="function"}Ia=Oa}else Ia=!1;Rp=Ia&&(!document.documentMode||9<document.documentMode)}function Ld(){jr&&(jr.detachEvent("onpropertychange",xp),es=jr=null)}function xp(t){if(t.propertyName==="value"&&Zo(es)){var e=[];_p(e,es,t,ru(t)),cp(S0,e)}}function T0(t,e,n){t==="focusin"?(Ld(),jr=e,es=n,jr.attachEvent("onpropertychange",xp)):t==="focusout"&&Ld()}function b0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Zo(es)}function w0(t,e){if(t==="click")return Zo(e)}function E0(t,e){if(t==="input"||t==="change")return Zo(e)}function P0(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var jt=typeof Object.is=="function"?Object.is:P0;function ts(t,e){if(jt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!mc.call(e,r)||!jt(t[r],e[r]))return!1}return!0}function Ad(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ud(t,e){var n=Ad(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ad(n)}}function Ip(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Ip(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Op(){for(var t=window,e=vo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=vo(t.document)}return e}function fu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function _0(t){var e=Op(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Ip(n.ownerDocument.documentElement,n)){if(i!==null&&fu(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Ud(n,s);var o=Ud(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var R0=mn&&"documentMode"in document&&11>=document.documentMode,xi=null,Mc=null,Br=null,Dc=!1;function jd(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dc||xi==null||xi!==vo(i)||(i=xi,"selectionStart"in i&&fu(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Br&&ts(Br,i)||(Br=i,i=wo(Mc,"onSelect"),0<i.length&&(e=new uu("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=xi)))}function _s(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ii={animationend:_s("Animation","AnimationEnd"),animationiteration:_s("Animation","AnimationIteration"),animationstart:_s("Animation","AnimationStart"),transitionend:_s("Transition","TransitionEnd")},Fa={},Fp={};mn&&(Fp=document.createElement("div").style,"AnimationEvent"in window||(delete Ii.animationend.animation,delete Ii.animationiteration.animation,delete Ii.animationstart.animation),"TransitionEvent"in window||delete Ii.transitionend.transition);function ea(t){if(Fa[t])return Fa[t];if(!Ii[t])return t;var e=Ii[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Fp)return Fa[t]=e[n];return t}var Np=ea("animationend"),Mp=ea("animationiteration"),Dp=ea("animationstart"),Lp=ea("transitionend"),Ap=new Map,Bd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qn(t,e){Ap.set(t,e),vi(e,[t])}for(var Na=0;Na<Bd.length;Na++){var Ma=Bd[Na],x0=Ma.toLowerCase(),I0=Ma[0].toUpperCase()+Ma.slice(1);Qn(x0,"on"+I0)}Qn(Np,"onAnimationEnd");Qn(Mp,"onAnimationIteration");Qn(Dp,"onAnimationStart");Qn("dblclick","onDoubleClick");Qn("focusin","onFocus");Qn("focusout","onBlur");Qn(Lp,"onTransitionEnd");Zi("onMouseEnter",["mouseout","mouseover"]);Zi("onMouseLeave",["mouseout","mouseover"]);Zi("onPointerEnter",["pointerout","pointerover"]);Zi("onPointerLeave",["pointerout","pointerover"]);vi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vi("onBeforeInput",["compositionend","keypress","textInput","paste"]);vi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),O0=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Vd(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,xy(i,e,void 0,t),t.currentTarget=null}function Up(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&r.isPropagationStopped())break e;Vd(r,a,l),s=c}else for(o=0;o<i.length;o++){if(a=i[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&r.isPropagationStopped())break e;Vd(r,a,l),s=c}}}if(ko)throw t=Ic,ko=!1,Ic=null,t}function ce(t,e){var n=e[Bc];n===void 0&&(n=e[Bc]=new Set);var i=t+"__bubble";n.has(i)||(jp(e,t,2,!1),n.add(i))}function Da(t,e,n){var i=0;e&&(i|=4),jp(n,t,i,e)}var Rs="_reactListening"+Math.random().toString(36).slice(2);function ns(t){if(!t[Rs]){t[Rs]=!0,Hf.forEach(function(n){n!=="selectionchange"&&(O0.has(n)||Da(n,!1,t),Da(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Rs]||(e[Rs]=!0,Da("selectionchange",!1,e))}}function jp(t,e,n,i){switch(Tp(e)){case 1:var r=Ky;break;case 4:r=Hy;break;default:r=cu}n=r.bind(null,e,n,t),r=void 0,!xc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function La(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;a!==null;){if(o=ii(a),o===null)return;if(c=o.tag,c===5||c===6){i=s=o;continue e}a=a.parentNode}}i=i.return}cp(function(){var l=s,u=ru(n),d=[];e:{var h=Ap.get(t);if(h!==void 0){var g=uu,y=t;switch(t){case"keypress":if(qs(n)===0)break e;case"keydown":case"keyup":g=a0;break;case"focusin":y="focus",g=xa;break;case"focusout":y="blur",g=xa;break;case"beforeblur":case"afterblur":g=xa;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=xd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Qy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=u0;break;case Np:case Mp:case Dp:g=Xy;break;case Lp:g=h0;break;case"scroll":g=$y;break;case"wheel":g=p0;break;case"copy":case"cut":case"paste":g=e0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Od}var k=(e&4)!==0,E=!k&&t==="scroll",p=k?h!==null?h+"Capture":null:h;k=[];for(var m=l,f;m!==null;){f=m;var v=f.stateNode;if(f.tag===5&&v!==null&&(f=v,p!==null&&(v=Jr(m,p),v!=null&&k.push(is(m,v,f)))),E)break;m=m.return}0<k.length&&(h=new g(h,y,null,n,u),d.push({event:h,listeners:k}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",h&&n!==_c&&(y=n.relatedTarget||n.fromElement)&&(ii(y)||y[gn]))break e;if((g||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,g?(y=n.relatedTarget||n.toElement,g=l,y=y?ii(y):null,y!==null&&(E=yi(y),y!==E||y.tag!==5&&y.tag!==6)&&(y=null)):(g=null,y=l),g!==y)){if(k=xd,v="onMouseLeave",p="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(k=Od,v="onPointerLeave",p="onPointerEnter",m="pointer"),E=g==null?h:Oi(g),f=y==null?h:Oi(y),h=new k(v,m+"leave",g,n,u),h.target=E,h.relatedTarget=f,v=null,ii(u)===l&&(k=new k(p,m+"enter",y,n,u),k.target=f,k.relatedTarget=E,v=k),E=v,g&&y)t:{for(k=g,p=y,m=0,f=k;f;f=Ti(f))m++;for(f=0,v=p;v;v=Ti(v))f++;for(;0<m-f;)k=Ti(k),m--;for(;0<f-m;)p=Ti(p),f--;for(;m--;){if(k===p||p!==null&&k===p.alternate)break t;k=Ti(k),p=Ti(p)}k=null}else k=null;g!==null&&zd(d,h,g,k,!1),y!==null&&E!==null&&zd(d,E,y,k,!0)}}e:{if(h=l?Oi(l):window,g=h.nodeName&&h.nodeName.toLowerCase(),g==="select"||g==="input"&&h.type==="file")var C=C0;else if(Md(h))if(Rp)C=E0;else{C=b0;var b=T0}else(g=h.nodeName)&&g.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(C=w0);if(C&&(C=C(t,l))){_p(d,C,n,u);break e}b&&b(t,h,l),t==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&Tc(h,"number",h.value)}switch(b=l?Oi(l):window,t){case"focusin":(Md(b)||b.contentEditable==="true")&&(xi=b,Mc=l,Br=null);break;case"focusout":Br=Mc=xi=null;break;case"mousedown":Dc=!0;break;case"contextmenu":case"mouseup":case"dragend":Dc=!1,jd(d,n,u);break;case"selectionchange":if(R0)break;case"keydown":case"keyup":jd(d,n,u)}var P;if(hu)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Ri?Ep(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(wp&&n.locale!=="ko"&&(Ri||_!=="onCompositionStart"?_==="onCompositionEnd"&&Ri&&(P=bp()):(Fn=u,lu="value"in Fn?Fn.value:Fn.textContent,Ri=!0)),b=wo(l,_),0<b.length&&(_=new Id(_,t,null,n,u),d.push({event:_,listeners:b}),P?_.data=P:(P=Pp(n),P!==null&&(_.data=P)))),(P=g0?v0(t,n):y0(t,n))&&(l=wo(l,"onBeforeInput"),0<l.length&&(u=new Id("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=P))}Up(d,e)})}function is(t,e,n){return{instance:t,listener:e,currentTarget:n}}function wo(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Jr(t,n),s!=null&&i.unshift(is(t,s,r)),s=Jr(t,e),s!=null&&i.push(is(t,s,r))),t=t.return}return i}function Ti(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function zd(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=Jr(n,s),c!=null&&o.unshift(is(n,c,a))):r||(c=Jr(n,s),c!=null&&o.push(is(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var F0=/\r\n?/g,N0=/\u0000|\uFFFD/g;function Wd(t){return(typeof t=="string"?t:""+t).replace(F0,`
`).replace(N0,"")}function xs(t,e,n){if(e=Wd(e),Wd(t)!==e&&n)throw Error(O(425))}function Eo(){}var Lc=null,Ac=null;function Uc(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jc=typeof setTimeout=="function"?setTimeout:void 0,M0=typeof clearTimeout=="function"?clearTimeout:void 0,qd=typeof Promise=="function"?Promise:void 0,D0=typeof queueMicrotask=="function"?queueMicrotask:typeof qd<"u"?function(t){return qd.resolve(null).then(t).catch(L0)}:jc;function L0(t){setTimeout(function(){throw t})}function Aa(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Zr(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Zr(e)}function Un(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Kd(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var dr=Math.random().toString(36).slice(2),Ht="__reactFiber$"+dr,rs="__reactProps$"+dr,gn="__reactContainer$"+dr,Bc="__reactEvents$"+dr,A0="__reactListeners$"+dr,U0="__reactHandles$"+dr;function ii(t){var e=t[Ht];if(e)return e;for(var n=t.parentNode;n;){if(e=n[gn]||n[Ht]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Kd(t);t!==null;){if(n=t[Ht])return n;t=Kd(t)}return e}t=n,n=t.parentNode}return null}function vs(t){return t=t[Ht]||t[gn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Oi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function ta(t){return t[rs]||null}var Vc=[],Fi=-1;function Jn(t){return{current:t}}function ue(t){0>Fi||(t.current=Vc[Fi],Vc[Fi]=null,Fi--)}function oe(t,e){Fi++,Vc[Fi]=t.current,t.current=e}var $n={},He=Jn($n),rt=Jn(!1),li=$n;function er(t,e){var n=t.type.contextTypes;if(!n)return $n;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function st(t){return t=t.childContextTypes,t!=null}function Po(){ue(rt),ue(He)}function Hd(t,e,n){if(He.current!==$n)throw Error(O(168));oe(He,e),oe(rt,n)}function Bp(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(O(108,Ty(t)||"Unknown",r));return ve({},n,i)}function _o(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$n,li=He.current,oe(He,t),oe(rt,rt.current),!0}function $d(t,e,n){var i=t.stateNode;if(!i)throw Error(O(169));n?(t=Bp(t,e,li),i.__reactInternalMemoizedMergedChildContext=t,ue(rt),ue(He),oe(He,t)):ue(rt),oe(rt,n)}var on=null,na=!1,Ua=!1;function Vp(t){on===null?on=[t]:on.push(t)}function j0(t){na=!0,Vp(t)}function Yn(){if(!Ua&&on!==null){Ua=!0;var t=0,e=te;try{var n=on;for(te=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}on=null,na=!1}catch(r){throw on!==null&&(on=on.slice(t+1)),hp(su,Yn),r}finally{te=e,Ua=!1}}return null}var Ni=[],Mi=0,Ro=null,xo=0,kt=[],St=0,ui=null,hn=1,fn="";function ei(t,e){Ni[Mi++]=xo,Ni[Mi++]=Ro,Ro=t,xo=e}function zp(t,e,n){kt[St++]=hn,kt[St++]=fn,kt[St++]=ui,ui=t;var i=hn;t=fn;var r=32-At(i)-1;i&=~(1<<r),n+=1;var s=32-At(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,hn=1<<32-At(e)+r|n<<r|i,fn=s+t}else hn=1<<s|n<<r|i,fn=t}function pu(t){t.return!==null&&(ei(t,1),zp(t,1,0))}function mu(t){for(;t===Ro;)Ro=Ni[--Mi],Ni[Mi]=null,xo=Ni[--Mi],Ni[Mi]=null;for(;t===ui;)ui=kt[--St],kt[St]=null,fn=kt[--St],kt[St]=null,hn=kt[--St],kt[St]=null}var ft=null,dt=null,fe=!1,Nt=null;function Wp(t,e){var n=Tt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Gd(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,dt=Un(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,dt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ui!==null?{id:hn,overflow:fn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Tt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ft=t,dt=null,!0):!1;default:return!1}}function zc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Wc(t){if(fe){var e=dt;if(e){var n=e;if(!Gd(t,e)){if(zc(t))throw Error(O(418));e=Un(n.nextSibling);var i=ft;e&&Gd(t,e)?Wp(i,n):(t.flags=t.flags&-4097|2,fe=!1,ft=t)}}else{if(zc(t))throw Error(O(418));t.flags=t.flags&-4097|2,fe=!1,ft=t}}}function Qd(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function Is(t){if(t!==ft)return!1;if(!fe)return Qd(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Uc(t.type,t.memoizedProps)),e&&(e=dt)){if(zc(t))throw qp(),Error(O(418));for(;e;)Wp(t,e),e=Un(e.nextSibling)}if(Qd(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){dt=Un(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}dt=null}}else dt=ft?Un(t.stateNode.nextSibling):null;return!0}function qp(){for(var t=dt;t;)t=Un(t.nextSibling)}function tr(){dt=ft=null,fe=!1}function gu(t){Nt===null?Nt=[t]:Nt.push(t)}var B0=Sn.ReactCurrentBatchConfig;function kr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var i=n.stateNode}if(!i)throw Error(O(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function Os(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Jd(t){var e=t._init;return e(t._payload)}function Kp(t){function e(p,m){if(t){var f=p.deletions;f===null?(p.deletions=[m],p.flags|=16):f.push(m)}}function n(p,m){if(!t)return null;for(;m!==null;)e(p,m),m=m.sibling;return null}function i(p,m){for(p=new Map;m!==null;)m.key!==null?p.set(m.key,m):p.set(m.index,m),m=m.sibling;return p}function r(p,m){return p=zn(p,m),p.index=0,p.sibling=null,p}function s(p,m,f){return p.index=f,t?(f=p.alternate,f!==null?(f=f.index,f<m?(p.flags|=2,m):f):(p.flags|=2,m)):(p.flags|=1048576,m)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,m,f,v){return m===null||m.tag!==6?(m=Ka(f,p.mode,v),m.return=p,m):(m=r(m,f),m.return=p,m)}function c(p,m,f,v){var C=f.type;return C===_i?u(p,m,f.props.children,v,f.key):m!==null&&(m.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===_n&&Jd(C)===m.type)?(v=r(m,f.props),v.ref=kr(p,m,f),v.return=p,v):(v=Ys(f.type,f.key,f.props,null,p.mode,v),v.ref=kr(p,m,f),v.return=p,v)}function l(p,m,f,v){return m===null||m.tag!==4||m.stateNode.containerInfo!==f.containerInfo||m.stateNode.implementation!==f.implementation?(m=Ha(f,p.mode,v),m.return=p,m):(m=r(m,f.children||[]),m.return=p,m)}function u(p,m,f,v,C){return m===null||m.tag!==7?(m=ai(f,p.mode,v,C),m.return=p,m):(m=r(m,f),m.return=p,m)}function d(p,m,f){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Ka(""+m,p.mode,f),m.return=p,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Ss:return f=Ys(m.type,m.key,m.props,null,p.mode,f),f.ref=kr(p,null,m),f.return=p,f;case Pi:return m=Ha(m,p.mode,f),m.return=p,m;case _n:var v=m._init;return d(p,v(m._payload),f)}if(Ir(m)||pr(m))return m=ai(m,p.mode,f,null),m.return=p,m;Os(p,m)}return null}function h(p,m,f,v){var C=m!==null?m.key:null;if(typeof f=="string"&&f!==""||typeof f=="number")return C!==null?null:a(p,m,""+f,v);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Ss:return f.key===C?c(p,m,f,v):null;case Pi:return f.key===C?l(p,m,f,v):null;case _n:return C=f._init,h(p,m,C(f._payload),v)}if(Ir(f)||pr(f))return C!==null?null:u(p,m,f,v,null);Os(p,f)}return null}function g(p,m,f,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return p=p.get(f)||null,a(m,p,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ss:return p=p.get(v.key===null?f:v.key)||null,c(m,p,v,C);case Pi:return p=p.get(v.key===null?f:v.key)||null,l(m,p,v,C);case _n:var b=v._init;return g(p,m,f,b(v._payload),C)}if(Ir(v)||pr(v))return p=p.get(f)||null,u(m,p,v,C,null);Os(m,v)}return null}function y(p,m,f,v){for(var C=null,b=null,P=m,_=m=0,N=null;P!==null&&_<f.length;_++){P.index>_?(N=P,P=null):N=P.sibling;var I=h(p,P,f[_],v);if(I===null){P===null&&(P=N);break}t&&P&&I.alternate===null&&e(p,P),m=s(I,m,_),b===null?C=I:b.sibling=I,b=I,P=N}if(_===f.length)return n(p,P),fe&&ei(p,_),C;if(P===null){for(;_<f.length;_++)P=d(p,f[_],v),P!==null&&(m=s(P,m,_),b===null?C=P:b.sibling=P,b=P);return fe&&ei(p,_),C}for(P=i(p,P);_<f.length;_++)N=g(P,p,_,f[_],v),N!==null&&(t&&N.alternate!==null&&P.delete(N.key===null?_:N.key),m=s(N,m,_),b===null?C=N:b.sibling=N,b=N);return t&&P.forEach(function(j){return e(p,j)}),fe&&ei(p,_),C}function k(p,m,f,v){var C=pr(f);if(typeof C!="function")throw Error(O(150));if(f=C.call(f),f==null)throw Error(O(151));for(var b=C=null,P=m,_=m=0,N=null,I=f.next();P!==null&&!I.done;_++,I=f.next()){P.index>_?(N=P,P=null):N=P.sibling;var j=h(p,P,I.value,v);if(j===null){P===null&&(P=N);break}t&&P&&j.alternate===null&&e(p,P),m=s(j,m,_),b===null?C=j:b.sibling=j,b=j,P=N}if(I.done)return n(p,P),fe&&ei(p,_),C;if(P===null){for(;!I.done;_++,I=f.next())I=d(p,I.value,v),I!==null&&(m=s(I,m,_),b===null?C=I:b.sibling=I,b=I);return fe&&ei(p,_),C}for(P=i(p,P);!I.done;_++,I=f.next())I=g(P,p,_,I.value,v),I!==null&&(t&&I.alternate!==null&&P.delete(I.key===null?_:I.key),m=s(I,m,_),b===null?C=I:b.sibling=I,b=I);return t&&P.forEach(function(K){return e(p,K)}),fe&&ei(p,_),C}function E(p,m,f,v){if(typeof f=="object"&&f!==null&&f.type===_i&&f.key===null&&(f=f.props.children),typeof f=="object"&&f!==null){switch(f.$$typeof){case Ss:e:{for(var C=f.key,b=m;b!==null;){if(b.key===C){if(C=f.type,C===_i){if(b.tag===7){n(p,b.sibling),m=r(b,f.props.children),m.return=p,p=m;break e}}else if(b.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===_n&&Jd(C)===b.type){n(p,b.sibling),m=r(b,f.props),m.ref=kr(p,b,f),m.return=p,p=m;break e}n(p,b);break}else e(p,b);b=b.sibling}f.type===_i?(m=ai(f.props.children,p.mode,v,f.key),m.return=p,p=m):(v=Ys(f.type,f.key,f.props,null,p.mode,v),v.ref=kr(p,m,f),v.return=p,p=v)}return o(p);case Pi:e:{for(b=f.key;m!==null;){if(m.key===b)if(m.tag===4&&m.stateNode.containerInfo===f.containerInfo&&m.stateNode.implementation===f.implementation){n(p,m.sibling),m=r(m,f.children||[]),m.return=p,p=m;break e}else{n(p,m);break}else e(p,m);m=m.sibling}m=Ha(f,p.mode,v),m.return=p,p=m}return o(p);case _n:return b=f._init,E(p,m,b(f._payload),v)}if(Ir(f))return y(p,m,f,v);if(pr(f))return k(p,m,f,v);Os(p,f)}return typeof f=="string"&&f!==""||typeof f=="number"?(f=""+f,m!==null&&m.tag===6?(n(p,m.sibling),m=r(m,f),m.return=p,p=m):(n(p,m),m=Ka(f,p.mode,v),m.return=p,p=m),o(p)):n(p,m)}return E}var nr=Kp(!0),Hp=Kp(!1),Io=Jn(null),Oo=null,Di=null,vu=null;function yu(){vu=Di=Oo=null}function ku(t){var e=Io.current;ue(Io),t._currentValue=e}function qc(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Ki(t,e){Oo=t,vu=Di=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(nt=!0),t.firstContext=null)}function wt(t){var e=t._currentValue;if(vu!==t)if(t={context:t,memoizedValue:e,next:null},Di===null){if(Oo===null)throw Error(O(308));Di=t,Oo.dependencies={lanes:0,firstContext:t}}else Di=Di.next=t;return e}var ri=null;function Su(t){ri===null?ri=[t]:ri.push(t)}function $p(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Su(e)):(n.next=r.next,r.next=n),e.interleaved=n,vn(t,i)}function vn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Rn=!1;function Cu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gp(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function pn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function jn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,X&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,vn(t,n)}return r=i.interleaved,r===null?(e.next=e,Su(i)):(e.next=r.next,r.next=e),i.interleaved=e,vn(t,n)}function Ks(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,ou(t,n)}}function Yd(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Fo(t,e,n,i){var r=t.updateQueue;Rn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=r.baseState;o=0,u=l=c=null,a=s;do{var h=a.lane,g=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,k=a;switch(h=e,g=n,k.tag){case 1:if(y=k.payload,typeof y=="function"){d=y.call(g,d,h);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=k.payload,h=typeof y=="function"?y.call(g,d,h):y,h==null)break e;d=ve({},d,h);break e;case 2:Rn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else g={eventTime:g,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=g,c=d):u=u.next=g,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);hi|=o,t.lanes=o,t.memoizedState=d}}function Xd(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(O(191,r));r.call(i)}}}var ys={},Qt=Jn(ys),ss=Jn(ys),os=Jn(ys);function si(t){if(t===ys)throw Error(O(174));return t}function Tu(t,e){switch(oe(os,e),oe(ss,t),oe(Qt,ys),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wc(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wc(e,t)}ue(Qt),oe(Qt,e)}function ir(){ue(Qt),ue(ss),ue(os)}function Qp(t){si(os.current);var e=si(Qt.current),n=wc(e,t.type);e!==n&&(oe(ss,t),oe(Qt,n))}function bu(t){ss.current===t&&(ue(Qt),ue(ss))}var me=Jn(0);function No(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ja=[];function wu(){for(var t=0;t<ja.length;t++)ja[t]._workInProgressVersionPrimary=null;ja.length=0}var Hs=Sn.ReactCurrentDispatcher,Ba=Sn.ReactCurrentBatchConfig,di=0,ge=null,Ie=null,Me=null,Mo=!1,Vr=!1,as=0,V0=0;function We(){throw Error(O(321))}function Eu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!jt(t[n],e[n]))return!1;return!0}function Pu(t,e,n,i,r,s){if(di=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Hs.current=t===null||t.memoizedState===null?K0:H0,t=n(i,r),Vr){s=0;do{if(Vr=!1,as=0,25<=s)throw Error(O(301));s+=1,Me=Ie=null,e.updateQueue=null,Hs.current=$0,t=n(i,r)}while(Vr)}if(Hs.current=Do,e=Ie!==null&&Ie.next!==null,di=0,Me=Ie=ge=null,Mo=!1,e)throw Error(O(300));return t}function _u(){var t=as!==0;return as=0,t}function qt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?ge.memoizedState=Me=t:Me=Me.next=t,Me}function Et(){if(Ie===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=Ie.next;var e=Me===null?ge.memoizedState:Me.next;if(e!==null)Me=e,Ie=t;else{if(t===null)throw Error(O(310));Ie=t,t={memoizedState:Ie.memoizedState,baseState:Ie.baseState,baseQueue:Ie.baseQueue,queue:Ie.queue,next:null},Me===null?ge.memoizedState=Me=t:Me=Me.next=t}return Me}function cs(t,e){return typeof e=="function"?e(t):e}function Va(t){var e=Et(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=Ie,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((di&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:t(i,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=i):c=c.next=d,ge.lanes|=u,hi|=u}l=l.next}while(l!==null&&l!==s);c===null?o=i:c.next=a,jt(i,e.memoizedState)||(nt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ge.lanes|=s,hi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function za(t){var e=Et(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);jt(s,e.memoizedState)||(nt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Jp(){}function Yp(t,e){var n=ge,i=Et(),r=e(),s=!jt(i.memoizedState,r);if(s&&(i.memoizedState=r,nt=!0),i=i.queue,Ru(em.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,ls(9,Zp.bind(null,n,i,r,e),void 0,null),Ae===null)throw Error(O(349));di&30||Xp(n,e,r)}return r}function Xp(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Zp(t,e,n,i){e.value=n,e.getSnapshot=i,tm(e)&&nm(t)}function em(t,e,n){return n(function(){tm(e)&&nm(t)})}function tm(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!jt(t,n)}catch{return!0}}function nm(t){var e=vn(t,1);e!==null&&Ut(e,t,1,-1)}function Zd(t){var e=qt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cs,lastRenderedState:t},e.queue=t,t=t.dispatch=q0.bind(null,ge,t),[e.memoizedState,t]}function ls(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function im(){return Et().memoizedState}function $s(t,e,n,i){var r=qt();ge.flags|=t,r.memoizedState=ls(1|e,n,void 0,i===void 0?null:i)}function ia(t,e,n,i){var r=Et();i=i===void 0?null:i;var s=void 0;if(Ie!==null){var o=Ie.memoizedState;if(s=o.destroy,i!==null&&Eu(i,o.deps)){r.memoizedState=ls(e,n,s,i);return}}ge.flags|=t,r.memoizedState=ls(1|e,n,s,i)}function eh(t,e){return $s(8390656,8,t,e)}function Ru(t,e){return ia(2048,8,t,e)}function rm(t,e){return ia(4,2,t,e)}function sm(t,e){return ia(4,4,t,e)}function om(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function am(t,e,n){return n=n!=null?n.concat([t]):null,ia(4,4,om.bind(null,e,t),n)}function xu(){}function cm(t,e){var n=Et();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Eu(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function lm(t,e){var n=Et();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Eu(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function um(t,e,n){return di&21?(jt(n,e)||(n=mp(),ge.lanes|=n,hi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,nt=!0),t.memoizedState=n)}function z0(t,e){var n=te;te=n!==0&&4>n?n:4,t(!0);var i=Ba.transition;Ba.transition={};try{t(!1),e()}finally{te=n,Ba.transition=i}}function dm(){return Et().memoizedState}function W0(t,e,n){var i=Vn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},hm(t))fm(e,n);else if(n=$p(t,e,n,i),n!==null){var r=Je();Ut(n,t,i,r),pm(n,e,i)}}function q0(t,e,n){var i=Vn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(hm(t))fm(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,jt(a,o)){var c=e.interleaved;c===null?(r.next=r,Su(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=$p(t,e,r,i),n!==null&&(r=Je(),Ut(n,t,i,r),pm(n,e,i))}}function hm(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function fm(t,e){Vr=Mo=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function pm(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,ou(t,n)}}var Do={readContext:wt,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useInsertionEffect:We,useLayoutEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useMutableSource:We,useSyncExternalStore:We,useId:We,unstable_isNewReconciler:!1},K0={readContext:wt,useCallback:function(t,e){return qt().memoizedState=[t,e===void 0?null:e],t},useContext:wt,useEffect:eh,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,$s(4194308,4,om.bind(null,e,t),n)},useLayoutEffect:function(t,e){return $s(4194308,4,t,e)},useInsertionEffect:function(t,e){return $s(4,2,t,e)},useMemo:function(t,e){var n=qt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=qt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=W0.bind(null,ge,t),[i.memoizedState,t]},useRef:function(t){var e=qt();return t={current:t},e.memoizedState=t},useState:Zd,useDebugValue:xu,useDeferredValue:function(t){return qt().memoizedState=t},useTransition:function(){var t=Zd(!1),e=t[0];return t=z0.bind(null,t[1]),qt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ge,r=qt();if(fe){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ae===null)throw Error(O(349));di&30||Xp(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,eh(em.bind(null,i,s,t),[t]),i.flags|=2048,ls(9,Zp.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=qt(),e=Ae.identifierPrefix;if(fe){var n=fn,i=hn;n=(i&~(1<<32-At(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=as++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=V0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},H0={readContext:wt,useCallback:cm,useContext:wt,useEffect:Ru,useImperativeHandle:am,useInsertionEffect:rm,useLayoutEffect:sm,useMemo:lm,useReducer:Va,useRef:im,useState:function(){return Va(cs)},useDebugValue:xu,useDeferredValue:function(t){var e=Et();return um(e,Ie.memoizedState,t)},useTransition:function(){var t=Va(cs)[0],e=Et().memoizedState;return[t,e]},useMutableSource:Jp,useSyncExternalStore:Yp,useId:dm,unstable_isNewReconciler:!1},$0={readContext:wt,useCallback:cm,useContext:wt,useEffect:Ru,useImperativeHandle:am,useInsertionEffect:rm,useLayoutEffect:sm,useMemo:lm,useReducer:za,useRef:im,useState:function(){return za(cs)},useDebugValue:xu,useDeferredValue:function(t){var e=Et();return Ie===null?e.memoizedState=t:um(e,Ie.memoizedState,t)},useTransition:function(){var t=za(cs)[0],e=Et().memoizedState;return[t,e]},useMutableSource:Jp,useSyncExternalStore:Yp,useId:dm,unstable_isNewReconciler:!1};function xt(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Kc(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ra={isMounted:function(t){return(t=t._reactInternals)?yi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Je(),r=Vn(t),s=pn(i,r);s.payload=e,n!=null&&(s.callback=n),e=jn(t,s,r),e!==null&&(Ut(e,t,r,i),Ks(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Je(),r=Vn(t),s=pn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=jn(t,s,r),e!==null&&(Ut(e,t,r,i),Ks(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Je(),i=Vn(t),r=pn(n,i);r.tag=2,e!=null&&(r.callback=e),e=jn(t,r,i),e!==null&&(Ut(e,t,i,n),Ks(e,t,i))}};function th(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!ts(n,i)||!ts(r,s):!0}function mm(t,e,n){var i=!1,r=$n,s=e.contextType;return typeof s=="object"&&s!==null?s=wt(s):(r=st(e)?li:He.current,i=e.contextTypes,s=(i=i!=null)?er(t,r):$n),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ra,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function nh(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ra.enqueueReplaceState(e,e.state,null)}function Hc(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Cu(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=wt(s):(s=st(e)?li:He.current,r.context=er(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Kc(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ra.enqueueReplaceState(r,r.state,null),Fo(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function rr(t,e){try{var n="",i=e;do n+=Cy(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Wa(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $c(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var G0=typeof WeakMap=="function"?WeakMap:Map;function gm(t,e,n){n=pn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Ao||(Ao=!0,il=i),$c(t,e)},n}function vm(t,e,n){n=pn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){$c(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){$c(t,e),typeof i!="function"&&(Bn===null?Bn=new Set([this]):Bn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function ih(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new G0;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=ck.bind(null,t,e,n),e.then(t,t))}function rh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function sh(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=pn(-1,1),e.tag=2,jn(n,e,1))),n.lanes|=1),t)}var Q0=Sn.ReactCurrentOwner,nt=!1;function Ge(t,e,n,i){e.child=t===null?Hp(e,null,n,i):nr(e,t.child,n,i)}function oh(t,e,n,i,r){n=n.render;var s=e.ref;return Ki(e,r),i=Pu(t,e,n,i,s,r),n=_u(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,yn(t,e,r)):(fe&&n&&pu(e),e.flags|=1,Ge(t,e,i,r),e.child)}function ah(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Au(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ym(t,e,s,i,r)):(t=Ys(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:ts,n(o,i)&&t.ref===e.ref)return yn(t,e,r)}return e.flags|=1,t=zn(s,i),t.ref=e.ref,t.return=e,e.child=t}function ym(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(ts(s,i)&&t.ref===e.ref)if(nt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(nt=!0);else return e.lanes=t.lanes,yn(t,e,r)}return Gc(t,e,n,i,r)}function km(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},oe(Ai,lt),lt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,oe(Ai,lt),lt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,oe(Ai,lt),lt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,oe(Ai,lt),lt|=i;return Ge(t,e,r,n),e.child}function Sm(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Gc(t,e,n,i,r){var s=st(n)?li:He.current;return s=er(e,s),Ki(e,r),n=Pu(t,e,n,i,s,r),i=_u(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,yn(t,e,r)):(fe&&i&&pu(e),e.flags|=1,Ge(t,e,n,r),e.child)}function ch(t,e,n,i,r){if(st(n)){var s=!0;_o(e)}else s=!1;if(Ki(e,r),e.stateNode===null)Gs(t,e),mm(e,n,i),Hc(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=wt(l):(l=st(n)?li:He.current,l=er(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||c!==l)&&nh(e,o,i,l),Rn=!1;var h=e.memoizedState;o.state=h,Fo(e,i,o,r),c=e.memoizedState,a!==i||h!==c||rt.current||Rn?(typeof u=="function"&&(Kc(e,n,u,i),c=e.memoizedState),(a=Rn||th(e,n,a,i,h,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),o.props=i,o.state=c,o.context=l,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Gp(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:xt(e.type,a),o.props=l,d=e.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=wt(c):(c=st(n)?li:He.current,c=er(e,c));var g=n.getDerivedStateFromProps;(u=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==c)&&nh(e,o,i,c),Rn=!1,h=e.memoizedState,o.state=h,Fo(e,i,o,r);var y=e.memoizedState;a!==d||h!==y||rt.current||Rn?(typeof g=="function"&&(Kc(e,n,g,i),y=e.memoizedState),(l=Rn||th(e,n,l,i,h,y,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=c,i=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Qc(t,e,n,i,s,r)}function Qc(t,e,n,i,r,s){Sm(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&$d(e,n,!1),yn(t,e,s);i=e.stateNode,Q0.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=nr(e,t.child,null,s),e.child=nr(e,null,a,s)):Ge(t,e,a,s),e.memoizedState=i.state,r&&$d(e,n,!0),e.child}function Cm(t){var e=t.stateNode;e.pendingContext?Hd(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Hd(t,e.context,!1),Tu(t,e.containerInfo)}function lh(t,e,n,i,r){return tr(),gu(r),e.flags|=256,Ge(t,e,n,i),e.child}var Jc={dehydrated:null,treeContext:null,retryLane:0};function Yc(t){return{baseLanes:t,cachePool:null,transitions:null}}function Tm(t,e,n){var i=e.pendingProps,r=me.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),oe(me,r&1),t===null)return Wc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=aa(o,i,0,null),t=ai(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Yc(n),e.memoizedState=Jc,t):Iu(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return J0(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=zn(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=zn(a,s):(s=ai(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Yc(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Jc,i}return s=t.child,t=s.sibling,i=zn(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Iu(t,e){return e=aa({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Fs(t,e,n,i){return i!==null&&gu(i),nr(e,t.child,null,n),t=Iu(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function J0(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Wa(Error(O(422))),Fs(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=aa({mode:"visible",children:i.children},r,0,null),s=ai(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&nr(e,t.child,null,o),e.child.memoizedState=Yc(o),e.memoizedState=Jc,s);if(!(e.mode&1))return Fs(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(O(419)),i=Wa(s,i,void 0),Fs(t,e,o,i)}if(a=(o&t.childLanes)!==0,nt||a){if(i=Ae,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,vn(t,r),Ut(i,t,r,-1))}return Lu(),i=Wa(Error(O(421))),Fs(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=lk.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,dt=Un(r.nextSibling),ft=e,fe=!0,Nt=null,t!==null&&(kt[St++]=hn,kt[St++]=fn,kt[St++]=ui,hn=t.id,fn=t.overflow,ui=e),e=Iu(e,i.children),e.flags|=4096,e)}function uh(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),qc(t.return,e,n)}function qa(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function bm(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ge(t,e,i.children,n),i=me.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&uh(t,n,e);else if(t.tag===19)uh(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(oe(me,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&No(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),qa(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&No(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}qa(e,!0,n,null,s);break;case"together":qa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gs(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function yn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),hi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=zn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=zn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Y0(t,e,n){switch(e.tag){case 3:Cm(e),tr();break;case 5:Qp(e);break;case 1:st(e.type)&&_o(e);break;case 4:Tu(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;oe(Io,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(oe(me,me.current&1),e.flags|=128,null):n&e.child.childLanes?Tm(t,e,n):(oe(me,me.current&1),t=yn(t,e,n),t!==null?t.sibling:null);oe(me,me.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return bm(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),oe(me,me.current),i)break;return null;case 22:case 23:return e.lanes=0,km(t,e,n)}return yn(t,e,n)}var wm,Xc,Em,Pm;wm=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Xc=function(){};Em=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,si(Qt.current);var s=null;switch(n){case"input":r=Sc(t,r),i=Sc(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=bc(t,r),i=bc(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Eo)}Ec(n,i);var o;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Gr.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Gr.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ce("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Pm=function(t,e,n,i){n!==i&&(e.flags|=4)};function Sr(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function X0(t,e,n){var i=e.pendingProps;switch(mu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return st(e.type)&&Po(),qe(e),null;case 3:return i=e.stateNode,ir(),ue(rt),ue(He),wu(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Is(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nt!==null&&(ol(Nt),Nt=null))),Xc(t,e),qe(e),null;case 5:bu(e);var r=si(os.current);if(n=e.type,t!==null&&e.stateNode!=null)Em(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(O(166));return qe(e),null}if(t=si(Qt.current),Is(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Ht]=e,i[rs]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",i),ce("close",i);break;case"iframe":case"object":case"embed":ce("load",i);break;case"video":case"audio":for(r=0;r<Fr.length;r++)ce(Fr[r],i);break;case"source":ce("error",i);break;case"img":case"image":case"link":ce("error",i),ce("load",i);break;case"details":ce("toggle",i);break;case"input":kd(i,s),ce("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ce("invalid",i);break;case"textarea":Cd(i,s),ce("invalid",i)}Ec(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&xs(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&xs(i.textContent,a,t),r=["children",""+a]):Gr.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",i)}switch(n){case"input":Cs(i),Sd(i,s,!0);break;case"textarea":Cs(i),Td(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Eo)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ep(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Ht]=e,t[rs]=i,wm(t,e,!1,!1),e.stateNode=t;e:{switch(o=Pc(n,i),n){case"dialog":ce("cancel",t),ce("close",t),r=i;break;case"iframe":case"object":case"embed":ce("load",t),r=i;break;case"video":case"audio":for(r=0;r<Fr.length;r++)ce(Fr[r],t);r=i;break;case"source":ce("error",t),r=i;break;case"img":case"image":case"link":ce("error",t),ce("load",t),r=i;break;case"details":ce("toggle",t),r=i;break;case"input":kd(t,i),r=Sc(t,i),ce("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ce("invalid",t);break;case"textarea":Cd(t,i),r=bc(t,i),ce("invalid",t);break;default:r=i}Ec(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?ip(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&tp(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Qr(t,c):typeof c=="number"&&Qr(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Gr.hasOwnProperty(s)?c!=null&&s==="onScroll"&&ce("scroll",t):c!=null&&eu(t,s,c,o))}switch(n){case"input":Cs(t),Sd(t,i,!1);break;case"textarea":Cs(t),Td(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Hn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Vi(t,!!i.multiple,s,!1):i.defaultValue!=null&&Vi(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Eo)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qe(e),null;case 6:if(t&&e.stateNode!=null)Pm(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(O(166));if(n=si(os.current),si(Qt.current),Is(e)){if(i=e.stateNode,n=e.memoizedProps,i[Ht]=e,(s=i.nodeValue!==n)&&(t=ft,t!==null))switch(t.tag){case 3:xs(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&xs(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Ht]=e,e.stateNode=i}return qe(e),null;case 13:if(ue(me),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&dt!==null&&e.mode&1&&!(e.flags&128))qp(),tr(),e.flags|=98560,s=!1;else if(s=Is(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[Ht]=e}else tr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),s=!1}else Nt!==null&&(ol(Nt),Nt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||me.current&1?Oe===0&&(Oe=3):Lu())),e.updateQueue!==null&&(e.flags|=4),qe(e),null);case 4:return ir(),Xc(t,e),t===null&&ns(e.stateNode.containerInfo),qe(e),null;case 10:return ku(e.type._context),qe(e),null;case 17:return st(e.type)&&Po(),qe(e),null;case 19:if(ue(me),s=e.memoizedState,s===null)return qe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Sr(s,!1);else{if(Oe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=No(t),o!==null){for(e.flags|=128,Sr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return oe(me,me.current&1|2),e.child}t=t.sibling}s.tail!==null&&be()>sr&&(e.flags|=128,i=!0,Sr(s,!1),e.lanes=4194304)}else{if(!i)if(t=No(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Sr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return qe(e),null}else 2*be()-s.renderingStartTime>sr&&n!==1073741824&&(e.flags|=128,i=!0,Sr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=be(),e.sibling=null,n=me.current,oe(me,i?n&1|2:n&1),e):(qe(e),null);case 22:case 23:return Du(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?lt&1073741824&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function Z0(t,e){switch(mu(e),e.tag){case 1:return st(e.type)&&Po(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ir(),ue(rt),ue(He),wu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bu(e),null;case 13:if(ue(me),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));tr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(me),null;case 4:return ir(),null;case 10:return ku(e.type._context),null;case 22:case 23:return Du(),null;case 24:return null;default:return null}}var Ns=!1,Ke=!1,ek=typeof WeakSet=="function"?WeakSet:Set,B=null;function Li(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Se(t,e,i)}else n.current=null}function Zc(t,e,n){try{n()}catch(i){Se(t,e,i)}}var dh=!1;function tk(t,e){if(Lc=To,t=Op(),fu(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var g;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(c=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(g=d.firstChild)!==null;)h=d,d=g;for(;;){if(d===t)break t;if(h===n&&++l===r&&(a=o),h===s&&++u===i&&(c=o),(g=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=g}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ac={focusedElem:t,selectionRange:n},To=!1,B=e;B!==null;)if(e=B,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,B=t;else for(;B!==null;){e=B;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var k=y.memoizedProps,E=y.memoizedState,p=e.stateNode,m=p.getSnapshotBeforeUpdate(e.elementType===e.type?k:xt(e.type,k),E);p.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var f=e.stateNode.containerInfo;f.nodeType===1?f.textContent="":f.nodeType===9&&f.documentElement&&f.removeChild(f.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(v){Se(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}return y=dh,dh=!1,y}function zr(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Zc(e,n,s)}r=r.next}while(r!==i)}}function sa(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function el(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function _m(t){var e=t.alternate;e!==null&&(t.alternate=null,_m(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ht],delete e[rs],delete e[Bc],delete e[A0],delete e[U0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Rm(t){return t.tag===5||t.tag===3||t.tag===4}function hh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Rm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function tl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Eo));else if(i!==4&&(t=t.child,t!==null))for(tl(t,e,n),t=t.sibling;t!==null;)tl(t,e,n),t=t.sibling}function nl(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(nl(t,e,n),t=t.sibling;t!==null;)nl(t,e,n),t=t.sibling}var je=null,It=!1;function bn(t,e,n){for(n=n.child;n!==null;)xm(t,e,n),n=n.sibling}function xm(t,e,n){if(Gt&&typeof Gt.onCommitFiberUnmount=="function")try{Gt.onCommitFiberUnmount(Yo,n)}catch{}switch(n.tag){case 5:Ke||Li(n,e);case 6:var i=je,r=It;je=null,bn(t,e,n),je=i,It=r,je!==null&&(It?(t=je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):je.removeChild(n.stateNode));break;case 18:je!==null&&(It?(t=je,n=n.stateNode,t.nodeType===8?Aa(t.parentNode,n):t.nodeType===1&&Aa(t,n),Zr(t)):Aa(je,n.stateNode));break;case 4:i=je,r=It,je=n.stateNode.containerInfo,It=!0,bn(t,e,n),je=i,It=r;break;case 0:case 11:case 14:case 15:if(!Ke&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Zc(n,e,o),r=r.next}while(r!==i)}bn(t,e,n);break;case 1:if(!Ke&&(Li(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Se(n,e,a)}bn(t,e,n);break;case 21:bn(t,e,n);break;case 22:n.mode&1?(Ke=(i=Ke)||n.memoizedState!==null,bn(t,e,n),Ke=i):bn(t,e,n);break;default:bn(t,e,n)}}function fh(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ek),e.forEach(function(i){var r=uk.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Pt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:je=a.stateNode,It=!1;break e;case 3:je=a.stateNode.containerInfo,It=!0;break e;case 4:je=a.stateNode.containerInfo,It=!0;break e}a=a.return}if(je===null)throw Error(O(160));xm(s,o,r),je=null,It=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){Se(r,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Im(e,t),e=e.sibling}function Im(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pt(e,t),zt(t),i&4){try{zr(3,t,t.return),sa(3,t)}catch(k){Se(t,t.return,k)}try{zr(5,t,t.return)}catch(k){Se(t,t.return,k)}}break;case 1:Pt(e,t),zt(t),i&512&&n!==null&&Li(n,n.return);break;case 5:if(Pt(e,t),zt(t),i&512&&n!==null&&Li(n,n.return),t.flags&32){var r=t.stateNode;try{Qr(r,"")}catch(k){Se(t,t.return,k)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Xf(r,s),Pc(a,o);var l=Pc(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?ip(r,d):u==="dangerouslySetInnerHTML"?tp(r,d):u==="children"?Qr(r,d):eu(r,u,d,l)}switch(a){case"input":Cc(r,s);break;case"textarea":Zf(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?Vi(r,!!s.multiple,g,!1):h!==!!s.multiple&&(s.defaultValue!=null?Vi(r,!!s.multiple,s.defaultValue,!0):Vi(r,!!s.multiple,s.multiple?[]:"",!1))}r[rs]=s}catch(k){Se(t,t.return,k)}}break;case 6:if(Pt(e,t),zt(t),i&4){if(t.stateNode===null)throw Error(O(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(k){Se(t,t.return,k)}}break;case 3:if(Pt(e,t),zt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Zr(e.containerInfo)}catch(k){Se(t,t.return,k)}break;case 4:Pt(e,t),zt(t);break;case 13:Pt(e,t),zt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Nu=be())),i&4&&fh(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ke=(l=Ke)||u,Pt(e,t),Ke=l):Pt(e,t),zt(t),i&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(B=t,u=t.child;u!==null;){for(d=B=u;B!==null;){switch(h=B,g=h.child,h.tag){case 0:case 11:case 14:case 15:zr(4,h,h.return);break;case 1:Li(h,h.return);var y=h.stateNode;if(typeof y.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(k){Se(i,n,k)}}break;case 5:Li(h,h.return);break;case 22:if(h.memoizedState!==null){mh(d);continue}}g!==null?(g.return=h,B=g):mh(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,l?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=np("display",o))}catch(k){Se(t,t.return,k)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(k){Se(t,t.return,k)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Pt(e,t),zt(t),i&4&&fh(t);break;case 21:break;default:Pt(e,t),zt(t)}}function zt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Rm(n)){var i=n;break e}n=n.return}throw Error(O(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Qr(r,""),i.flags&=-33);var s=hh(t);nl(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=hh(t);tl(t,a,o);break;default:throw Error(O(161))}}catch(c){Se(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function nk(t,e,n){B=t,Om(t)}function Om(t,e,n){for(var i=(t.mode&1)!==0;B!==null;){var r=B,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Ns;if(!o){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Ke;a=Ns;var l=Ke;if(Ns=o,(Ke=c)&&!l)for(B=r;B!==null;)o=B,c=o.child,o.tag===22&&o.memoizedState!==null?gh(r):c!==null?(c.return=o,B=c):gh(r);for(;s!==null;)B=s,Om(s),s=s.sibling;B=r,Ns=a,Ke=l}ph(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,B=s):ph(t)}}function ph(t){for(;B!==null;){var e=B;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||sa(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ke)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:xt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Xd(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Xd(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Zr(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}Ke||e.flags&512&&el(e)}catch(h){Se(e,e.return,h)}}if(e===t){B=null;break}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}}function mh(t){for(;B!==null;){var e=B;if(e===t){B=null;break}var n=e.sibling;if(n!==null){n.return=e.return,B=n;break}B=e.return}}function gh(t){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{sa(4,e)}catch(c){Se(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){Se(e,r,c)}}var s=e.return;try{el(e)}catch(c){Se(e,s,c)}break;case 5:var o=e.return;try{el(e)}catch(c){Se(e,o,c)}}}catch(c){Se(e,e.return,c)}if(e===t){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var ik=Math.ceil,Lo=Sn.ReactCurrentDispatcher,Ou=Sn.ReactCurrentOwner,bt=Sn.ReactCurrentBatchConfig,X=0,Ae=null,_e=null,Ve=0,lt=0,Ai=Jn(0),Oe=0,us=null,hi=0,oa=0,Fu=0,Wr=null,et=null,Nu=0,sr=1/0,sn=null,Ao=!1,il=null,Bn=null,Ms=!1,Nn=null,Uo=0,qr=0,rl=null,Qs=-1,Js=0;function Je(){return X&6?be():Qs!==-1?Qs:Qs=be()}function Vn(t){return t.mode&1?X&2&&Ve!==0?Ve&-Ve:B0.transition!==null?(Js===0&&(Js=mp()),Js):(t=te,t!==0||(t=window.event,t=t===void 0?16:Tp(t.type)),t):1}function Ut(t,e,n,i){if(50<qr)throw qr=0,rl=null,Error(O(185));ms(t,n,i),(!(X&2)||t!==Ae)&&(t===Ae&&(!(X&2)&&(oa|=n),Oe===4&&In(t,Ve)),ot(t,i),n===1&&X===0&&!(e.mode&1)&&(sr=be()+500,na&&Yn()))}function ot(t,e){var n=t.callbackNode;By(t,e);var i=Co(t,t===Ae?Ve:0);if(i===0)n!==null&&Ed(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Ed(n),e===1)t.tag===0?j0(vh.bind(null,t)):Vp(vh.bind(null,t)),D0(function(){!(X&6)&&Yn()}),n=null;else{switch(gp(i)){case 1:n=su;break;case 4:n=fp;break;case 16:n=So;break;case 536870912:n=pp;break;default:n=So}n=jm(n,Fm.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Fm(t,e){if(Qs=-1,Js=0,X&6)throw Error(O(327));var n=t.callbackNode;if(Hi()&&t.callbackNode!==n)return null;var i=Co(t,t===Ae?Ve:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=jo(t,i);else{e=i;var r=X;X|=2;var s=Mm();(Ae!==t||Ve!==e)&&(sn=null,sr=be()+500,oi(t,e));do try{ok();break}catch(a){Nm(t,a)}while(1);yu(),Lo.current=s,X=r,_e!==null?e=0:(Ae=null,Ve=0,e=Oe)}if(e!==0){if(e===2&&(r=Oc(t),r!==0&&(i=r,e=sl(t,r))),e===1)throw n=us,oi(t,0),In(t,i),ot(t,be()),n;if(e===6)In(t,i);else{if(r=t.current.alternate,!(i&30)&&!rk(r)&&(e=jo(t,i),e===2&&(s=Oc(t),s!==0&&(i=s,e=sl(t,s))),e===1))throw n=us,oi(t,0),In(t,i),ot(t,be()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(O(345));case 2:ti(t,et,sn);break;case 3:if(In(t,i),(i&130023424)===i&&(e=Nu+500-be(),10<e)){if(Co(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Je(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=jc(ti.bind(null,t,et,sn),e);break}ti(t,et,sn);break;case 4:if(In(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-At(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=be()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*ik(i/1960))-i,10<i){t.timeoutHandle=jc(ti.bind(null,t,et,sn),i);break}ti(t,et,sn);break;case 5:ti(t,et,sn);break;default:throw Error(O(329))}}}return ot(t,be()),t.callbackNode===n?Fm.bind(null,t):null}function sl(t,e){var n=Wr;return t.current.memoizedState.isDehydrated&&(oi(t,e).flags|=256),t=jo(t,e),t!==2&&(e=et,et=n,e!==null&&ol(e)),t}function ol(t){et===null?et=t:et.push.apply(et,t)}function rk(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!jt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function In(t,e){for(e&=~Fu,e&=~oa,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-At(e),i=1<<n;t[n]=-1,e&=~i}}function vh(t){if(X&6)throw Error(O(327));Hi();var e=Co(t,0);if(!(e&1))return ot(t,be()),null;var n=jo(t,e);if(t.tag!==0&&n===2){var i=Oc(t);i!==0&&(e=i,n=sl(t,i))}if(n===1)throw n=us,oi(t,0),In(t,e),ot(t,be()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ti(t,et,sn),ot(t,be()),null}function Mu(t,e){var n=X;X|=1;try{return t(e)}finally{X=n,X===0&&(sr=be()+500,na&&Yn())}}function fi(t){Nn!==null&&Nn.tag===0&&!(X&6)&&Hi();var e=X;X|=1;var n=bt.transition,i=te;try{if(bt.transition=null,te=1,t)return t()}finally{te=i,bt.transition=n,X=e,!(X&6)&&Yn()}}function Du(){lt=Ai.current,ue(Ai)}function oi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,M0(n)),_e!==null)for(n=_e.return;n!==null;){var i=n;switch(mu(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Po();break;case 3:ir(),ue(rt),ue(He),wu();break;case 5:bu(i);break;case 4:ir();break;case 13:ue(me);break;case 19:ue(me);break;case 10:ku(i.type._context);break;case 22:case 23:Du()}n=n.return}if(Ae=t,_e=t=zn(t.current,null),Ve=lt=e,Oe=0,us=null,Fu=oa=hi=0,et=Wr=null,ri!==null){for(e=0;e<ri.length;e++)if(n=ri[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}ri=null}return t}function Nm(t,e){do{var n=_e;try{if(yu(),Hs.current=Do,Mo){for(var i=ge.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Mo=!1}if(di=0,Me=Ie=ge=null,Vr=!1,as=0,Ou.current=null,n===null||n.return===null){Oe=1,us=e,_e=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=Ve,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=rh(o);if(g!==null){g.flags&=-257,sh(g,o,a,s,e),g.mode&1&&ih(s,l,e),e=g,c=l;var y=e.updateQueue;if(y===null){var k=new Set;k.add(c),e.updateQueue=k}else y.add(c);break e}else{if(!(e&1)){ih(s,l,e),Lu();break e}c=Error(O(426))}}else if(fe&&a.mode&1){var E=rh(o);if(E!==null){!(E.flags&65536)&&(E.flags|=256),sh(E,o,a,s,e),gu(rr(c,a));break e}}s=c=rr(c,a),Oe!==4&&(Oe=2),Wr===null?Wr=[s]:Wr.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=gm(s,c,e);Yd(s,p);break e;case 1:a=c;var m=s.type,f=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(Bn===null||!Bn.has(f)))){s.flags|=65536,e&=-e,s.lanes|=e;var v=vm(s,a,e);Yd(s,v);break e}}s=s.return}while(s!==null)}Lm(n)}catch(C){e=C,_e===n&&n!==null&&(_e=n=n.return);continue}break}while(1)}function Mm(){var t=Lo.current;return Lo.current=Do,t===null?Do:t}function Lu(){(Oe===0||Oe===3||Oe===2)&&(Oe=4),Ae===null||!(hi&268435455)&&!(oa&268435455)||In(Ae,Ve)}function jo(t,e){var n=X;X|=2;var i=Mm();(Ae!==t||Ve!==e)&&(sn=null,oi(t,e));do try{sk();break}catch(r){Nm(t,r)}while(1);if(yu(),X=n,Lo.current=i,_e!==null)throw Error(O(261));return Ae=null,Ve=0,Oe}function sk(){for(;_e!==null;)Dm(_e)}function ok(){for(;_e!==null&&!Oy();)Dm(_e)}function Dm(t){var e=Um(t.alternate,t,lt);t.memoizedProps=t.pendingProps,e===null?Lm(t):_e=e,Ou.current=null}function Lm(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Z0(n,e),n!==null){n.flags&=32767,_e=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Oe=6,_e=null;return}}else if(n=X0(n,e,lt),n!==null){_e=n;return}if(e=e.sibling,e!==null){_e=e;return}_e=e=t}while(e!==null);Oe===0&&(Oe=5)}function ti(t,e,n){var i=te,r=bt.transition;try{bt.transition=null,te=1,ak(t,e,n,i)}finally{bt.transition=r,te=i}return null}function ak(t,e,n,i){do Hi();while(Nn!==null);if(X&6)throw Error(O(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(Vy(t,s),t===Ae&&(_e=Ae=null,Ve=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ms||(Ms=!0,jm(So,function(){return Hi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=bt.transition,bt.transition=null;var o=te;te=1;var a=X;X|=4,Ou.current=null,tk(t,n),Im(n,t),_0(Ac),To=!!Lc,Ac=Lc=null,t.current=n,nk(n),Fy(),X=a,te=o,bt.transition=s}else t.current=n;if(Ms&&(Ms=!1,Nn=t,Uo=r),s=t.pendingLanes,s===0&&(Bn=null),Dy(n.stateNode),ot(t,be()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Ao)throw Ao=!1,t=il,il=null,t;return Uo&1&&t.tag!==0&&Hi(),s=t.pendingLanes,s&1?t===rl?qr++:(qr=0,rl=t):qr=0,Yn(),null}function Hi(){if(Nn!==null){var t=gp(Uo),e=bt.transition,n=te;try{if(bt.transition=null,te=16>t?16:t,Nn===null)var i=!1;else{if(t=Nn,Nn=null,Uo=0,X&6)throw Error(O(331));var r=X;for(X|=4,B=t.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(B=l;B!==null;){var u=B;switch(u.tag){case 0:case 11:case 15:zr(8,u,s)}var d=u.child;if(d!==null)d.return=u,B=d;else for(;B!==null;){u=B;var h=u.sibling,g=u.return;if(_m(u),u===l){B=null;break}if(h!==null){h.return=g,B=h;break}B=g}}}var y=s.alternate;if(y!==null){var k=y.child;if(k!==null){y.child=null;do{var E=k.sibling;k.sibling=null,k=E}while(k!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:zr(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,B=p;break e}B=s.return}}var m=t.current;for(B=m;B!==null;){o=B;var f=o.child;if(o.subtreeFlags&2064&&f!==null)f.return=o,B=f;else e:for(o=m;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:sa(9,a)}}catch(C){Se(a,a.return,C)}if(a===o){B=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,B=v;break e}B=a.return}}if(X=r,Yn(),Gt&&typeof Gt.onPostCommitFiberRoot=="function")try{Gt.onPostCommitFiberRoot(Yo,t)}catch{}i=!0}return i}finally{te=n,bt.transition=e}}return!1}function yh(t,e,n){e=rr(n,e),e=gm(t,e,1),t=jn(t,e,1),e=Je(),t!==null&&(ms(t,1,e),ot(t,e))}function Se(t,e,n){if(t.tag===3)yh(t,t,n);else for(;e!==null;){if(e.tag===3){yh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Bn===null||!Bn.has(i))){t=rr(n,t),t=vm(e,t,1),e=jn(e,t,1),t=Je(),e!==null&&(ms(e,1,t),ot(e,t));break}}e=e.return}}function ck(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Je(),t.pingedLanes|=t.suspendedLanes&n,Ae===t&&(Ve&n)===n&&(Oe===4||Oe===3&&(Ve&130023424)===Ve&&500>be()-Nu?oi(t,0):Fu|=n),ot(t,e)}function Am(t,e){e===0&&(t.mode&1?(e=ws,ws<<=1,!(ws&130023424)&&(ws=4194304)):e=1);var n=Je();t=vn(t,e),t!==null&&(ms(t,e,n),ot(t,n))}function lk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Am(t,n)}function uk(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(e),Am(t,n)}var Um;Um=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||rt.current)nt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return nt=!1,Y0(t,e,n);nt=!!(t.flags&131072)}else nt=!1,fe&&e.flags&1048576&&zp(e,xo,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Gs(t,e),t=e.pendingProps;var r=er(e,He.current);Ki(e,n),r=Pu(null,e,i,t,r,n);var s=_u();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,st(i)?(s=!0,_o(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Cu(e),r.updater=ra,e.stateNode=r,r._reactInternals=e,Hc(e,i,t,n),e=Qc(null,e,i,!0,s,n)):(e.tag=0,fe&&s&&pu(e),Ge(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Gs(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=hk(i),t=xt(i,t),r){case 0:e=Gc(null,e,i,t,n);break e;case 1:e=ch(null,e,i,t,n);break e;case 11:e=oh(null,e,i,t,n);break e;case 14:e=ah(null,e,i,xt(i.type,t),n);break e}throw Error(O(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:xt(i,r),Gc(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:xt(i,r),ch(t,e,i,r,n);case 3:e:{if(Cm(e),t===null)throw Error(O(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Gp(t,e),Fo(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=rr(Error(O(423)),e),e=lh(t,e,i,n,r);break e}else if(i!==r){r=rr(Error(O(424)),e),e=lh(t,e,i,n,r);break e}else for(dt=Un(e.stateNode.containerInfo.firstChild),ft=e,fe=!0,Nt=null,n=Hp(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(tr(),i===r){e=yn(t,e,n);break e}Ge(t,e,i,n)}e=e.child}return e;case 5:return Qp(e),t===null&&Wc(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Uc(i,r)?o=null:s!==null&&Uc(i,s)&&(e.flags|=32),Sm(t,e),Ge(t,e,o,n),e.child;case 6:return t===null&&Wc(e),null;case 13:return Tm(t,e,n);case 4:return Tu(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=nr(e,null,i,n):Ge(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:xt(i,r),oh(t,e,i,r,n);case 7:return Ge(t,e,e.pendingProps,n),e.child;case 8:return Ge(t,e,e.pendingProps.children,n),e.child;case 12:return Ge(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,oe(Io,i._currentValue),i._currentValue=o,s!==null)if(jt(s.value,o)){if(s.children===r.children&&!rt.current){e=yn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=pn(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),qc(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),qc(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ge(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Ki(e,n),r=wt(r),i=i(r),e.flags|=1,Ge(t,e,i,n),e.child;case 14:return i=e.type,r=xt(i,e.pendingProps),r=xt(i.type,r),ah(t,e,i,r,n);case 15:return ym(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:xt(i,r),Gs(t,e),e.tag=1,st(i)?(t=!0,_o(e)):t=!1,Ki(e,n),mm(e,i,r),Hc(e,i,r,n),Qc(null,e,i,!0,t,n);case 19:return bm(t,e,n);case 22:return km(t,e,n)}throw Error(O(156,e.tag))};function jm(t,e){return hp(t,e)}function dk(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tt(t,e,n,i){return new dk(t,e,n,i)}function Au(t){return t=t.prototype,!(!t||!t.isReactComponent)}function hk(t){if(typeof t=="function")return Au(t)?1:0;if(t!=null){if(t=t.$$typeof,t===nu)return 11;if(t===iu)return 14}return 2}function zn(t,e){var n=t.alternate;return n===null?(n=Tt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ys(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Au(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case _i:return ai(n.children,r,s,e);case tu:o=8,r|=8;break;case gc:return t=Tt(12,n,e,r|2),t.elementType=gc,t.lanes=s,t;case vc:return t=Tt(13,n,e,r),t.elementType=vc,t.lanes=s,t;case yc:return t=Tt(19,n,e,r),t.elementType=yc,t.lanes=s,t;case Qf:return aa(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $f:o=10;break e;case Gf:o=9;break e;case nu:o=11;break e;case iu:o=14;break e;case _n:o=16,i=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=Tt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function ai(t,e,n,i){return t=Tt(7,t,i,e),t.lanes=n,t}function aa(t,e,n,i){return t=Tt(22,t,i,e),t.elementType=Qf,t.lanes=n,t.stateNode={isHidden:!1},t}function Ka(t,e,n){return t=Tt(6,t,null,e),t.lanes=n,t}function Ha(t,e,n){return e=Tt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function fk(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pa(0),this.expirationTimes=Pa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pa(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uu(t,e,n,i,r,s,o,a,c){return t=new fk(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Tt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cu(s),t}function pk(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Bm(t){if(!t)return $n;t=t._reactInternals;e:{if(yi(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(st(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(st(n))return Bp(t,n,e)}return e}function Vm(t,e,n,i,r,s,o,a,c){return t=Uu(n,i,!0,t,r,s,o,a,c),t.context=Bm(null),n=t.current,i=Je(),r=Vn(n),s=pn(i,r),s.callback=e??null,jn(n,s,r),t.current.lanes=r,ms(t,r,i),ot(t,i),t}function ca(t,e,n,i){var r=e.current,s=Je(),o=Vn(r);return n=Bm(n),e.context===null?e.context=n:e.pendingContext=n,e=pn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=jn(r,e,o),t!==null&&(Ut(t,r,o,s),Ks(t,r,o)),o}function Bo(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function kh(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ju(t,e){kh(t,e),(t=t.alternate)&&kh(t,e)}function mk(){return null}var zm=typeof reportError=="function"?reportError:function(t){console.error(t)};function Bu(t){this._internalRoot=t}la.prototype.render=Bu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));ca(t,e,null,null)};la.prototype.unmount=Bu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fi(function(){ca(null,t,null,null)}),e[gn]=null}};function la(t){this._internalRoot=t}la.prototype.unstable_scheduleHydration=function(t){if(t){var e=kp();t={blockedOn:null,target:t,priority:e};for(var n=0;n<xn.length&&e!==0&&e<xn[n].priority;n++);xn.splice(n,0,t),n===0&&Cp(t)}};function Vu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ua(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Sh(){}function gk(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var l=Bo(o);s.call(l)}}var o=Vm(e,i,t,0,null,!1,!1,"",Sh);return t._reactRootContainer=o,t[gn]=o.current,ns(t.nodeType===8?t.parentNode:t),fi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=Bo(c);a.call(l)}}var c=Uu(t,0,!1,null,null,!1,!1,"",Sh);return t._reactRootContainer=c,t[gn]=c.current,ns(t.nodeType===8?t.parentNode:t),fi(function(){ca(e,c,n,i)}),c}function da(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var c=Bo(o);a.call(c)}}ca(e,o,t,r)}else o=gk(n,e,t,r,i);return Bo(o)}vp=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Or(e.pendingLanes);n!==0&&(ou(e,n|1),ot(e,be()),!(X&6)&&(sr=be()+500,Yn()))}break;case 13:fi(function(){var i=vn(t,1);if(i!==null){var r=Je();Ut(i,t,1,r)}}),ju(t,1)}};au=function(t){if(t.tag===13){var e=vn(t,134217728);if(e!==null){var n=Je();Ut(e,t,134217728,n)}ju(t,134217728)}};yp=function(t){if(t.tag===13){var e=Vn(t),n=vn(t,e);if(n!==null){var i=Je();Ut(n,t,e,i)}ju(t,e)}};kp=function(){return te};Sp=function(t,e){var n=te;try{return te=t,e()}finally{te=n}};Rc=function(t,e,n){switch(e){case"input":if(Cc(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=ta(i);if(!r)throw Error(O(90));Yf(i),Cc(i,r)}}}break;case"textarea":Zf(t,n);break;case"select":e=n.value,e!=null&&Vi(t,!!n.multiple,e,!1)}};op=Mu;ap=fi;var vk={usingClientEntryPoint:!1,Events:[vs,Oi,ta,rp,sp,Mu]},Cr={findFiberByHostInstance:ii,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yk={bundleType:Cr.bundleType,version:Cr.version,rendererPackageName:Cr.rendererPackageName,rendererConfig:Cr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=up(t),t===null?null:t.stateNode},findFiberByHostInstance:Cr.findFiberByHostInstance||mk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ds=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ds.isDisabled&&Ds.supportsFiber)try{Yo=Ds.inject(yk),Gt=Ds}catch{}}gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vk;gt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vu(e))throw Error(O(200));return pk(t,e,null,n)};gt.createRoot=function(t,e){if(!Vu(t))throw Error(O(299));var n=!1,i="",r=zm;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Uu(t,1,!1,null,null,n,!1,i,r),t[gn]=e.current,ns(t.nodeType===8?t.parentNode:t),new Bu(e)};gt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=up(e),t=t===null?null:t.stateNode,t};gt.flushSync=function(t){return fi(t)};gt.hydrate=function(t,e,n){if(!ua(e))throw Error(O(200));return da(null,t,e,!0,n)};gt.hydrateRoot=function(t,e,n){if(!Vu(t))throw Error(O(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=zm;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Vm(e,null,t,1,n??null,r,!1,s,o),t[gn]=e.current,ns(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new la(e)};gt.render=function(t,e,n){if(!ua(e))throw Error(O(200));return da(null,t,e,!1,n)};gt.unmountComponentAtNode=function(t){if(!ua(t))throw Error(O(40));return t._reactRootContainer?(fi(function(){da(null,null,t,!1,function(){t._reactRootContainer=null,t[gn]=null})}),!0):!1};gt.unstable_batchedUpdates=Mu;gt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!ua(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return da(t,e,n,!1,i)};gt.version="18.3.1-next-f1338f8080-20240426";function Wm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Wm)}catch(t){console.error(t)}}Wm(),Wf.exports=gt;var kk=Wf.exports,Ch=kk;pc.createRoot=Ch.createRoot,pc.hydrateRoot=Ch.hydrateRoot;function Sk(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var Ck=Object.defineProperty,Tk=(t,e,n)=>e in t?Ck(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Th=(t,e,n)=>Tk(t,typeof e!="symbol"?e+"":e,n);class Qe{constructor(){Th(this,"_locking"),Th(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function Ce(t,e){if(!t)throw new Error(e)}const bk=34028234663852886e22,wk=-34028234663852886e22,Ek=4294967295,Pk=2147483647,_k=-2147483648;function Xs(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>Pk||t<_k)throw new Error("invalid int 32: "+t)}function al(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Ek||t<0)throw new Error("invalid uint 32: "+t)}function qm(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>bk||t<wk))throw new Error("invalid float 32: "+t)}const Km=Symbol("@bufbuild/protobuf/enum-type");function Rk(t){const e=t[Km];return Ce(e,"missing enum type on enum object"),e}function Hm(t,e,n,i){t[Km]=$m(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function $m(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=Gm(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function xk(t,e,n){const i={};for(const r of e){const s=Gm(r);i[s.localName]=s.no,i[s.no]=s.localName}return Hm(i,t,e),i}function Gm(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class zu{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Ik(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new zu),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function Ok(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function $a(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const Zs=4294967296;function bh(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const c=Number(t.slice(o,a));r*=n,i=i*n+c,i>=Zs&&(r=r+(i/Zs|0),i=i%Zs)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Jm(i,r):Wu(i,r)}function Fk(t,e){let n=Wu(t,e);const i=n.hi&2147483648;i&&(n=Jm(n.lo,n.hi));const r=Qm(n.lo,n.hi);return i?"-"+r:r}function Qm(t,e){if({lo:t,hi:e}=Nk(t,e),e<=2097151)return String(Zs*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+wh(o)+wh(s)}function Nk(t,e){return{lo:t>>>0,hi:e>>>0}}function Wu(t,e){return{lo:t|0,hi:e|0}}function Jm(t,e){return e=~e,t?t=~t+1:e+=1,Wu(t,e)}const wh=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Eh(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Mk(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Dk(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>Ce(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Ce(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),bh(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),bh(r)},dec(r,s){return Fk(r,s)},uDec(r,s){return Qm(r,s)}}}const pe=Dk();var R;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(R||(R={}));var Gn;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Gn||(Gn={}));function wn(t,e,n){if(e===n)return!0;if(t==R.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return e==n}return!1}function or(t,e){switch(t){case R.BOOL:return!1;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return e==0?pe.zero:"0";case R.DOUBLE:case R.FLOAT:return 0;case R.BYTES:return new Uint8Array(0);case R.STRING:return"";default:return 0}}function Ym(t,e){switch(t){case R.BOOL:return e===!1;case R.STRING:return e==="";case R.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var we;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(we||(we={}));class Lk{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(al(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Xs(e),Eh(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){qm(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){al(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Xs(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Xs(e),e=(e<<1^e>>31)>>>0,Eh(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=pe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=pe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=pe.enc(e);return $a(n.lo,n.hi,this.buf),this}sint64(e){let n=pe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return $a(r,s,this.buf),this}uint64(e){let n=pe.uEnc(e);return $a(n.lo,n.hi,this.buf),this}}class Ak{constructor(e,n){this.varint64=Ok,this.uint32=Mk,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case we.Varint:for(;this.buf[this.pos++]&128;);break;case we.Bit64:this.pos+=4;case we.Bit32:this.pos+=4;break;case we.LengthDelimited:let r=this.uint32();this.pos+=r;break;case we.StartGroup:for(;;){const[s,o]=this.tag();if(o===we.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return pe.dec(...this.varint64())}uint64(){return pe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,pe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return pe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return pe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Uk(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function Xm(t){const e=t.field.localName,n=Object.create(null);return n[e]=jk(t),[n,()=>n[e]]}function jk(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return or(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Bk(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let cn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ha=[];for(let t=0;t<cn.length;t++)ha[cn[t].charCodeAt(0)]=t;ha["-".charCodeAt(0)]=cn.indexOf("+");ha["_".charCodeAt(0)]=cn.indexOf("/");const Zm={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=ha[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=cn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=cn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=cn[r|i>>6],e+=cn[i&63],n=0;break}return n&&(e+=cn[r],e+="=",n==1&&(e+="=")),e}};function Vk(t,e,n){tg(e,t);const i=e.runtime.bin.makeReadOptions(n),r=Bk(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Xm(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function zk(t,e,n,i){tg(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(eg(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function eg(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function tg(t,e){Ce(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function ng(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Ym(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Ph(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?or(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ln(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(zu.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function ig(t,e){return ln(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}R.DOUBLE,R.FLOAT,R.INT64,R.UINT64,R.INT32,R.UINT32,R.BOOL,R.STRING,R.BYTES;const _h={ignoreUnknownFields:!1},Rh={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Wk(t){return t?Object.assign(Object.assign({},_h),t):_h}function qk(t){return t?Object.assign(Object.assign({},Rh),t):Rh}const Vo=Symbol(),eo=Symbol();function Kk(){return{makeReadOptions:Wk,makeWriteOptions:qk,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Kt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));r.set(c.oneof,o)}xh(i,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,h]=Xm(u);xh(d,a,u.field,n,u),zk(i,u,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!ng(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!$k(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Ih(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&eg(t,a)){const c=Vk(t,a,e),l=Ih(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Kr(t,e,n??Gn.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Ym(t,e)))return to(t,e)},debug:Kt}}function Kt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function xh(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Ce(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=Ga(n.T,a,i.ignoreUnknownFields,!0);c!==eo&&o.push(c);break;case"scalar":try{o.push(Kr(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=Hk(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,i);break;case"enum":const u=Ga(n.V.T,c,i.ignoreUnknownFields,!0);u!==eo&&(o[l]=u);break;case"scalar":try{o[l]=Kr(n.V.T,c,Gn.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];ln(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Ga(n.T,e,i.ignoreUnknownFields,!1);switch(c){case Vo:Ph(n,t);break;case eo:break;default:t[s]=c;break}break;case"scalar":try{const l=Kr(n.T,e,n.L,!1);switch(l){case Vo:Ph(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Kt(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function Hk(t,e){if(t===R.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Kr(t,e,Gn.BIGINT,!0).toString()}function Kr(t,e,n,i){if(e===null)return i?or(t,n):Vo;switch(t){case R.DOUBLE:case R.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==R.FLOAT&&qm(r),r;case R.INT32:case R.FIXED32:case R.SFIXED32:case R.SINT32:case R.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==R.UINT32||t==R.FIXED32?al(s):Xs(s),s;case R.INT64:case R.SFIXED64:case R.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=pe.parse(e);return n?o.toString():o;case R.FIXED64:case R.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=pe.uParse(e);return n?a.toString():a;case R.BOOL:if(typeof e!="boolean")break;return e;case R.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case R.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Zm.dec(e)}throw new Error}function Ga(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Vo;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return eo;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Kt(e)))}function $k(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Ih(t,e,n){if(t.kind=="map"){Ce(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=to(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Qa(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Ce(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(to(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Qa(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return to(t.T,e);case"enum":return Qa(t.T,e,n.enumAsInteger);case"message":return ig(t.T,e).toJson(n)}}function Qa(t,e,n){var i;if(Ce(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function to(t,e){switch(t){case R.INT32:case R.SFIXED32:case R.SINT32:case R.FIXED32:case R.UINT32:return Ce(typeof e=="number"),e;case R.FLOAT:case R.DOUBLE:return Ce(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case R.STRING:return Ce(typeof e=="string"),e;case R.BOOL:return Ce(typeof e=="boolean"),e;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return Ce(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case R.BYTES:return Ce(e instanceof Uint8Array),Zm.enc(e)}}const bi=Symbol("@bufbuild/protobuf/unknown-fields"),Oh={readUnknownFields:!0,readerFactory:t=>new Ak(t)},Fh={writeUnknownFields:!0,writerFactory:()=>new Lk};function Gk(t){return t?Object.assign(Object.assign({},Oh),t):Oh}function Qk(t){return t?Object.assign(Object.assign({},Fh),t):Fh}function Jk(){return{makeReadOptions:Gk,makeWriteOptions:Qk,listUnknownFields(t){var e;return(e=t[bi])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[bi]},writeUnknownFields(t,e){const i=t[bi];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[bi])||(r[bi]=[]),r[bi].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(r===!0&&c==we.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Nh(t,e,l,c,i)}if(r&&(c!=we.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Nh,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!ng(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Mh(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Mh(t,e,n,i)}}}function Nh(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?R.INT32:n.T;let c=zo;if(n.kind=="scalar"&&n.L>0&&(c=Xk),s){let h=t[o];if(i==we.LengthDelimited&&a!=R.STRING&&a!=R.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)h.push(c(e,a))}else h.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(no(e,new l,r,n)):ln(t[o])?no(e,t[o],r,n):(t[o]=no(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=Yk(n,e,r);t[o][u]=d;break}}function no(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function Yk(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=zo(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=zo(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=no(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=or(t.K,Gn.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=or(t.V.T,Gn.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function Xk(t,e){const n=zo(t,e);return typeof n=="bigint"?n.toString():n}function zo(t,e){switch(e){case R.STRING:return t.string();case R.BOOL:return t.bool();case R.DOUBLE:return t.double();case R.FLOAT:return t.float();case R.INT32:return t.int32();case R.INT64:return t.int64();case R.UINT64:return t.uint64();case R.FIXED64:return t.fixed64();case R.BYTES:return t.bytes();case R.FIXED32:return t.fixed32();case R.SFIXED32:return t.sfixed32();case R.SFIXED64:return t.sfixed64();case R.SINT64:return t.sint64();case R.UINT32:return t.uint32();case R.SINT32:return t.sint32()}}function Mh(t,e,n,i){Ce(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?R.INT32:t.T;if(r)if(Ce(Array.isArray(e)),t.packed)eS(n,s,t.no,e);else for(const o of e)Hr(n,s,t.no,o);else Hr(n,s,t.no,e);break;case"message":if(r){Ce(Array.isArray(e));for(const o of e)Dh(n,i,t,o)}else Dh(n,i,t,e);break;case"map":Ce(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))Zk(n,i,t,o,a);break}}function Zk(t,e,n,i,r){t.tag(n.no,we.LengthDelimited),t.fork();let s=i;switch(n.K){case R.INT32:case R.FIXED32:case R.UINT32:case R.SFIXED32:case R.SINT32:s=Number.parseInt(i);break;case R.BOOL:Ce(i=="true"||i=="false"),s=i=="true";break}switch(Hr(t,n.K,1,s),n.V.kind){case"scalar":Hr(t,n.V.T,2,r);break;case"enum":Hr(t,R.INT32,2,r);break;case"message":Ce(r!==void 0),t.tag(2,we.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Dh(t,e,n,i){const r=ig(n.T,i);n.delimited?t.tag(n.no,we.StartGroup).raw(r.toBinary(e)).tag(n.no,we.EndGroup):t.tag(n.no,we.LengthDelimited).bytes(r.toBinary(e))}function Hr(t,e,n,i){Ce(i!==void 0);let[r,s]=rg(e);t.tag(n,r)[s](i)}function eS(t,e,n,i){if(!i.length)return;t.tag(n,we.LengthDelimited).fork();let[,r]=rg(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function rg(t){let e=we.Varint;switch(t){case R.BYTES:case R.STRING:e=we.LengthDelimited;break;case R.DOUBLE:case R.FIXED64:case R.SFIXED64:e=we.Bit64;break;case R.FIXED32:case R.SFIXED32:case R.FLOAT:e=we.Bit32;break}const n=R[t].toLowerCase();return[e,n]}function tS(){return{setEnumType:Hm,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const c=i.findField(a);let l=o[r].value;c&&c.kind=="message"&&!ln(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===R.BYTES&&(l=Tr(l)),s[r]={case:a,value:l};break;case"scalar":case"enum":let u=o[r];i.T===R.BYTES&&(u=i.repeated?u.map(Tr):Tr(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===R.BYTES)for(const[g,y]of Object.entries(o[r]))s[r][g]=Tr(y);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const g of Object.keys(o[r])){let y=o[r][g];h.fieldWrapper||(y=new h(y)),s[r][g]=y}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>ln(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=Tr(h):s[r]=h:s[r]=ln(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>wn(i.T,o,s[a]));case"enum":return r.every((o,a)=>wn(R.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!ln(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!ln(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return wn(R.INT32,r,s);case"scalar":return wn(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,s.value);case"enum":return wn(R.INT32,r.value,s.value);case"scalar":return wn(c.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return l.every(h=>u.equals(r[h],s[h]));case"enum":return l.every(h=>wn(R.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return l.every(h=>wn(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(Ls);else if(r.kind=="map"){o=i[r.localName];for(const[a,c]of Object.entries(s))o[a]=Ls(c)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:Ls(s.value)}:{case:void 0}:o=Ls(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Ls(t){if(t===void 0)return t;if(ln(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Tr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function nS(t,e,n){return{syntax:t,json:Kk(),bin:Jk(),util:Object.assign(Object.assign({},tS()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return Ik(this,i,r,s)},makeEnum:xk,makeEnumType:$m,getEnumType:Rk,makeExtension(i,r,s){return Uk(this,i,r,s)}}}class iS{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function sg(t,e){const n=og(t);return e?n:lS(cS(n))}function rS(t){return sg(t,!1)}const sS=og;function og(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const oS=new Set(["constructor","toString","toJSON","valueOf"]),aS=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ag=t=>"".concat(t,"$"),cS=t=>aS.has(t)?ag(t):t,lS=t=>oS.has(t)?ag(t):t;class uS{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=rS(e)}addField(e){Ce(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function dS(t,e){var n,i,r,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=sg(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:sS(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:Gn.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=R.BYTES&&u.T!=R.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=h)&&(l=new uS(h)),d.oneof=l,l.addField(d)}c.push(d)}return c}const w=nS("proto3",t=>new iS(t,e=>dS(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=or(e.T,e.L);break}}});class tt extends zu{constructor(e){super(),this.seconds=pe.zero,this.nanos=0,w.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(w.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=pe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return tt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new tt({seconds:pe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new tt().fromBinary(e,n)}static fromJson(e,n){return new tt().fromJson(e,n)}static fromJsonString(e,n){return new tt().fromJsonString(e,n)}static equals(e,n){return w.util.equals(tt,e,n)}}tt.runtime=w;tt.typeName="google.protobuf.Timestamp";tt.fields=w.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const hS=w.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:tt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:fS,repeated:!0},{no:5,name:"events",kind:"message",T:mS,repeated:!0}]),fS=w.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:pS,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),pS=w.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:tt},{no:3,name:"value",kind:"scalar",T:2}]),mS=w.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:tt},{no:7,name:"normalized_end_timestamp",kind:"message",T:tt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),cg=w.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Mt=w.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Pe=w.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),qu=w.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Nr=w.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ds=w.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Lt=w.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),wi=w.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),gS=w.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),De=w.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),fa=w.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Wo,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Cg}]),Wo=w.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),vS=w.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:w.getEnumType(Pe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),pi=w.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType($i)},{no:4,name:"tracks",kind:"message",T:Ui,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:vS},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:w.getEnumType(hs)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:w.getEnumType(Lt)},{no:18,name:"kind_details",kind:"enum",T:w.getEnumType(yS),repeated:!0}]),$i=w.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),hs=w.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),yS=w.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),ut=w.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),kS=w.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ci,repeated:!0}]),Ui=w.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:w.getEnumType(Mt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:w.getEnumType(Pe)},{no:10,name:"layers",kind:"message",T:ci,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:kS,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:w.getEnumType(ut)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Cg},{no:19,name:"audio_features",kind:"enum",T:w.getEnumType(De),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(cg)}]),ci=w.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(qu)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ze=w.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:w.getEnumType(H)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:ug,oneof:"value"},{no:3,name:"speaker",kind:"message",T:SS,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:dg,oneof:"value"},{no:7,name:"transcription",kind:"message",T:CS,oneof:"value"},{no:8,name:"metrics",kind:"message",T:hS,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:cl,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:hg,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:fg,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:pg,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:ul,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:dl,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:hl,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),H=w.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),SS=w.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:lg,repeated:!0}]),lg=w.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),ug=w.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),dg=w.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),CS=w.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:TS,repeated:!0}]),TS=w.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),cl=w.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),hg=w.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),fg=w.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),pg=w.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:mg,oneof:"value"}]),mg=w.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),gg=w.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),vg=w.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:w.getEnumType(yg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),yg=w.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),bS=w.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:w.getEnumType(kg)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),kg=w.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Sg=w.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Lh},{no:2,name:"screen",kind:"message",T:Lh},{no:3,name:"resume_connection",kind:"enum",T:w.getEnumType(ds)},{no:4,name:"disabled_codecs",kind:"message",T:wS},{no:5,name:"force_relay",kind:"enum",T:w.getEnumType(ds)}]),Lh=w.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:w.getEnumType(ds)}]),wS=w.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Wo,repeated:!0},{no:2,name:"publish",kind:"message",T:Wo,repeated:!0}]),Cg=w.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),ll=w.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Tg=w.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:w.getEnumType(ll)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),bg=w.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),ul=w.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:w.getEnumType(ut)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Tg,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:bg,oneof:"content_header"}],{localName:"DataStream_Header"}),dl=w.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),hl=w.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Dt=w.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),fl=w.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),ES=w.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),PS=w.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:mi,oneof:"message"},{no:2,name:"answer",kind:"message",T:mi,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Ku,oneof:"message"},{no:4,name:"add_track",kind:"message",T:ml,oneof:"message"},{no:5,name:"mute",kind:"message",T:Hu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:pa,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:wg,oneof:"message"},{no:8,name:"leave",kind:"message",T:ma,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Pg,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Ig,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Og,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Wt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:_g,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Mg,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Eg,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:OS,oneof:"message"}]),Ah=w.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:_S,oneof:"message"},{no:2,name:"answer",kind:"message",T:mi,oneof:"message"},{no:3,name:"offer",kind:"message",T:mi,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Ku,oneof:"message"},{no:5,name:"update",kind:"message",T:IS,oneof:"message"},{no:6,name:"track_published",kind:"message",T:$u,oneof:"message"},{no:8,name:"leave",kind:"message",T:ma,oneof:"message"},{no:9,name:"mute",kind:"message",T:Hu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:FS,oneof:"message"},{no:11,name:"room_update",kind:"message",T:NS,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:DS,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:AS,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:jS,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:BS,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:xS,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:RS,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:zS,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:KS,oneof:"message"},{no:22,name:"request_response",kind:"message",T:HS,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:$S,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:VS,oneof:"message"}]),pl=w.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),ml=w.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:w.getEnumType(Mt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:w.getEnumType(Pe)},{no:9,name:"layers",kind:"message",T:ci,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:pl,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:w.getEnumType(ut)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(cg)},{no:17,name:"audio_features",kind:"enum",T:w.getEnumType(De),repeated:!0}]),Ku=w.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:w.getEnumType(Dt)},{no:3,name:"final",kind:"scalar",T:8}]),Hu=w.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),_S=w.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:fa},{no:2,name:"participant",kind:"message",T:pi},{no:3,name:"other_participants",kind:"message",T:pi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Rg,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Sg},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:vg},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Wo,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),RS=w.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Rg,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Sg},{no:3,name:"server_info",kind:"message",T:vg},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),$u=w.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ui}]),xS=w.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),mi=w.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),IS=w.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:pi,repeated:!0}]),pa=w.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:gg,repeated:!0}]),wg=w.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:w.getEnumType(qu)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Eg=w.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:w.getEnumType(De),repeated:!0}]),OS=w.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ma=w.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:w.getEnumType(Lt)},{no:3,name:"action",kind:"enum",T:w.getEnumType(Gi)},{no:4,name:"regions",kind:"message",T:WS}]),Gi=w.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Pg=w.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ci,repeated:!0}]),_g=w.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Rg=w.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),FS=w.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:lg,repeated:!0}]),NS=w.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:fa}]),MS=w.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:w.getEnumType(Nr)},{no:3,name:"score",kind:"scalar",T:2}]),DS=w.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:MS,repeated:!0}]),LS=w.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(fl)}]),AS=w.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:LS,repeated:!0}]),Gu=w.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(qu)},{no:2,name:"enabled",kind:"scalar",T:8}]),US=w.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Gu,repeated:!0}]),jS=w.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Gu,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:US,repeated:!0}]),xg=w.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Ig=w.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:xg,repeated:!0}]),BS=w.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),VS=w.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:fa},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:pi},{no:4,name:"other_participants",kind:"message",T:pi,repeated:!0}]),Og=w.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:mi},{no:2,name:"subscription",kind:"message",T:pa},{no:3,name:"publish_tracks",kind:"message",T:$u,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Ng,repeated:!0},{no:5,name:"offer",kind:"message",T:mi},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Fg,repeated:!0}]),Fg=w.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Ng=w.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:w.getEnumType(Dt)}]),Wt=w.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:w.getEnumType(ES),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Mg=w.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),zS=w.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),WS=w.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:qS,repeated:!0}]),qS=w.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),KS=w.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:w.getEnumType(gS)}]),HS=w.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:w.getEnumType(Qu)},{no:3,name:"message",kind:"scalar",T:9}]),Qu=w.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),$S=w.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function GS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var io={exports:{}},QS=io.exports,Uh;function JS(){return Uh||(Uh=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(QS,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(k,E){var p=k[E];if(typeof p.bind=="function")return p.bind(k);try{return Function.prototype.bind.call(p,k)}catch{return function(){return Function.prototype.apply.apply(p,[k,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(k){return k==="debug"&&(k="log"),typeof console===n?!1:k==="trace"&&i?c:console[k]!==void 0?a(console,k):console.log!==void 0?a(console,"log"):e}function u(){for(var k=this.getLevel(),E=0;E<r.length;E++){var p=r[E];this[p]=E<k?e:this.methodFactory(p,k,this.name)}if(this.log=this.debug,typeof console===n&&k<this.levels.SILENT)return"No console available for logging"}function d(k){return function(){typeof console!==n&&(u.call(this),this[k].apply(this,arguments))}}function h(k,E,p){return l(k)||d.apply(this,arguments)}function g(k,E){var p=this,m,f,v,C="loglevel";typeof k=="string"?C+=":"+k:typeof k=="symbol"&&(C=void 0);function b(j){var K=(r[j]||"silent").toUpperCase();if(!(typeof window===n||!C)){try{window.localStorage[C]=K;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+K+";"}catch{}}}function P(){var j;if(!(typeof window===n||!C)){try{j=window.localStorage[C]}catch{}if(typeof j===n)try{var K=window.document.cookie,de=encodeURIComponent(C),Ue=K.indexOf(de+"=");Ue!==-1&&(j=/^([^;]+)/.exec(K.slice(Ue+de.length+1))[1])}catch{}return p.levels[j]===void 0&&(j=void 0),j}}function _(){if(!(typeof window===n||!C)){try{window.localStorage.removeItem(C)}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(j){var K=j;if(typeof K=="string"&&p.levels[K.toUpperCase()]!==void 0&&(K=p.levels[K.toUpperCase()]),typeof K=="number"&&K>=0&&K<=p.levels.SILENT)return K;throw new TypeError("log.setLevel() called with invalid level: "+j)}p.name=k,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=E||h,p.getLevel=function(){return v??f??m},p.setLevel=function(j,K){return v=N(j),K!==!1&&b(v),u.call(p)},p.setDefaultLevel=function(j){f=N(j),P()||p.setLevel(j,!1)},p.resetLevel=function(){v=null,_(),u.call(p)},p.enableAll=function(j){p.setLevel(p.levels.TRACE,j)},p.disableAll=function(j){p.setLevel(p.levels.SILENT,j)},p.rebuild=function(){if(o!==p&&(m=N(o.getLevel())),u.call(p),o===p)for(var j in s)s[j].rebuild()},m=N(o?o.getLevel():"WARN");var I=P();I!=null&&(v=N(I)),u.call(p)}o=new g,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var p=s[E];return p||(p=s[E]=new g(E,o.methodFactory)),p};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})}(io)),io.exports}var ga=JS(),gl;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(gl||(gl={}));var Bt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Bt||(Bt={}));let J=ga.getLogger("livekit");Object.values(Bt).map(t=>ga.getLogger(t));J.setDefaultLevel(gl.info);function kn(t){const e=ga.getLogger(t);return e.setDefaultLevel(J.getLevel()),e}const YS=ga.getLogger("lk-e2ee"),br=7e3,XS=[0,300,2*2*300,3*3*300,4*4*300,br,br,br,br,br];class ZS{constructor(e){this._retryDelays=e!==void 0?[...e]:XS}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function eC(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function S(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function jh(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function un(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof jh=="function"?jh(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var As={exports:{}},Bh;function tC(){if(Bh)return As.exports;Bh=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(C,b,P){return Function.prototype.apply.call(C,b,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:n=function(C){return Object.getOwnPropertyNames(C)};function i(v){console&&console.warn&&console.warn(v)}var r=Number.isNaN||function(C){return C!==C};function s(){s.init.call(this)}As.exports=s,As.exports.once=p,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");o=v}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(C){if(typeof C!="number"||C<0||r(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this};function c(v){return v._maxListeners===void 0?s.defaultMaxListeners:v._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(C){for(var b=[],P=1;P<arguments.length;P++)b.push(arguments[P]);var _=C==="error",N=this._events;if(N!==void 0)_=_&&N.error===void 0;else if(!_)return!1;if(_){var I;if(b.length>0&&(I=b[0]),I instanceof Error)throw I;var j=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw j.context=I,j}var K=N[C];if(K===void 0)return!1;if(typeof K=="function")e(K,this,b);else for(var de=K.length,Ue=y(K,de),P=0;P<de;++P)e(Ue[P],this,b);return!0};function l(v,C,b,P){var _,N,I;if(a(b),N=v._events,N===void 0?(N=v._events=Object.create(null),v._eventsCount=0):(N.newListener!==void 0&&(v.emit("newListener",C,b.listener?b.listener:b),N=v._events),I=N[C]),I===void 0)I=N[C]=b,++v._eventsCount;else if(typeof I=="function"?I=N[C]=P?[b,I]:[I,b]:P?I.unshift(b):I.push(b),_=c(v),_>0&&I.length>_&&!I.warned){I.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=v,j.type=C,j.count=I.length,i(j)}return v}s.prototype.addListener=function(C,b){return l(this,C,b,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(C,b){return l(this,C,b,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(v,C,b){var P={fired:!1,wrapFn:void 0,target:v,type:C,listener:b},_=u.bind(P);return _.listener=b,P.wrapFn=_,_}s.prototype.once=function(C,b){return a(b),this.on(C,d(this,C,b)),this},s.prototype.prependOnceListener=function(C,b){return a(b),this.prependListener(C,d(this,C,b)),this},s.prototype.removeListener=function(C,b){var P,_,N,I,j;if(a(b),_=this._events,_===void 0)return this;if(P=_[C],P===void 0)return this;if(P===b||P.listener===b)--this._eventsCount===0?this._events=Object.create(null):(delete _[C],_.removeListener&&this.emit("removeListener",C,P.listener||b));else if(typeof P!="function"){for(N=-1,I=P.length-1;I>=0;I--)if(P[I]===b||P[I].listener===b){j=P[I].listener,N=I;break}if(N<0)return this;N===0?P.shift():k(P,N),P.length===1&&(_[C]=P[0]),_.removeListener!==void 0&&this.emit("removeListener",C,j||b)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(C){var b,P,_;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[C]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[C]),this;if(arguments.length===0){var N=Object.keys(P),I;for(_=0;_<N.length;++_)I=N[_],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(b=P[C],typeof b=="function")this.removeListener(C,b);else if(b!==void 0)for(_=b.length-1;_>=0;_--)this.removeListener(C,b[_]);return this};function h(v,C,b){var P=v._events;if(P===void 0)return[];var _=P[C];return _===void 0?[]:typeof _=="function"?b?[_.listener||_]:[_]:b?E(_):y(_,_.length)}s.prototype.listeners=function(C){return h(this,C,!0)},s.prototype.rawListeners=function(C){return h(this,C,!1)},s.listenerCount=function(v,C){return typeof v.listenerCount=="function"?v.listenerCount(C):g.call(v,C)},s.prototype.listenerCount=g;function g(v){var C=this._events;if(C!==void 0){var b=C[v];if(typeof b=="function")return 1;if(b!==void 0)return b.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(v,C){for(var b=new Array(C),P=0;P<C;++P)b[P]=v[P];return b}function k(v,C){for(;C+1<v.length;C++)v[C]=v[C+1];v.pop()}function E(v){for(var C=new Array(v.length),b=0;b<C.length;++b)C[b]=v[b].listener||v[b];return C}function p(v,C){return new Promise(function(b,P){function _(I){v.removeListener(C,N),P(I)}function N(){typeof v.removeListener=="function"&&v.removeListener("error",_),b([].slice.call(arguments))}f(v,C,N,{once:!0}),C!=="error"&&m(v,_,{once:!0})})}function m(v,C,b){typeof v.on=="function"&&f(v,"error",C,b)}function f(v,C,b,P){if(typeof v.on=="function")P.once?v.once(C,b):v.on(C,b);else if(typeof v.addEventListener=="function")v.addEventListener(C,function _(N){P.once&&v.removeEventListener(C,_),b(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}return As.exports}var tn=tC();let Dg=!0,Lg=!0;function Mr(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function ki(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[o,c])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function nC(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Dg=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function iC(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Lg=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Ag(){if(typeof window=="object"){if(Dg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ju(t,e){Lg&&console.warn(t+" is deprecated, please use "+e+" instead.")}function rC(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Mr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Mr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Mr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Mr(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Vh(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ug(t){return Vh(t)?Object.keys(t).reduce(function(e,n){const i=Vh(t[n]),r=i?Ug(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function vl(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?vl(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{vl(t,t.get(r),n)})}))}function zh(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&vl(t,a,r)})}),r}const Wh=Ag;function jg(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,g){return h?h+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(y=>y.kind==="videoinput");let g=h.find(y=>d.some(k=>y.label.toLowerCase().includes(k)));return!g&&h.length&&d.includes("back")&&(g=h[h.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=i(a.video),Wh("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Wh("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){r(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Bg(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Vg(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ki(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function zg(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Wg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>zh(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),ki(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>zh(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function qg(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Kg(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return qg(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(k=>k===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[d.id];if(y)y.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([u]);this._streams[d.id]=k,this._reverseStreams[k.id]=d,this.addStream(k)}return this.getSenders().find(k=>k.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const g=l._reverseStreams[h],y=l._streams[g.id];d=d.replace(new RegExp(y.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const g=l._reverseStreams[h],y=l._streams[g.id];d=d.replace(new RegExp(g.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[y=>{const k=s(this,y);h[0].apply(null,[k])},y=>{h[1]&&h[1].apply(null,y)},arguments[2]]):u.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(k=>u.track===k)&&(h=this._streams[g])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function yl(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Hg(t,e){ki(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var qh=Object.freeze({__proto__:null,fixNegotiationNeeded:Hg,shimAddTrackRemoveTrack:Kg,shimAddTrackRemoveTrackWithNative:qg,shimGetSendersWithDtmf:zg,shimGetUserMedia:jg,shimMediaStream:Bg,shimOnTrack:Vg,shimPeerConnection:yl,shimSenderReceiverGetStats:Wg});function $g(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Ju("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function sC(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function Gg(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kl(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function Qg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Jg(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),ki(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Yg(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Ju("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Xg(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Zg(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function ev(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function tv(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function nv(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Kh=Object.freeze({__proto__:null,shimAddTransceiver:Zg,shimCreateAnswer:nv,shimCreateOffer:tv,shimGetDisplayMedia:sC,shimGetParameters:ev,shimGetUserMedia:$g,shimOnTrack:Gg,shimPeerConnection:kl,shimRTCDataChannel:Xg,shimReceiverGetStats:Jg,shimRemoveStream:Yg,shimSenderGetStats:Qg});function iv(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function rv(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function sv(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=r.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function ov(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(av(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function av(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ug(t.video)}):t}function cv(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Ju("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function lv(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uv(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function dv(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Hh=Object.freeze({__proto__:null,shimAudioContext:dv,shimCallbacksAPI:sv,shimConstraints:av,shimCreateOfferLegacy:uv,shimGetUserMedia:ov,shimLocalStreamsAPI:iv,shimRTCIceServerUrls:cv,shimRemoteStreamsAPI:rv,shimTrackEventTransceiver:lv}),Ja={exports:{}},$h;function oC(){return $h||($h=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(y=>parseInt(y,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let g={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(g.rtx={ssrc:l}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&c&&i.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Ja)),Ja.exports}var hv=oC(),Qi=GS(hv),aC=Sk({__proto__:null,default:Qi},[hv]);function ro(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Qi.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,ki(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Sl(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ki(t,"icecandidate",e=>{if(e.candidate){const n=Qi.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function so(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Qi.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Qi.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Qi.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function oo(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},ki(t,"datachannel",i=>(e(i.channel,i.target),i))}function Cl(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Tl(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function ao(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function co(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var cC=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tl,shimAddIceCandidateNullOrEmpty:ao,shimConnectionState:Cl,shimMaxMessageSize:so,shimParameterlessSetLocalDescription:co,shimRTCIceCandidate:ro,shimRTCIceCandidateRelayProtocol:Sl,shimSendThrowTypeError:oo});function lC(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ag,i=rC(t),r={browserDetails:i,commonShim:cC,extractVersion:Mr,disableLog:nC,disableWarnings:iC,sdp:aC};switch(i.browser){case"chrome":if(!qh||!yl||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=qh,ao(t,i),co(t),jg(t,i),Bg(t),yl(t,i),Vg(t),Kg(t,i),zg(t),Wg(t),Hg(t,i),ro(t),Sl(t),Cl(t),so(t,i),oo(t),Tl(t,i);break;case"firefox":if(!Kh||!kl||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Kh,ao(t,i),co(t),$g(t,i),kl(t,i),Gg(t),Yg(t),Qg(t),Jg(t),Xg(t),Zg(t),ev(t),tv(t),nv(t),ro(t),Cl(t),so(t,i),oo(t);break;case"safari":if(!Hh||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Hh,ao(t,i),co(t),cv(t),uv(t),sv(t),iv(t),rv(t),lv(t),ov(t),dv(t),ro(t),Sl(t),so(t,i),oo(t),Tl(t,i);break;default:n("Unsupported browser!");break}return r}lC({window:typeof window>"u"?void 0:window});const uC=10,wr="lk_e2ee",dC="LKFrameEncryptionKey",hC={sharedKey:!1,ratchetSalt:dC,ratchetWindowSize:8,failureTolerance:uC,keyringSize:16};var Wn;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Wn||(Wn={}));var Gh;(function(t){t.KeyRatcheted="keyRatcheted"})(Gh||(Gh={}));var Mn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Mn||(Mn={}));var Qh;(function(t){t.Error="cryptorError"})(Qh||(Qh={}));function fC(){return pC()||bl()}function bl(){return typeof window.RTCRtpScriptTransform<"u"}function pC(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class cw extends tn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{J.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},hC),e),this.on(Wn.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Wn.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Wn.RatchetRequest,e,n)}}class Xn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Y;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Y||(Y={}));class se extends Xn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Y[n]}}class Yu extends Xn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class dn extends Xn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class mC extends Xn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class xe extends Xn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class wl extends Xn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class Jh extends Xn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Yh extends Xn{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Qu[n]}}var qo;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(qo||(qo={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(qo||(qo={}));var Xh;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Xh||(Xh={}));var M;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(M||(M={}));var L;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(L||(L={}));var D;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(D||(D={}));var F;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(F||(F={}));function gC(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const vC=/version\/(\d+(\.?_?\d+)+)/i;let Ya;function pt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof t>"u"&&typeof navigator>"u")return;const n=(t??navigator.userAgent).toLowerCase();if(Ya===void 0||e){const i=yC.find(r=>{let{test:s}=r;return s.test(n)});Ya=i==null?void 0:i.describe(n)}return Ya}const yC=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:lo(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Xa(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:lo(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Xa(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:lo(vC,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Xa(t)}}}];function lo(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Xa(t){return t.includes("mac os")?lo(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var kC="2.15.4";const SC=kC,CC=16;class Be{}Be.setTimeout=function(){return setTimeout(...arguments)};Be.setInterval=function(){return setInterval(...arguments)};Be.clearTimeout=function(){return clearTimeout(...arguments)};Be.clearInterval=function(){return clearInterval(...arguments)};const TC=5e3,Er=[];var ht;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(ht||(ht={}));class x extends tn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=x.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=J,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),TC):this.handleAppVisibilityChanged()},this.log=kn((r=i.loggerName)!==null&&r!==void 0?r:Bt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=x.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),$(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===x.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===x.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Er.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Er.splice(Er.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),ji(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?F.AudioPlaybackStarted:F.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?F.AudioPlaybackFailed:F.VideoPlaybackFailed,s):s.name==="AbortError"?J.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):J.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(F.ElementAttached,e),e}detach(e){try{if(e){Ji(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(F.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Ji(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(F.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=kn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Er.forEach(i=>{i.parentElement||(n=!1)}),n&&Er.push(e)}}handleAppVisibilityChanged(){return S(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===x.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){it()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){it()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function ji(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!gi()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(gi()||ar())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Ji(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return Mt.AUDIO;case e.Video:return Mt.VIDEO;default:return Mt.DATA}}t.kindToProto=r;function s(l){switch(l){case Mt.AUDIO:return e.Audio;case Mt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return Pe.CAMERA;case n.Microphone:return Pe.MICROPHONE;case n.ScreenShare:return Pe.SCREEN_SHARE;case n.ScreenShareAudio:return Pe.SCREEN_SHARE_AUDIO;default:return Pe.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case Pe.CAMERA:return n.Camera;case Pe.MICROPHONE:return n.Microphone;case Pe.SCREEN_SHARE:return n.ScreenShare;case Pe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case fl.ACTIVE:return i.Active;case fl.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(x||(x={}));class ie{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const bC=["vp8","h264"],wC=["vp8","h264","vp9","av1","h265"];function EC(t){return!!bC.find(e=>e===t)}var Zh;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Zh||(Zh={}));var El;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(El||(El={}));const fs={h90:new ie(160,90,9e4,20),h180:new ie(320,180,16e4,20),h216:new ie(384,216,18e4,20),h360:new ie(640,360,45e4,20),h540:new ie(960,540,8e5,25),h720:new ie(1280,720,17e5,30),h1080:new ie(1920,1080,3e6,30),h1440:new ie(2560,1440,5e6,30),h2160:new ie(3840,2160,8e6,30)},Pl={h120:new ie(160,120,7e4,20),h180:new ie(240,180,125e3,20),h240:new ie(320,240,14e4,20),h360:new ie(480,360,33e4,20),h480:new ie(640,480,5e5,20),h540:new ie(720,540,6e5,25),h720:new ie(960,720,13e5,30),h1080:new ie(1440,1080,23e5,30),h1440:new ie(1920,1440,38e5,30)},Xu={h360fps3:new ie(640,360,2e5,3,"medium"),h360fps15:new ie(640,360,4e5,15,"medium"),h720fps5:new ie(1280,720,8e5,5,"medium"),h720fps15:new ie(1280,720,15e5,15,"medium"),h720fps30:new ie(1280,720,2e6,30,"medium"),h1080fps15:new ie(1920,1080,25e5,15,"medium"),h1080fps30:new ie(1920,1080,5e6,30,"medium"),original:new ie(0,0,7e6,30,"medium")},PC="|",ef="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function _C(t){const e=t.split(PC);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function at(t){return S(this,void 0,void 0,function*(){return new Promise(e=>Be.setTimeout(e,t))})}function _l(){return"addTransceiver"in RTCPeerConnection.prototype}function Rl(){return"addTrack"in RTCPeerConnection.prototype}function RC(){if(!("getCapabilities"in RTCRtpSender)||gi())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function xC(){if(!("getCapabilities"in RTCRtpSender)||ar())return!1;if(gi()){const n=pt();if(n!=null&&n.version&&Zt(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Zt(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function $t(t){return t==="av1"||t==="vp9"}function xl(t){return!document||Ko()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function IC(){return typeof RTCPeerConnection>"u"?!1:_l()||Rl()}function ar(){var t;return((t=pt())===null||t===void 0?void 0:t.name)==="Firefox"}function gi(){var t;return((t=pt())===null||t===void 0?void 0:t.name)==="Safari"}function Ko(){const t=pt();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function OC(){const t=pt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Zt(t.osVersion,"17")>=0}function FC(t){return t||(t=pt()),(t==null?void 0:t.name)==="Safari"&&Zt(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Zt(t.osVersion,"18.3")>0}function fv(){var t,e;return it()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function NC(){const t=pt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Zt(e,t.osVersion)>=0?!0:t.name==="Safari"&&Zt(e,t.version)>=0}function it(){return typeof document<"u"}function Xt(){return navigator.product=="ReactNative"}function Il(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function pv(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function mv(){if(!Xt())return;let t=pv();if(t)return t.platform}function tf(){if(it())return window.devicePixelRatio;if(Xt()){let t=pv();if(t)return t.devicePixelRatio}return 1}function Zt(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function MC(t){for(const e of t)e.target.handleResize(e)}function DC(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Za=null;const nf=()=>(Za||(Za=new ResizeObserver(MC)),Za);let ec=null;const rf=()=>(ec||(ec=new IntersectionObserver(DC,{root:null,rootMargin:"0px"})),ec);function LC(){var t;const e=new bS({sdk:kg.JS,protocol:CC,version:SC});return Xt()&&(e.os=(t=mv())!==null&&t!==void 0?t:""),e}function sf(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Pr;function tc(){if(!Pr){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Pr]=i.stream.getAudioTracks(),!Pr)throw Error("Could not get empty media stream audio track");Pr.enabled=!1}return Pr.clone()}class Bi{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>S(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function AC(t){return wC.includes(t)}function qn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function UC(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Ol(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function jC(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function BC(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function of(t){switch(t.reason){case Y.LeaveRequest:return t.context;case Y.Cancelled:return Lt.CLIENT_INITIATED;case Y.NotAllowed:return Lt.USER_REJECTED;case Y.ServerUnreachable:return Lt.JOIN_FAILURE;default:return Lt.UNKNOWN_REASON}}function uo(t){return t!==void 0?Number(t):void 0}function ni(t){return t!==void 0?BigInt(t):void 0}function Yi(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Jt(t){return!!t&&t.kind==x.Kind.Audio}function Si(t){return!!t&&t.kind==x.Kind.Video}function En(t){return Yi(t)&&Si(t)}function rn(t){return Yi(t)&&Jt(t)}function Fl(t){return!!t&&!t.isLocal}function VC(t){return!!t&&!t.isLocal}function nc(t){return Fl(t)&&Si(t)}function zC(t){return t.isLocal}function WC(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function gv(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=kv(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Nl(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=c??u)),h.video&&(Nl(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=l??d)),h}function Nl(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Zu(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":Nl(a,c.resolution);break;default:a[l]=c[l]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function vv(t){return S(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=yv();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield at(n),r.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function yv(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>S(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function qC(t){return t==="audioinput"?x.Source.Microphone:t==="videoinput"?x.Source.Camera:x.Source.Unknown}function Ml(t){return t===x.Source.Microphone?"audioinput":t===x.Source.Camera?"videoinput":void 0}function KC(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,gi()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function ho(t){return t.split("/")[1].toLowerCase()}function HC(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new $u({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function $(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?$(t.track):{})}}function $C(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function GC(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function kv(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:gC(e)}}function QC(t){switch(t){case Pe.CAMERA:return x.Source.Camera;case Pe.MICROPHONE:return x.Source.Microphone;case Pe.SCREEN_SHARE:return x.Source.ScreenShare;case Pe.SCREEN_SHARE_AUDIO:return x.Source.ScreenShareAudio;default:return x.Source.Unknown}}function af(t,e){return t.width*t.height<e.width*e.height}function JC(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class YC extends tn.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:s,data:o}=n.data;switch(s){case"error":J.error(o.error.message),this.emit(Mn.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Mn.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Mn.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Wn.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{J.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Mn.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!fC())throw new Yu("tried to setup end-to-end encryption on an unsupported browser");if(J.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:YS.getLevel()}};this.worker&&(J.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){J.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?J.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(D.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(M.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==ut.NONE,r.identity)),e.on(M.ConnectionStateChanged,i=>{i===Z.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==ut.NONE,r.identity)})})}).on(M.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(M.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(M.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(L.LocalSenderCreated,(i,r)=>S(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(Wn.SetKey,i=>this.postKey(i)).on(Wn.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?ho(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Yi(e)||!n){n||J.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return S(this,void 0,void 0,function*(){if(this.worker){if(bl()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(wr in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:wr in e}};this.worker.postMessage(a,[o,s])}e[wr]=!0}})}handleSender(e,n,i){var r;if(!(wr in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(bl()){J.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{J.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[wr]=!0}}}const ic="default";class Le{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Le),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Le.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){J.debug("awaiting getUserMedia promise");try{n?yield Le.userMediaPromiseMap.get(n):yield Promise.all(Le.userMediaPromiseMap.values())}catch{J.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(gi()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return S(this,void 0,void 0,function*(){if(n!==ic)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===ic);if(!s){J.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==ic&&a.groupId===(i??s.groupId));if(!o){J.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Le.userMediaPromiseMap.has(e):Le.userMediaPromiseMap.size>0}}Le.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Le.userMediaPromiseMap=new Map;var $r;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})($r||($r={}));class XC{constructor(){this.pendingTasks=new Map,this.taskMutex=new Qe,this.nextTaskIndex=0}run(e){return S(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:$r.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=$r.RUNNING,yield e()}finally{n.status=$r.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return S(this,void 0,void 0,function*(){return this.run(()=>S(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function ZC(t,e){const n=new URL(UC(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),Sv(n,"rtc")}function eT(t){const e=new URL(Ol(t));return Sv(e,"validate")}function tT(t){return t.endsWith("/")?t:"".concat(t,"/")}function Sv(t,e){return t.pathname="".concat(tT(t.pathname)).concat(e),t.toString()}const nT=["syncState","trickle","offer","answer","simulate","leave"];function iT(t){const e=nT.indexOf(t.case)>=0;return J.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var le;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(le||(le={}));class ed{get currentState(){return this.state}get isDisconnected(){return this.state===le.DISCONNECTING||this.state===le.DISCONNECTED}get isEstablishingConnection(){return this.state===le.CONNECTING||this.state===le.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=le.DISCONNECTED,this.log=J,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=kn((i=n.loggerName)!==null&&i!==void 0?i:Bt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new XC,this.queuedRequests=[],this.closingLock=new Qe,this.connectionLock=new Qe,this.state=le.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return S(this,void 0,void 0,function*(){return this.state=le.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return S(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=le.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=LC(),o=rT(n,s,i),a=ZC(e,o),c=eT(a);return new Promise((l,u)=>S(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>S(this,void 0,void 0,function*(){this.close(),clearTimeout(g),u(new se("room connection has been cancelled (signal)",Y.Cancelled))}),g=setTimeout(()=>{this.close(),u(new se("room connection has timed out (signal)",Y.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const y=new URL(a);y.searchParams.has("access_token")&&y.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(y),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(g)},this.ws.onerror=k=>S(this,void 0,void 0,function*(){if(this.state!==le.CONNECTED){this.state=le.DISCONNECTED,clearTimeout(g);try{const E=yield fetch(c);if(E.status.toFixed(0).startsWith("4")){const p=yield E.text();u(new se(p,Y.NotAllowed,E.status))}else u(new se("Encountered unknown websocket error during connection: ".concat(k.toString()),Y.InternalError,E.status))}catch(E){u(new se(E instanceof Error?E.message:"server was not reachable",Y.ServerUnreachable))}return}this.handleWSError(k)}),this.ws.onmessage=k=>S(this,void 0,void 0,function*(){var E,p,m;let f;if(typeof k.data=="string"){const v=JSON.parse(k.data);f=Ah.fromJson(v,{ignoreUnknownFields:!0})}else if(k.data instanceof ArrayBuffer)f=Ah.fromBinary(new Uint8Array(k.data));else{this.log.error("could not decode websocket message: ".concat(typeof k.data),this.logContext);return}if(this.state!==le.CONNECTED){let v=!1;if(((E=f.message)===null||E===void 0?void 0:E.case)==="join"?(this.state=le.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=f.message.value.pingTimeout,this.pingIntervalDuration=f.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(f.message.value)):this.state===le.RECONNECTING&&f.message.case!=="leave"?(this.state=le.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((p=f.message)===null||p===void 0?void 0:p.case)==="reconnect"?l(f.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),v=!0)):this.isEstablishingConnection&&f.message.case==="leave"?u(new se("Received leave request while trying to (re)connect",Y.LeaveRequest,void 0,f.message.value.reason)):i.reconnect||u(new se("did not receive join response, got ".concat((m=f.message)===null||m===void 0?void 0:m.case," instead"),Y.InternalError)),!v)return}this.signalLatency&&(yield at(this.signalLatency)),this.handleSignalResponse(f)}),this.ws.onclose=k=>{this.isEstablishingConnection&&u(new se("Websocket got closed during a (re)connection attempt",Y.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:k.reason,code:k.code,wasClean:k.wasClean,state:this.state})),this.handleOnClose(k.reason)}}finally{d()}}))}close(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=le.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,at(250)])),e.ws=void 0}}finally{n&&(e.state=le.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Ho(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Ho(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Ku({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Hu({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new _g({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Pg({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new Ig({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:pe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Mg({timestamp:pe.parse(Date.now()),rtt:pe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Eg({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new ma({reason:Lt.CLIENT_INITIATED,action:Gi.DISCONNECT})})}sendRequest(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!iT(n)&&i.state===le.RECONNECTING){i.queuedRequests.push(()=>S(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield at(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new PS({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=cf(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=cf(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return S(this,void 0,void 0,function*(){if(this.state===le.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Be.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Be.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Be.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Be.clearInterval(this.pingInterval)}}function cf(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Ho(t,e){return new mi({sdp:t.sdp,type:t.type,id:e})}function rT(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Xt()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class lf{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class sT{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var _t={},rc={},sc={exports:{}},uf;function td(){if(uf)return sc.exports;uf=1;var t=sc.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),sc.exports}var df;function oT(){return df||(df=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},i=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},r=td(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],g=d.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var y=0;y<(r[h]||[]).length;y+=1){var k=r[h][y];if(k.reg.test(g))return i(k,u,g)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}}(rc)),rc}var oc,hf;function aT(){if(hf)return oc;hf=1;var t=td(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(u){if(a>=l)return u;var d=c[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,u=[o+"="+l];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(c[a.name][h]):u.push(c[a.names[d]])}else u.push(c[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return oc=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||s,u=[];return c.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(g){u.push(i(d,h,g))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),l.forEach(function(h){t[h].forEach(function(g){g.name in d&&d[g.name]!=null?u.push(i(h,g,d)):g.push in d&&d[g.push]!=null&&d[g.push].forEach(function(y){u.push(i(h,g,y))})})})}),u.join(`\r
`)+`\r
`},oc}var ff;function cT(){if(ff)return _t;ff=1;var t=oT(),e=aT(),n=td();return _t.grammar=n,_t.write=e,_t.parse=t.parse,_t.parseParams=t.parseParams,_t.parseFmtpConfig=t.parseFmtpConfig,_t.parsePayloads=t.parsePayloads,_t.parseRemoteCandidates=t.parseRemoteCandidates,_t.parseImageAttributes=t.parseImageAttributes,_t.parseSimulcastStreamList=t.parseSimulcastStreamList,_t}var Pn=cT();function nd(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var g=Date.now()-l;if(g+e>=c)return c-g}return e}var h=function(){var g=[].slice.call(arguments),y=this;return new Promise(function(k,E){var p=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var f=t.apply(y,g);a&&a(f),u.forEach(function(v){return(0,v.resolve)(f)}),u=[]}},d()),p){var m=t.apply(y,g);return a&&a(m),k(m)}u.push({resolve:k,reject:E})})};return h.cancel=function(g){s!==void 0&&clearTimeout(s),u.forEach(function(y){return(0,y.reject)(g)}),u=[]},h}const lT=.7,uT=20,Xi={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class pf extends tn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=J,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=nd(r=>S(this,void 0,void 0,function*(){this.emit(Xi.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),uT),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=kn((i=n.loggerName)!==null&&i!==void 0?i:Bt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Qe}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return S(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return S(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=dT(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Pn.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let c=0;if(o.rtp.some(u=>u.codec.toUpperCase()===a.codec.toUpperCase()?(c=u.payload,!0):!1),c===0)return!0;let l=!1;for(const u of o.fmtp)if(u.payload===c){u.config=u.config.split(";").filter(d=>!d.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(u.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=Pn.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Xi.NegotiationComplete),e.sdp&&Pn.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Xi.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Pn.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{gf(a),a.type==="audio"?mf(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(d=>d.codec.toUpperCase()===c.codec.toUpperCase()?(l=d.payload,!0):!1),l===0||($t(c.codec)&&!gi()&&this.ensureVideoDDExtensionForSVC(a,o),c.codec!=="av1"))return!0;const u=Math.round(c.maxbr*lT);for(const d of a.fmtp)if(d.payload===l){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Pn.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Pn.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{gf(r),r.type==="audio"&&mf(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Pn.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new xe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new xe("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return S(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return S(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new wl(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===ef))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:ef})}}}function mf(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function dT(t){var e;const n=[],i=[],r=Pn.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function gf(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Dl="vp8",hT={audioPreset:El.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Xu.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Dl,backupCodec:!0,preConnectBuffer:!1},Cv={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Tv={deviceId:{ideal:"default"},resolution:fs.h720.resolution},fT={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new ZS,disconnectOnPageLeave:!0,webAudioMix:!1},id={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ke;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ke||(ke={}));class pT{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=id.peerConnectionTimeout,this.log=J,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ke.CONNECTED:a.some(c=>c==="failed")?this.state=ke.FAILED:a.some(c=>c==="connecting")?this.state=ke.CONNECTING:a.every(c=>c==="closed")?this.state=ke.CLOSED:a.some(c=>c==="closed")?this.state=ke.CLOSING:a.every(c=>c==="new")&&(this.state=ke.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ke[o]," to ").concat(ke[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=kn((r=i.loggerName)!==null&&r!==void 0?r:Bt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new pf(e,i),this.subscriber=new pf(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dt.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Dt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ke.NEW,this.connectionLock=new Qe,this.remoteOfferLock=new Qe}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return S(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return S(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return S(this,void 0,void 0,function*(){n===Dt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return S(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return S(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return S(this,void 0,void 0,function*(){return new Promise((n,i)=>S(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Xi.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Xi.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Dt.PUBLISHER?this.publisher.getConnectedAddress():e===Dt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>S(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Be.clearTimeout(d),l(new se("room connection has been cancelled",Y.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Be.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),l(new se("could not establish pc connection",Y.InternalError))},o);for(;this.state!==ke.CONNECTED;)if(yield at(50),r!=null&&r.signal.aborted){l(new se("room connection has been cancelled",Y.Cancelled));return}Be.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),c()}))}()})}}class Te extends Error{constructor(e,n,i){super(n),this.code=e,this.message=vf(n,Te.MAX_MESSAGE_BYTES),this.data=i?vf(i,Te.MAX_DATA_BYTES):void 0}static fromProto(e){return new Te(e.code,e.message,e.data)}toProto(){return new mg({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Te(Te.ErrorCode[e],Te.ErrorMessage[e],n)}}Te.MAX_MESSAGE_BYTES=256;Te.MAX_DATA_BYTES=15360;Te.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Te.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const bv=15360;function rd(t){return new TextEncoder().encode(t).length}function vf(t,e){if(rd(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const sd=2e3;function va(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const od=typeof MediaRecorder<"u";class mT{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const gT=od?MediaRecorder:mT;class vT extends gT{constructor(e,n){if(!od)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>S(this,void 0,void 0,function*(){let u;if(l.data.arrayBuffer){const d=yield l.data.arrayBuffer();u=new Uint8Array(d)}else if(l.data.byteArray)u=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function yT(){return od}const kT=1e3,ST=1e4;class wv extends x{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=nd(()=>S(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>S(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(F.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Qe,this.pauseUpstreamLock=new Qe,this.processorLock=new Qe,this.restartLock=new Qe,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==x.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return S(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Ji(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(ji(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{s()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{ji(r??e,s)}))})}waitForDimensions(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kT;return function*(){var i;if(e.kind===x.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=pt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield at(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield at(50)}throw new dn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return S(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===qn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),qn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===x.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===x.Kind.Audio?"audioinput":"videoinput";return n?Le.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return S(this,void 0,void 0,function*(){if(!this.sender)throw new dn("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return S(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=eC(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===x.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{Ji(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield c.applyConstraints(s),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(F.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),fv()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(F.UpstreamPaused,this);const i=pt();if((i==null?void 0:i.name)==="Safari"&&Zt(i.version,"12.0")<0)throw new Yu("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(F.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(ji(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:l})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(Ji(i._mediaStreamTrack,l),ji(i.processor.processedTrack,l));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(F.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(F.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!yT()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new vT(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},ST)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class $o extends wv{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,x.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=va(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(F.AudioTrackFeatureUpdate,this,De.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(F.AudioTrackFeatureUpdate,this,De.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==qn(this._constraints.deviceId);return this.source===x.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return S(this,void 0,void 0,function*(){let n;if(e){const i=Zu({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return S(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){it()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},sd)))}setProcessor(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!Xt()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(F.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return S(this,void 0,void 0,function*(){const e=yield vv(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(F.AudioSilenceDetected)),e})}}function CT(t,e,n){switch(t.kind){case"audio":return new $o(t,e,!1,void 0,n);case"video":return new Go(t,e,!1,n);default:throw new dn("unsupported track type: ".concat(t.kind))}}const TT=Object.values(fs),bT=Object.values(Pl),wT=Object.values(Xu),ET=[fs.h180,fs.h360],PT=[Pl.h180,Pl.h360],_T=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ie(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Ll=["q","h","f"];function Al(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=xT(t,e,n,l),J.debug("using video encoding",o));const u=o.maxFramerate,d=new ie(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&$t(l)){const y=new Ev(c),k=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const E=pt();if(Ko()||Xt()||(E==null?void 0:E.name)==="Chrome"&&Zt(E==null?void 0:E.version,"113")<0){const p=y.suffix=="h"?2:3,m=FC(E);for(let f=0;f<y.spatial;f+=1)k.push({rid:Ll[2-f],maxBitrate:o.maxBitrate/Math.pow(p,f),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:m?Math.pow(2,f):void 0});k[0].scalabilityMode=c}else k.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(k[0].priority=d.encoding.priority,k[0].networkPriority=d.encoding.priority),J.debug("using svc encoding",{encodings:k}),k}if(!a)return[o];let h=[];t?h=(r=kf(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:yf(t,d):h=(s=kf(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:yf(t,d);let g;if(h.length>0){const y=h[0];h.length>1&&([,g]=h);const k=Math.max(e,n);if(k>=960&&g)return ac(e,n,[y,g,d],u);if(k>=480)return ac(e,n,[y,d],u)}return ac(e,n,[d])}function RT(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&J.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===x.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Al(t.source===x.Source.ScreenShare,c,l,n)}function xT(t,e,n,i){const r=IT(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(s=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function IT(t,e,n){if(t)return wT;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?TT:bT}function yf(t,e){if(t)return _T(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?ET:PT}function ac(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=Ll.length)return;const a=Math.min(t,e),l={rid:Ll[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(l.maxFramerate=u);const d=ar()||o===0;s.encoding.priority&&d&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),r.push(l)}),Xt()&&mv()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,J.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),J.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function kf(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class Ev{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function OT(t){return t.source===x.Source.ScreenShare||t.constraints.height&&qn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const FT=5e3;class Go extends wv{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,x.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(F.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);c+=va(l,h)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Qe}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!it())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},sd))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return S(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=un(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return S(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=un(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===x.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=ht.LOW;i<=ht.HIGH;i+=1)n.push(new Gu({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers($t(this.codec),n)}restartTrack(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Zu({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=un(this.simulcastCodecs.values()),u;u=yield l.next(),n=u.done,!n;c=!0){s=u.value,c=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return S(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,g=un(r.simulcastCodecs.values()),y;y=yield g.next(),o=y.done,!o;h=!0)l=y.value,h=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(k){a={error:k}}finally{try{!h&&!o&&(c=g.return)&&(yield c.call(g))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return S(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},FT))}setPublishingCodecs(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers($t(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=un(e);r=yield i.next(),s=r.done,!s;n=!0){c=r.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers($t(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Sf(d.sender,d.encodings,u.qualities,this.senderLock,$t(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return S(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Sf(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return S(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&$t(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),fv()&&this.isInBackground&&this.source===x.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Sf(t,e,n,i,r,s,o){return S(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let u=!1;!1&&l[0].scalabilityMode||(r&&n.some(g=>g.enabled)&&n.forEach(g=>g.enabled=!0),l.forEach((h,g)=>{var y;let k=(y=h.rid)!==null&&y!==void 0?y:"";k===""&&(k="q");const E=Pv(k),p=n.find(m=>m.quality===E);p&&h.active!==p.enabled&&(u=!0,h.active=p.enabled,s.debug("setting layer ".concat(p.quality," to ").concat(h.active?"enabled":"disabled"),o),ar()&&(p.enabled?(h.scaleResolutionDownBy=e[g].scaleResolutionDownBy,h.maxBitrate=e[g].maxBitrate,h.maxFrameRate=e[g].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Pv(t){switch(t){case"f":return ht.HIGH;case"h":return ht.MEDIUM;case"q":return ht.LOW;default:return ht.HIGH}}function Cf(t,e,n,i){if(!n)return[new ci({quality:ht.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new Ev(r),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new ci({quality:Math.min(ht.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const c=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Pv((o=r.rid)!==null&&o!==void 0?o:"");return new ci({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Tf="_lossy",bf="_reliable",NT=2*1e3,cc="leave-reconnect",MT=3e4;var Rt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Rt||(Rt={}));class DT extends tn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=id.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Rt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=J,this.reliableDataSequence=1,this.reliableMessageBuffer=new lf,this.reliableReceivedState=new sT(MT),this.handleDataChannel=i=>S(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===bf)s.reliableDCSub=o;else if(o.label===Tf)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>S(this,void 0,void 0,function*(){var r,s;const o=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=Ze.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(D.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&AT(c,c.value.value),this.emit(D.DataPacketReceived,c))}finally{o()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?H.LOSSY:H.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(D.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===cc&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Be.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Rt.Connected&&i();const s=()=>{this.off(D.Disconnected,o),i()},o=()=>{this.off(D.Restarted,s),r()};this.once(D.Restarted,s),this.once(D.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(D.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===H.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===le.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(wi.RR_SIGNAL_DISCONNECTED))},this.log=kn((n=e.loggerName)!==null&&n!==void 0?n:Bt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new ed(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Qe,this.dataProcessLock=new Qe,this.dcBufferStatus=new Map([[H.LOSSY,!0],[H.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(D.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(D.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(D.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(D.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(D.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(D.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(D.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(D.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return S(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,this.emit(D.SignalConnected,s),s}catch(s){if(s instanceof se&&s.reason===Y.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return S(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(D.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return S(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new lf,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return S(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new dn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new se("publication of local track timed out, no response from server",Y.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return S(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return S(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ke.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new pT(r,e.subscriberPrimary,this.loggerOptions),this.emit(D.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>S(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ke.CONNECTED){const u=this.pcState===Rt.New;this.pcState=Rt.Connected,u&&this.emit(D.Connected,e)}else s===ke.FAILED&&this.pcState===Rt.Connected&&(this.pcState=Rt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?wi.RR_SUBSCRIBER_FAILED:wi.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===le.RECONNECTING,l=[ke.FAILED,ke.CLOSING,ke.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(D.Offline)}),this.pcManager.onTrack=s=>{this.emit(D.MediaTrackAdded,s.track,s.streams[0],s.receiver)},LT((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>S(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>S(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(D.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(D.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(D.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(D.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(D.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",wi.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Gi.DISCONNECT:this.emit(D.Disconnected,e==null?void 0:e.reason),this.close();break;case Gi.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(cc);break;case Gi.RESUME:this.handleDisconnect(cc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ds.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Tf,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(bf,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return S(this,void 0,void 0,function*(){if(_l())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Rl())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new xe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return S(this,void 0,void 0,function*(){if(_l())return this.createSimulcastTransceiverSender(e,n,i,r);if(Rl())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new xe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new xe("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Si(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new xe("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new xe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return S(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){J.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===ds.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ke.NEW)===ke.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof xe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Ei||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",wi.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(D.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return S(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new xe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(D.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Ei;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof se&&o.reason===Y.NotAllowed?new xe("could not reconnect, token might be expired"):new Ei}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(D.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==le.CONNECTED)throw new Ei("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(D.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return S(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new xe("could not reconnect, url or token not saved");if(!this.pcManager)throw new xe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(D.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof se&&r.reason===Y.NotAllowed?new xe("could not reconnect, token might be expired"):r instanceof se&&r.reason===Y.LeaveRequest?r:new Ei(s)}if(this.emit(D.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==le.CONNECTED)throw new Ei("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(D.Resumed)})}waitForPCInitialConnection(e,n){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new xe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return S(this,void 0,void 0,function*(){this.pcState=Rt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield at(NT),!this.pcManager)throw new xe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Rt.Connected}catch(e){throw this.pcState=Rt.Disconnected,new se("could not establish PC connection, ".concat(e.message),Y.InternalError)}})}publishRpcResponse(e,n,i,r){return S(this,void 0,void 0,function*(){const s=new Ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcResponse",value:new pg({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,H.RELIABLE)})}publishRpcAck(e,n){return S(this,void 0,void 0,function*(){const i=new Ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcAck",value:new fg({requestId:n})}});yield this.sendDataPacket(i,H.RELIABLE)})}sendDataPacket(e,n){return S(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===H.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===H.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return S(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(H.RELIABLE);const n=this.dataChannelForKind(H.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(H.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>S(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(D.Closing,r);!this.dcBufferStatus.get(e);)yield at(10);this.off(D.Closing,r),n()}}))}ensureDataTransportConnected(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new xe("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new se("".concat(a," connection not set"),Y.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield at(50)}throw new se("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),Y.InternalError)}()})}ensurePublisherConnected(e){return S(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ke.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return S(this,void 0,void 0,function*(){return new Promise((e,n)=>S(this,void 0,void 0,function*(){if(!this.pcManager){n(new wl("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(D.Closing,r),this.pcManager.publisher.once(Xi.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();AC(c)&&o.set(a.payload,c)}),this.emit(D.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof wl&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",wi.RR_UNKNOWN),n(s)}finally{this.off(D.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===H.LOSSY)return this.lossyDCSub;if(e===H.RELIABLE)return this.reliableDCSub}else{if(e===H.LOSSY)return this.lossyDC;if(e===H.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new Og({answer:s?Ho({sdp:s.sdp,type:s.type}):void 0,offer:o?Ho({sdp:o.sdp,type:o.type}):void 0,subscription:new pa({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:HC(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((u,d)=>new Fg({publisherSid:d,lastSeq:u}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Ng({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(H.LOSSY),Dt.PUBLISHER),n(this.dataChannelForKind(H.RELIABLE),Dt.PUBLISHER),n(this.dataChannelForKind(H.LOSSY,!0),Dt.SUBSCRIBER),n(this.dataChannelForKind(H.RELIABLE,!0),Dt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Be.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){it()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){it()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Ei extends Error{}function LT(t){return t!==void 0&&t>13}function AT(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Ul{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Il(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return S(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),J.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return S(this,void 0,void 0,function*(){const n=yield fetch("".concat(UT(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new se("Could not fetch region settings: ".concat(n.statusText),n.status===401?Y.NotAllowed:Y.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function UT(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class _v{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class jT extends _v{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>S(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return S(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return S(this,void 0,void 0,function*(){var e,n,i,r;let s=new Set;try{for(var o=!0,a=un(this),c;c=yield a.next(),e=c.done,!e;o=!0){r=c.value,o=!1;const l=r;s.add(l)}}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class BT extends _v{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=uo(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>S(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return S(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return S(this,void 0,void 0,function*(){var e,n,i,r;let s="";try{for(var o=!0,a=un(this),c;c=yield a.next(),e=c.done,!e;o=!0)r=c.value,o=!1,s+=r}catch(l){n={error:l}}finally{try{!o&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return s})}}class Rv{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return S(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class VT extends Rv{}class zT extends Rv{}class xv extends x{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?F.Muted:F.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(F.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),sd)),$C()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(F.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class WT extends xv{constructor(e,n,i,r,s,o){super(e,n,x.Kind.Audio,i,o),this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=va(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Xt()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Xt())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return S(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(xl(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&xl(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(F.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(F.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const lc=100;class qT extends xv{constructor(e,n,i,r,s){super(e,n,x.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=va(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=nd(()=>{this.updateDimensions()},lc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Ji(this._mediaStreamTrack,n):ji(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new KT(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!r||s;if(this.lastVisible!==o){if(!o&&Date.now()-i<lc){Be.setTimeout(()=>{this.updateVisibility()},lc);return}this.lastVisible=o,this.emit(F.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(F.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?tf():n||(tf()>2?2:1)}}class KT{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=_r(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=_r(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=_r(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??jl(e),this.isPiP=it()&&_r(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=jl(this.element),this.isPiP=_r(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,rf().observe(this.element),nf().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=rf())===null||e===void 0||e.unobserve(this.element),(n=nf())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function _r(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?jl(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function jl(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&c!=="none"}class an extends tn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=ut.NONE,this.log=J,this.handleMuted=()=>{this.emit(F.Muted)},this.handleUnmuted=()=>{this.emit(F.Unmuted)},this.log=kn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Bt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=x.Source.Unknown}setTrack(e){this.track&&(this.track.off(F.Muted,this.handleMuted),this.track.off(F.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(F.Muted,this.handleMuted),e.on(F.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),$(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ut.NONE}get audioTrack(){if(Jt(this.track))return this.track}get videoTrack(){if(Si(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=x.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===x.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(an||(an={}));class Bl extends an{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(F.Ended)},this.handleCpuConstrained=()=>{this.track&&Si(this.track)&&this.emit(F.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(F.Ended,this.handleTrackEnded),this.track.off(F.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(F.Ended,this.handleTrackEnded),e.on(F.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Jt(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(De.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(De.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(De.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(De.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(De.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(De.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function ya(t,e){return S(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=kv(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=gv(s,Cv,Tv),l=Zu(c),u=navigator.mediaDevices.getUserMedia(l);s.audio&&(Le.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Le.userMediaPromiseMap.delete("audioinput"))),s.video&&(Le.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Le.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>S(this,void 0,void 0,function*(){const g=h.kind==="audio";let y=g?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let k;const E=g?l.audio:l.video;typeof E!="boolean"&&(k=E);const p=h.getSettings().deviceId;k!=null&&k.deviceId&&qn(k.deviceId)!==p?k.deviceId=p:k||(k={deviceId:p});const m=CT(h,k,e);return m.kind===x.Kind.Video?m.source=x.Source.Camera:m.kind===x.Kind.Audio&&(m.source=x.Source.Microphone),m.mediaStream=d,Jt(m)&&i?yield m.setProcessor(i):Si(m)&&r&&(yield m.setProcessor(r)),m})))}catch(d){if(!n)throw d;return ya(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function HT(t){return S(this,void 0,void 0,function*(){return(yield ya({audio:!1,video:t??!0}))[0]})}function $T(t){return S(this,void 0,void 0,function*(){return(yield ya({audio:t??!0,video:!1}))[0]})}var On;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(On||(On={}));function GT(t){switch(t){case Nr.EXCELLENT:return On.Excellent;case Nr.GOOD:return On.Good;case Nr.POOR:return On.Poor;case Nr.LOST:return On.Lost;default:return On.Unknown}}class Iv extends tn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===hs.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===$i.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:hs.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=On.Unknown,this.log=J,this.log=kn((c=o==null?void 0:o.loggerName)!==null&&c!==void 0?c:Bt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Bi,this.once(L.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(x.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(x.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(x.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===$i.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==$i.ACTIVE&&this.emit(L.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(L.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(L.ParticipantNameChanged,e)}_setAttributes(e){const n=GC(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(L.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(L.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(L.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=GT(e),n!==this._connectionQuality&&this.emit(L.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Jt(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(F.Muted,()=>{this.emit(L.TrackMuted,e)}),e.on(F.Unmuted,()=>{this.emit(L.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case x.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case x.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function QT(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new xg({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const wf=15e3;class JT extends Iv{constructor(e,n,i,r,s){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ut.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Bi)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var o,a,c,l,u,d;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((l=(c=this.signalConnectedFuture).reject)===null||l===void 0||l.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(d=(u=this.activeAgentFuture)===null||u===void 0?void 0:u.reject)===null||d===void 0||d.call(u,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var a,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Bi),(c=(a=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(a)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:c,message:l}=o,u=this.pendingSignalRequests.get(a);u&&(c!==Qu.OK&&u.reject(new Yh(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=Te.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>QT(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),$(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),$(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),$(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.onTrackCpuConstrained=(o,a)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),$(a))),this.emit(L.LocalTrackCpuConstrained,o,a)},this.handleSubscribedQualityUpdate=o=>S(this,void 0,void 0,function*(){var a,c,l,u,d;if(!(!((d=this.roomOptions)===null||d===void 0)&&d.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const g=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var y=!0,k=un(g),E;E=yield k.next(),a=E.done,!a;y=!0){u=E.value,y=!1;const p=u;EC(p)&&(this.log.debug("publish ".concat(p," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),$(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,p,h.options))}}catch(p){c={error:p}}finally{try{!y&&!a&&(l=k.return)&&(yield l.call(k))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>S(this,void 0,void 0,function*(){if(o.source===x.Source.ScreenShare||o.source===x.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),$(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(rn(o)||En(o))try{if(it())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===x.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),$(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),$(o))),rn(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),$(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ut.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(D.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(D.Connected,this.handleReconnected).on(D.SignalConnected,this.handleSignalConnected).on(D.SignalRestarted,this.handleReconnected).on(D.SignalResumed,this.handleReconnected).on(D.Restarting,this.handleReconnecting).on(D.Resuming,this.handleReconnecting).on(D.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(D.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(D.Closing,this.handleClosing).on(D.SignalRequestResponse,this.handleSignalRequestResponse).on(D.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return S(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>S(i,void 0,void 0,function*(){var l,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),g=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:y=>{c(y),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-g<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(y=>{let[k,E]=y;return this.attributes[k]===E||E===""&&!this.attributes[k]}))){this.pendingSignalRequests.delete(h),a();return}yield at(50)}c(new Yh("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(x.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(x.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(x.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(L.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){this.encryptionType=e?ut.GCM:ut.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return S(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case x.Source.Camera:c=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case x.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case x.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new dn(e)}}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&this.emit(L.MediaDevicesError,l,Ml(e)),this.pendingPublishing.delete(e),l}for(const l of c){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===x.Source.Microphone&&Jt(l)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),$(d))),l.push(this.publishTrack(d,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===x.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(x.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return S(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(x.Source.Camera)||this.pendingPublishing.has(x.Source.Microphone))){this.pendingPublishing.add(x.Source.Camera),this.pendingPublishing.add(x.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(x.Source.Camera),this.pendingPublishing.delete(x.Source.Microphone)}}})}createTracks(e){return S(this,void 0,void 0,function*(){var n,i;e??(e={});const r=gv(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield ya(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Jt(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=x.Source.Microphone,this.emit(L.AudioStreamAcquired)),Si(a)&&(this.cameraError=void 0,a.source=x.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return S(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Yu("getDisplayMedia not supported");e.resolution===void 0&&!OC()&&(e.resolution=Xu.h1080fps30.resolution);const n=KC(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new dn("no video track found");const s=new Go(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=x.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(L.AudioStreamAcquired);const a=new $o(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=x.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return S(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;rn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Yi(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let p;switch(i.source){case x.Source.Microphone:p="audioinput";break;case x.Source.Camera:p="videoinput"}p&&s.activeDeviceMap.has(p)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(p)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new $o(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Go(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new dn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(p=>{p.track&&p.track===i&&(h=p)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),$(h))),h;const g="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,y=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:g;y&&(r||(r={}),r.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),$(i))),r.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(u=r.red)!==null&&u!==void 0||(r.red=!1));const k=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r);!NC()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),k.simulcast=!1),k.source&&(i.source=k.source);const E=new Promise((p,m)=>S(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==le.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:$(i)}));const f=setTimeout(()=>{m(new Jh("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(f);const v=yield this.publish(i,k,y);p(v)}else try{const f=yield this.publish(i,k,y);p(f)}catch(f){m(f)}}catch(f){m(f)}}));s.pendingPublishPromises.set(i,E);try{return yield E}catch(p){throw p}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Bi),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),$(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>QC(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),$(e))),!1)}publish(e,n,i){return S(this,void 0,void 0,function*(){var r,s,o,a,c,l,u,d,h,g;if(!this.hasPermissionsToPublish(e))throw new Jh("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(N=>Yi(e)&&N.source===e.source)&&e.source!==x.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),$(e))),n.stopMicTrackOnMute&&Jt(e)&&(e.stopOnMute=!0),e.source===x.Source.ScreenShare&&ar()&&(n.simulcast=!1),n.videoCodec==="av1"&&!RC()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!xC()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Dl),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(N=>n.videoCodec===ho(N.mime))||(n.videoCodec=ho(this.enabledPublishVideoCodecs[0].mime)));const k=n.videoCodec;e.on(F.Muted,this.onTrackMuted),e.on(F.Unmuted,this.onTrackUnmuted),e.on(F.Ended,this.handleTrackEnded),e.on(F.UpstreamPaused,this.onTrackUpstreamPaused),e.on(F.UpstreamResumed,this.onTrackUpstreamResumed),e.on(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const E=[],p=!(!((r=n.dtx)!==null&&r!==void 0)||r),m=e.getSourceTrackSettings();m.autoGainControl&&E.push(De.TF_AUTO_GAIN_CONTROL),m.echoCancellation&&E.push(De.TF_ECHO_CANCELLATION),m.noiseSuppression&&E.push(De.TF_NOISE_SUPPRESSION),m.channelCount&&m.channelCount>1&&E.push(De.TF_STEREO),p&&E.push(De.TF_NO_DTX),rn(e)&&e.hasPreConnectBuffer&&E.push(De.TF_PRECONNECT_BUFFER);const f=new ml({cid:e.mediaStreamTrack.id,name:n.name,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),disableDtx:p,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:E});let v;if(e.kind===x.Kind.Video){let N={width:0,height:0};try{N=yield e.waitForDimensions()}catch{const j=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:fs.h720.resolution;N={width:j.width,height:j.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{dims:N}))}f.width=N.width,f.height=N.height,En(e)&&($t(k)&&(e.source===x.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),$(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),f.simulcastCodecs=[new pl({codec:k,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Dl}),n.backupCodec&&k!==n.backupCodec.codec&&f.encryption===ut.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),f.simulcastCodecs.push(new pl({codec:n.backupCodec.codec,cid:""})))),v=Al(e.source===x.Source.ScreenShare,f.width,f.height,n),f.layers=Cf(f.width,f.height,v,$t(n.videoCodec))}else e.kind===x.Kind.Audio&&(v=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(g=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&g!==void 0?g:"high"}]);if(!this.engine||this.engine.isClosed)throw new xe("cannot publish track when not connected");const C=()=>S(this,void 0,void 0,function*(){var N,I,j;if(!this.engine.pcManager)throw new xe("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,v),this.emit(L.LocalSenderCreated,e.sender,e),En(e)&&((N=n.degradationPreference)!==null&&N!==void 0||(n.degradationPreference=OT(e)),e.setDegradationPreference(n.degradationPreference)),v)if(ar()&&e.kind===x.Kind.Audio){let K;for(const de of this.engine.pcManager.publisher.getTransceivers())if(de.sender===e.sender){K=de;break}K&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:K,codec:"opus",maxbr:!((I=v[0])===null||I===void 0)&&I.maxBitrate?v[0].maxBitrate/1e3:0})}else e.codec&&$t(e.codec)&&(!((j=v[0])===null||j===void 0)&&j.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:f.cid,codec:e.codec,maxbr:v[0].maxBitrate/1e3});yield this.engine.negotiate()});let b;const P=new Promise((N,I)=>S(this,void 0,void 0,function*(){var j;try{b=yield this.engine.addTrack(f),N(b)}catch(K){e.sender&&(!((j=this.engine.pcManager)===null||j===void 0)&&j.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(de=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{error:de}))})),I(K)}}));if(this.enabledPublishVideoCodecs.length>0)b=(yield Promise.all([P,C()]))[0];else{b=yield P;let N;if(b.codecs.forEach(I=>{N===void 0&&(N=I.mimeType)}),N&&e.kind===x.Kind.Video){const I=ho(N);I!==k&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{codec:I})),n.videoCodec=I,v=Al(e.source===x.Source.ScreenShare,f.width,f.height,n))}yield C()}const _=new Bl(e.kind,b,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(_.on(F.CpuConstrained,N=>this.onTrackCpuConstrained(N,_)),_.options=n,e.sid=b.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:v,trackInfo:b})),En(e)?e.startMonitor(this.engine.client):rn(e)&&e.startMonitor(),this.addTrackPublication(_),this.emit(L.LocalTrackPublished,_),rn(e)&&b.audioFeatures.includes(De.TF_PRECONNECT_BUFFER)){const N=e.getPreConnectBuffer(),I=e.getPreConnectBufferMimeType();this.on(L.LocalTrackSubscribed,j=>{if(j.trackSid===b.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),$(e))),e.stopPreConnectBuffer()}}),N&&new Promise((K,de)=>S(this,void 0,void 0,function*(){var Ue,$e,Cn,nn,A,W;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),$(e)));const Vt=setTimeout(()=>{de(new Error("agent not active within 10 seconds"))},1e4),yt=yield this.waitUntilActiveAgentPresent();clearTimeout(Vt),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),$(e)));const Tn=yield this.streamBytes({name:"preconnect-buffer",mimeType:I,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[yt.identity],attributes:{trackId:_.trackSid,sampleRate:String((A=m.sampleRate)!==null&&A!==void 0?A:"48000"),channels:String((W=m.channelCount)!==null&&W!==void 0?W:"1")}});try{for(var z=!0,re=un(N),he;he=yield re.next(),Ue=he.done,!Ue;z=!0){nn=he.value,z=!1;const ct=nn;yield Tn.write(ct)}}catch(ct){$e={error:ct}}finally{try{!z&&!Ue&&(Cn=re.return)&&(yield Cn.call(re))}finally{if($e)throw $e.error}}yield Tn.close(),K()}catch(Vt){de(Vt)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),$(e)))}).catch(K=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{error:K}))})}return _})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return S(this,void 0,void 0,function*(){var r;if(this.encryptionType!==ut.NONE)return;let s;if(this.trackPublications.forEach(g=>{g.track&&g.track===e&&(s=g)}),!s)throw new dn("track is not published");if(!En(e))throw new dn("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=RT(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),$(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new ml({cid:c.mediaStreamTrack.id,type:x.kindToProto(e.kind),muted:e.isMuted,source:x.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Cf(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new xe("cannot publish track when not connected");const u=()=>S(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return S(this,void 0,void 0,function*(){var i,r;if(Yi(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),$(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?$(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(F.Muted,this.onTrackMuted),e.off(F.Unmuted,this.onTrackUnmuted),e.off(F.Ended,this.handleTrackEnded),e.off(F.UpstreamPaused,this.onTrackUpstreamPaused),e.off(F.UpstreamResumed,this.onTrackUpstreamResumed),e.off(F.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ke.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),En(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case x.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case x.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(L.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return S(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>S(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>S(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==x.Source.ScreenShare&&l.source!==x.Source.ScreenShareAudio&&(rn(l)||En(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return S(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?H.RELIABLE:H.LOSSY,o=r.destinationIdentities,a=r.topic,c=new Ze({kind:s,value:{case:"user",value:new ug({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a})}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return S(this,void 0,void 0,function*(){const i=new Ze({kind:H.RELIABLE,value:{case:"sipDtmf",value:new dg({code:e,digit:n})}});yield this.engine.sendDataPacket(i,H.RELIABLE)})}sendChatMessage(e,n){return S(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Ze({value:{case:"chatMessage",value:new cl(Object.assign(Object.assign({},i),{timestamp:pe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,H.RELIABLE),this.emit(L.ChatMessage,i),i})}editChatMessage(e,n){return S(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Ze({value:{case:"chatMessage",value:new cl(Object.assign(Object.assign({},i),{timestamp:pe.parse(i.timestamp),editTimestamp:pe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,H.RELIABLE),this.emit(L.ChatMessage,i),i})}sendText(e,n){return S(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(d,h)=>{var g;c[h]=d;const y=c.reduce((k,E)=>k+E,0);(g=n==null?void 0:n.onProgress)===null||g===void 0||g.call(n,y)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),l(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>S(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:g=>{l(g,h+1)}})})))),u.info})}streamText(e){return S(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new ul({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:ni(s.timestamp),totalLength:ni(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new Tg({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?ll.UPDATE:ll.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new Ze({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,H.RELIABLE);let l=0;const u=this,d=new WritableStream({write(y){return S(this,void 0,void 0,function*(){for(const k of WC(y,wf)){yield u.engine.waitForBufferStatusLow(H.RELIABLE);const E=new dl({content:k,streamId:r,chunkIndex:ni(l)}),p=new Ze({destinationIdentities:a,value:{case:"streamChunk",value:E}});yield u.engine.sendDataPacket(p,H.RELIABLE),l+=1}})},close(){return S(this,void 0,void 0,function*(){const y=new hl({streamId:r}),k=new Ze({destinationIdentities:a,value:{case:"streamTrailer",value:y}});yield u.engine.sendDataPacket(k,H.RELIABLE)})},abort(y){console.log("Sink error:",y)}});let h=()=>S(this,void 0,void 0,function*(){yield g.close()});u.engine.once(D.Closing,h);const g=new VT(d,s,()=>this.engine.off(D.Closing,h));return g})}sendFile(e,n){return S(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return S(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return S(this,void 0,void 0,function*(){var n,i,r,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new ul({totalLength:ni((o=l.size)!==null&&o!==void 0?o:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:ni(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new bg({name:l.name})}}),d=new Ze({destinationIdentities:c,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(d,H.RELIABLE);let h=0;const g=new Qe,y=this.engine,k=this.log,E=new WritableStream({write(m){return S(this,void 0,void 0,function*(){const f=yield g.lock();let v=0;try{for(;v<m.byteLength;){const C=m.slice(v,v+wf);yield y.waitForBufferStatusLow(H.RELIABLE);const b=new Ze({destinationIdentities:c,value:{case:"streamChunk",value:new dl({content:C,streamId:a,chunkIndex:ni(h)})}});yield y.sendDataPacket(b,H.RELIABLE),h+=1,v+=C.byteLength}}finally{f()}})},close(){return S(this,void 0,void 0,function*(){const m=new hl({streamId:a}),f=new Ze({destinationIdentities:c,value:{case:"streamTrailer",value:m}});yield y.sendDataPacket(f,H.RELIABLE)})},abort(m){k.error("Sink error:",m)}});return new zT(E,l)})}performRpc(e){return S(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,u)=>S(i,void 0,void 0,function*(){var d,h,g,y;if(rd(o)>bv){u(Te.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&Zt((y=(g=this.engine.latestJoinResponse)===null||g===void 0?void 0:g.serverInfo)===null||y===void 0?void 0:y.version,"1.8.0")<0){u(Te.builtIn("UNSUPPORTED_SERVER"));return}const k=crypto.randomUUID();yield this.publishRpcRequest(r,k,s,o,a-2e3);const E=setTimeout(()=>{this.pendingAcks.delete(k),u(Te.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(k),clearTimeout(p)},2e3);this.pendingAcks.set(k,{resolve:()=>{clearTimeout(E)},participantIdentity:r});const p=setTimeout(()=>{this.pendingResponses.delete(k),u(Te.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(k,{resolve:(m,f)=>{clearTimeout(p),this.pendingAcks.has(k)&&(console.warn("RPC response received before ack",k),this.pendingAcks.delete(k),clearTimeout(E)),f?u(f):l(m??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return S(this,void 0,void 0,function*(){const o=new Ze({destinationIdentities:[e],kind:H.RELIABLE,value:{case:"rpcRequest",value:new hg({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,H.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Te.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),$(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Bi),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(rn(r)||En(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return S(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield at(20)}})}}class YT extends an{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(F.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new pa({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new gg({participantSid:"",trackSids:[this.trackSid]})]});this.emit(F.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?an.SubscriptionStatus.Unsubscribed:super.isSubscribed?an.SubscriptionStatus.Subscribed:an.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?an.PermissionStatus.Allowed:an.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(nc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&nc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:ht.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(F.VisibilityChanged,this.handleVisibilityChange),r.off(F.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(F.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(F.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(F.VisibilityChanged,this.handleVisibilityChange),e.on(F.Ended,this.handleEnded),this.emit(F.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(F.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?F.Muted:F.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(F.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(F.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return nc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new wg({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===x.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)af(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=JC(this.trackInfo,this.requestedMaxQuality);i&&af(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:ht.HIGH})),e.quality=ht.HIGH)}this.emit(F.UpdateSettings,e)}}class Qo extends Iv{static fromParticipantInfo(e,n,i){return new Qo(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:hs.STANDARD;super(n,i||"",r,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(F.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(F.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(F.SubscriptionPermissionChanged,n=>{this.emit(L.TrackSubscriptionPermissionChanged,e,n)}),e.on(F.SubscriptionStatusChanged,n=>{this.emit(L.TrackSubscriptionStatusChanged,e,n)}),e.on(F.Subscribed,n=>{this.emit(L.TrackSubscribed,n,e)}),e.on(F.Unsubscribed,n=>{this.emit(L.TrackUnsubscribed,n,e)}),e.on(F.SubscriptionFailed,n=>{this.emit(L.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(L.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),$(a))),this.emit(L.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new qT(e,n,r,s):l=new WT(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&Fl(l)&&Jt(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=x.kindFromProto(r.type);if(!c)return;a=new YT(c,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==x.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:$(l),newTrack:$(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),$(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(L.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case x.Kind.Audio:this.audioTrackPublications.delete(e);break;case x.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(L.TrackUnpublished,i)}setAudioOutput(e){return S(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;Jt(i.track)&&Fl(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var Z;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Z||(Z={}));const XT=4*1e3;class cr extends tn.EventEmitter{constructor(e){var n,i,r,s;if(super(),n=this,this.state=Z.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=J,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,c)=>S(this,void 0,void 0,function*(){var l;if(!IC())throw Xt()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===Z.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(Z.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Il(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ul(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(g=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(g)}).catch(g=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:g}))}));const d=(g,y,k)=>S(this,void 0,void 0,function*(){var E,p;this.abortController&&this.abortController.abort();const m=new AbortController;this.abortController=m,u==null||u();try{yield this.attemptConnection(k??o,a,c,m),this.abortController=void 0,g()}catch(f){if(this.regionUrlProvider&&f instanceof se&&f.reason!==Y.Cancelled&&f.reason!==Y.NotAllowed){let v=null;try{v=yield this.regionUrlProvider.getNextBestRegionUrl((E=this.abortController)===null||E===void 0?void 0:E.signal)}catch(C){if(C instanceof se&&(C.status===401||C.reason===Y.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(C);return}}v&&!(!((p=this.abortController)===null||p===void 0)&&p.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(f.message,". Retrying with another region: ").concat(v),this.logContext),this.recreateEngine(),yield d(g,y,v)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,of(f)),y(f))}else{let v=Lt.UNKNOWN_REASON;f instanceof se&&(v=of(f)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,v),y(f)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Bi((g,y)=>{d(g,y,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,u,d)=>S(this,void 0,void 0,function*(){var h,g,y;const k=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},d.signal);let E=k.serverInfo;if(E||(E={version:k.serverVersion,region:k.serverRegion}),this.serverInfo=E,this.log.debug("connected to Livekit Server ".concat(Object.entries(E).map(p=>{let[m,f]=p;return"".concat(m,": ").concat(f)}).join(", ")),{room:(h=k.room)===null||h===void 0?void 0:h.name,roomSid:(g=k.room)===null||g===void 0?void 0:g.sid,identity:(y=k.participant)===null||y===void 0?void 0:y.identity}),!E.version)throw new mC("unknown server version");return E.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),k}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>S(this,void 0,void 0,function*(){var u,d;this.state===Z.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},id),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(M.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const g=new se("could not establish signal connection",Y.ServerUnreachable);throw h instanceof Error&&(g.message="".concat(g.message,": ").concat(h.message)),h instanceof se&&(g.reason=h.reason,g.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),g}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new se("Connection attempt aborted",Y.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}it()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),it()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Z.Connected),this.emit(M.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return S(n,[...a],void 0,function(){var l=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,g,y;const k=yield l.disconnectLock.lock();try{if(l.state===Z.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===Z.Connecting||l.state===Z.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(d=l.abortController)===null||d===void 0||d.abort(),(g=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||g===void 0||g.call(h,new se("Client initiated disconnect",Y.Cancelled)),l.connectFuture=void 0),!((y=l.engine)===null||y===void 0)&&y.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(u,Lt.CLIENT_INITIATED),l.engine=void 0}finally{k()}}()})},this.onPageLeave=()=>S(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>S(this,void 0,void 0,function*(){const o=[],a=pt();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const u=tc();u.enabled=!0;const d=new MediaStream([u]);l.srcObject=d,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(M.Disconnected,()=>{l==null||l.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>S(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Z.Reconnecting)&&this.emit(M.Reconnecting)},this.handleSignalRestarted=o=>S(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Z.Connected),this.emit(M.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===$i.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(l.sid);u&&(u.audioLevel=l.level,u.setIsSpeaking(!0),a.push(u))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(M.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const u=this.remoteParticipants.get(l.identity);u&&u.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let u=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=l.level,u.setIsSpeaking(l.active),l.active?a.set(l.sid,u):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,u)=>u.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(M.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const u=x.streamStateFromProto(a.state);u!==l.track.streamState&&(l.track.streamState=u,c.emit(L.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(M.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,c)=>{this.emit(M.DataReceived,a.payload,o,c,a.topic),o==null||o.emit(L.DataReceived,a.payload,c)},this.handleSipDtmf=(o,a)=>{this.emit(M.SipDTMFReceived,a,o),o==null||o.emit(L.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),u=jC(a,this.transcriptionReceivedTimes);l==null||l.emit(F.TranscriptionReceived,u),c==null||c.emit(L.TranscriptionReceived,u,l),this.emit(M.TranscriptionReceived,u,c,l)},this.handleChatMessage=(o,a)=>{const c=BC(a);this.emit(M.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(M.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(M.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(M.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(M.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(M.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>S(this,void 0,void 0,function*(){var o;((o=pt())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(M.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(M.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(M.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(M.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(M.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(M.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(M.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(M.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>S(this,void 0,void 0,function*(){var a,c,l,u,d,h;(a=o.track)===null||a===void 0||a.on(F.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(F.Restarted,this.onLocalTrackRestarted),(d=(u=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(M.LocalTrackPublished,o,this.localParticipant),rn(o.track)&&(yield o.track.checkForSilence())&&this.emit(M.LocalAudioSilenceDetected,o);const g=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),y=Ml(o.source);y&&g&&g!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,g),this.emit(M.ActiveDeviceChanged,y,g))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(F.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(F.Restarted,this.onLocalTrackRestarted),this.emit(M.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>S(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=Ml(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(M.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(M.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(M.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(M.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(M.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},fT),e),this.log=kn((i=this.options.loggerName)!==null&&i!==void 0?i:Bt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Cv),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Tv),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},hT),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Qe,this.localParticipant=new JT("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",qn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",qn(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",qn(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),it()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),cr.cleanupRegistry&&cr.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,s,o){return S(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,Te.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});rd(u)>bv?(c=Te.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=u}catch(u){u instanceof Te?c=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),c=Te.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new YC(this.options.e2ee),this.e2eeManager.on(Mn.ParticipantEncryptionStatusChanged,(n,i)=>{zC(i)&&(this.isE2EEEnabled=n),this.emit(M.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(Mn.EncryptionError,n=>this.emit(M.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return S(this,void 0,void 0,function*(){return this.state===Z.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(D.RoomUpdate,i),e(r.sid))};this.engine.on(D.RoomUpdate,i),this.once(M.Disconnected,()=>{this.engine.off(D.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new DT(this.options),this.engine.on(D.ParticipantUpdate,this.handleParticipantUpdates).on(D.RoomUpdate,this.handleRoomUpdate).on(D.SpeakersChanged,this.handleSpeakersChanged).on(D.StreamStateChanged,this.handleStreamStateUpdate).on(D.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(D.SubscriptionError,this.handleSubscriptionError).on(D.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(D.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(D.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(D.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(D.DataPacketReceived,this.handleDataPacket).on(D.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Z.SignalReconnecting)&&this.emit(M.SignalReconnecting)}).on(D.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Z.Connected)&&this.emit(M.Reconnected)}).on(D.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Z.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(D.Restarting,this.handleRestarting).on(D.SignalRestarted,this.handleSignalRestarted).on(D.Offline,()=>{this.setAndEmitConnectionState(Z.Reconnecting)&&this.emit(M.Reconnecting)}).on(D.DCBufferStatusChanged,(e,n)=>{this.emit(M.DCBufferStatusChanged,e,n)}).on(D.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(L.LocalTrackSubscribed,n),this.emitWhenConnected(M.LocalTrackSubscribed,n,this.localParticipant)}).on(D.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(M.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Le.getInstance().getDevices(e,n)}prepareConnection(e,n){return S(this,void 0,void 0,function*(){if(this.state===Z.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Il(new URL(e))&&n){this.regionUrlProvider=new Ul(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Z.Disconnected&&(this.regionUrl=i,yield fetch(Ol(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Ol(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return S(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Wt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Wt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Wt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Wt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Wt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Wt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Wt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>S(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new ma({reason:Lt.CLIENT_INITIATED,action:Gi.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Wt({scenario:{case:"subscriberBandwidth",value:ni(n)}});break;case"leave-full-reconnect":r=new Wt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return S(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,u,d,h,g;let y=!0,k=!1;const E=o?{exact:r}:r;if(i==="audioinput"){k=s.localParticipant.audioTrackPublications.size===0;const p=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=E;const m=Array.from(s.localParticipant.audioTrackPublications.values()).filter(v=>v.source===x.Source.Microphone);try{y=(yield Promise.all(m.map(v=>{var C;return(C=v.audioTrack)===null||C===void 0?void 0:C.setDeviceId(E)}))).every(v=>v===!0)}catch(v){throw s.options.audioCaptureDefaults.deviceId=p,v}const f=m.some(v=>{var C,b;return(b=(C=v.track)===null||C===void 0?void 0:C.isMuted)!==null&&b!==void 0?b:!1});y&&f&&(k=!0)}else if(i==="videoinput"){k=s.localParticipant.videoTrackPublications.size===0;const p=(c=s.getActiveDevice(i))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=E;const m=Array.from(s.localParticipant.videoTrackPublications.values()).filter(v=>v.source===x.Source.Camera);try{y=(yield Promise.all(m.map(v=>{var C;return(C=v.videoTrack)===null||C===void 0?void 0:C.setDeviceId(E)}))).every(v=>v===!0)}catch(v){throw s.options.videoCaptureDefaults.deviceId=p,v}const f=m.some(v=>{var C,b;return(b=(C=v.track)===null||C===void 0?void 0:C.isMuted)!==null&&b!==void 0?b:!1});y&&f&&(k=!0)}else if(i==="audiooutput"){if(k=!0,!xl()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(l=yield Le.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(u=(g=s.options).audioOutput)!==null&&u!==void 0||(g.audioOutput={});const p=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(m=>m.setAudioOutput({deviceId:r})))}catch(m){throw s.options.audioOutput.deviceId=p,m}}return k&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(M.ActiveDeviceChanged,i,r)),y}()})}setupLocalParticipantEvents(){this.localParticipant.on(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(L.AttributesChanged,this.onLocalAttributesChanged).on(L.TrackMuted,this.onLocalTrackMuted).on(L.TrackUnmuted,this.onLocalTrackUnmuted).on(L.LocalTrackPublished,this.onLocalTrackPublished).on(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(L.MediaDevicesError,this.onMediaDevicesError).on(L.AudioStreamAcquired,this.startAudio).on(L.ChatMessage,this.onLocalChatMessageSent).on(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===Z.Connecting||this.state===Z.Reconnecting){const u=()=>{this.onTrackAdded(e,n,i),d()},d=()=>{this.off(M.Reconnected,u),this.off(M.Connected,u),this.off(M.Disconnected,d)};this.once(M.Reconnected,u),this.once(M.Connected,u),this.once(M.Disconnected,d);return}if(this.state===Z.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=_C(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Z.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(L.AttributesChanged,this.onLocalAttributesChanged).off(L.TrackMuted,this.onLocalTrackMuted).off(L.TrackUnmuted,this.onLocalTrackUnmuted).off(L.LocalTrackPublished,this.onLocalTrackPublished).off(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(L.MediaDevicesError,this.onMediaDevicesError).off(L.AudioStreamAcquired,this.startAudio).off(L.ChatMessage,this.onLocalChatMessageSent).off(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),it()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Z.Disconnected),this.emit(M.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(M.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return S(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:uo(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new jT(o,a,uo(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{s=c,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});r(new BT(o,a,uo(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return S(this,void 0,void 0,function*(){var e,n,i;const r=Le.getInstance().previousDevices,s=yield Le.getInstance().getDevices(void 0,!1),o=pt();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let c of s){const l=r.find(u=>u.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(M.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=qC(c),u=this.localParticipant.getTrackPublication(l);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(g=>g.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(g=>g.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,d[0].deviceId);continue}c==="audioinput"&&!Ko()||c==="videoinput"||d.length>0&&!d.find(g=>g.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Ko())&&(yield this.switchActiveDevice(c,d[0].deviceId))}})}acquireAudioContext(){return S(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=yv())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),at(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(M.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Qo.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Qo(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(M.ParticipantConnected,i),i.on(L.TrackPublished,r=>{this.emitWhenConnected(M.TrackPublished,r,i)}).on(L.TrackSubscribed,(r,s)=>{r.kind===x.Kind.Audio?(r.on(F.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(F.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===x.Kind.Video&&(r.on(F.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(F.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(M.TrackSubscribed,r,s,i)}).on(L.TrackUnpublished,r=>{this.emit(M.TrackUnpublished,r,i)}).on(L.TrackUnsubscribed,(r,s)=>{this.emit(M.TrackUnsubscribed,r,s,i)}).on(L.TrackMuted,r=>{this.emitWhenConnected(M.TrackMuted,r,i)}).on(L.TrackUnmuted,r=>{this.emitWhenConnected(M.TrackUnmuted,r,i)}).on(L.ParticipantMetadataChanged,r=>{this.emitWhenConnected(M.ParticipantMetadataChanged,r,i)}).on(L.ParticipantNameChanged,r=>{this.emitWhenConnected(M.ParticipantNameChanged,r,i)}).on(L.AttributesChanged,r=>{this.emitWhenConnected(M.ParticipantAttributesChanged,r,i)}).on(L.ConnectionQualityChanged,r=>{this.emitWhenConnected(M.ConnectionQualityChanged,r,i)}).on(L.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(M.ParticipantPermissionsChanged,r,i)}).on(L.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(M.TrackSubscriptionStatusChanged,r,s,i)}).on(L.TrackSubscriptionFailed,(r,s)=>{this.emit(M.TrackSubscriptionFailed,r,i,s)}).on(L.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(M.TrackSubscriptionPermissionChanged,r,s,i)}).on(L.Active,()=>{this.emitWhenConnected(M.ParticipantActive,i),i.kind===hs.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&VC(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Be.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Lt.STATE_MISMATCH))):e=0},XT)}clearConnectionReconcile(){this.connectionReconcileInterval&&Be.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(M.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===Z.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===Z.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return S(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new fa({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:pe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new pi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(M.SignalConnected),this.emit(M.Connected),this.setAndEmitConnectionState(Z.Connected),r.video){const o=new Bl(x.Kind.Video,new Ui({source:Pe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Mt.AUDIO,name:"video-dummy"}),new Go(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:sf(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}if(r.audio){const o=new Bl(x.Kind.Audio,new Ui({source:Pe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Mt.AUDIO}),new $o(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:tc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(L.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new pi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:$i.ACTIVE,tracks:[],joinedAt:pe.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=sf(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new Ui({source:Pe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Mt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=tc(),u=new Ui({source:Pe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Mt.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==M.ActiveSpeakersChanged&&e!==M.TranscriptionReceived){const s=Ov(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}cr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Ov(t){return t.map(e=>{if(e)return Array.isArray(e)?Ov(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ot;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ot||(Ot={}));class Zn extends tn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ot.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new cr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return S(this,void 0,void 0,function*(){if(this.status!==Ot.IDLE)throw Error("check is running already");this.setStatus(Ot.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ot.SKIPPED&&this.setStatus(this.isSuccess()?Ot.SUCCESS:Ot.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return S(this,void 0,void 0,function*(){return this.room.state===Z.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return S(this,void 0,void 0,function*(){this.room&&this.room.state!==Z.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ot.SKIPPED)}switchProtocol(e){return S(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(M.Reconnecting,()=>{n=!0}),this.room.once(M.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield at(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class ZT extends Zn{get description(){return"Cloud regions"}perform(){return S(this,void 0,void 0,function*(){const e=new Ul(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return S(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),u=Date.now();for(let y=0;y<c;y++)yield s.write(l);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),g={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(g.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),g})}}const uc=1e4;class eb extends Zn{get description(){return"Connection via UDP vs TCP"}perform(){return S(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(uc/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(uc/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return S(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>S(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(g=>{g.type==="outbound-rtp"?(u.packetsSent=g.packetsSent,u.qualityLimitationDurations=g.qualityLimitationDurations,u.bitrateTotal+=g.targetBitrate,u.count++):g.type==="remote-inbound-rtp"&&(u.packetsLost=g.packetsLost,u.rttTotal+=g.roundTripTime,u.jitterTotal+=g.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,uc)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class tb extends Zn{get description(){return"Can publish audio"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield $T();if(yield vv(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class nb extends Zn{get description(){return"Can publish video"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield HT();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return S(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(c=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=d,l.height=h;const g=l.getContext("2d");g.drawImage(i,0,0);const k=g.getImageData(0,0,l.width,l.height).data;let E=!0;for(let p=0;p<k.length;p+=4)if(k[p]!==0||k[p+1]!==0||k[p+2]!==0){E=!1;break}E?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class ib extends Zn{get description(){return"Resuming connection after interruption"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{i=!0};n.on(M.SignalReconnecting,a).on(M.Reconnecting,a).on(M.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!r||n.state!==Z.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class rb extends Zn{get description(){return"Can connect via TURN"}perform(){return S(this,void 0,void 0,function*(){var e,n;const i=new ed,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class sb extends Zn{get description(){return"Establishing WebRTC connection"}perform(){return S(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(M.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(ob(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),J.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function ob(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class ab extends Zn{get description(){return"Connecting to signal connection via WebSocket"}perform(){return S(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new ed;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===yg.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class lw extends tn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ot.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ot.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return S(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ab)})}checkWebRTC(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(sb)})}checkTURN(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(rb)})}checkReconnect(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ib)})}checkPublishAudio(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(tb)})}checkPublishVideo(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(nb)})}checkConnectionProtocol(){return S(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(eb);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(ZT)})}}const en=Object.create(null);en.open="0";en.close="1";en.ping="2";en.pong="3";en.message="4";en.upgrade="5";en.noop="6";const fo=Object.create(null);Object.keys(en).forEach(t=>{fo[en[t]]=t});const Vl={type:"error",data:"parser error"},Fv=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Nv=typeof ArrayBuffer=="function",Mv=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,ad=({type:t,data:e},n,i)=>Fv&&e instanceof Blob?n?i(e):Ef(e,i):Nv&&(e instanceof ArrayBuffer||Mv(e))?n?i(e):Ef(new Blob([e]),i):i(en[t]+(e||"")),Ef=(t,e)=>{const n=new FileReader;return n.onload=function(){const i=n.result.split(",")[1];e("b"+(i||""))},n.readAsDataURL(t)};function Pf(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let dc;function cb(t,e){if(Fv&&t.data instanceof Blob)return t.data.arrayBuffer().then(Pf).then(e);if(Nv&&(t.data instanceof ArrayBuffer||Mv(t.data)))return e(Pf(t.data));ad(t,!1,n=>{dc||(dc=new TextEncoder),e(dc.encode(n))})}const _f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dr=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<_f.length;t++)Dr[_f.charCodeAt(t)]=t;const lb=t=>{let e=t.length*.75,n=t.length,i,r=0,s,o,a,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(i=0;i<n;i+=4)s=Dr[t.charCodeAt(i)],o=Dr[t.charCodeAt(i+1)],a=Dr[t.charCodeAt(i+2)],c=Dr[t.charCodeAt(i+3)],u[r++]=s<<2|o>>4,u[r++]=(o&15)<<4|a>>2,u[r++]=(a&3)<<6|c&63;return l},ub=typeof ArrayBuffer=="function",cd=(t,e)=>{if(typeof t!="string")return{type:"message",data:Dv(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:db(t.substring(1),e)}:fo[n]?t.length>1?{type:fo[n],data:t.substring(1)}:{type:fo[n]}:Vl},db=(t,e)=>{if(ub){const n=lb(t);return Dv(n,e)}else return{base64:!0,data:t}},Dv=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Lv=String.fromCharCode(30),hb=(t,e)=>{const n=t.length,i=new Array(n);let r=0;t.forEach((s,o)=>{ad(s,!1,a=>{i[o]=a,++r===n&&e(i.join(Lv))})})},fb=(t,e)=>{const n=t.split(Lv),i=[];for(let r=0;r<n.length;r++){const s=cd(n[r],e);if(i.push(s),s.type==="error")break}return i};function pb(){return new TransformStream({transform(t,e){cb(t,n=>{const i=n.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const s=new DataView(r.buffer);s.setUint8(0,126),s.setUint16(1,i)}else{r=new Uint8Array(9);const s=new DataView(r.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(i))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(n)})}})}let hc;function Us(t){return t.reduce((e,n)=>e+n.length,0)}function js(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let i=0;for(let r=0;r<e;r++)n[r]=t[0][i++],i===t[0].length&&(t.shift(),i=0);return t.length&&i<t[0].length&&(t[0]=t[0].slice(i)),n}function mb(t,e){hc||(hc=new TextDecoder);const n=[];let i=0,r=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(i===0){if(Us(n)<1)break;const c=js(n,1);s=(c[0]&128)===128,r=c[0]&127,r<126?i=3:r===126?i=1:i=2}else if(i===1){if(Us(n)<2)break;const c=js(n,2);r=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(Us(n)<8)break;const c=js(n,8),l=new DataView(c.buffer,c.byteOffset,c.length),u=l.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(Vl);break}r=u*Math.pow(2,32)+l.getUint32(4),i=3}else{if(Us(n)<r)break;const c=js(n,r);a.enqueue(cd(s?c:hc.decode(c),e)),i=0}if(r===0||r>t){a.enqueue(Vl);break}}}})}const Av=4;function Re(t){if(t)return gb(t)}function gb(t){for(var e in Re.prototype)t[e]=Re.prototype[e];return t}Re.prototype.on=Re.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};Re.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};Re.prototype.off=Re.prototype.removeListener=Re.prototype.removeAllListeners=Re.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var i,r=0;r<n.length;r++)if(i=n[r],i===e||i.fn===e){n.splice(r,1);break}return n.length===0&&delete this._callbacks["$"+t],this};Re.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(n){n=n.slice(0);for(var i=0,r=n.length;i<r;++i)n[i].apply(this,e)}return this};Re.prototype.emitReserved=Re.prototype.emit;Re.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};Re.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ka=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),Ct=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),vb="arraybuffer";function Uv(t,...e){return e.reduce((n,i)=>(t.hasOwnProperty(i)&&(n[i]=t[i]),n),{})}const yb=Ct.setTimeout,kb=Ct.clearTimeout;function Sa(t,e){e.useNativeTimers?(t.setTimeoutFn=yb.bind(Ct),t.clearTimeoutFn=kb.bind(Ct)):(t.setTimeoutFn=Ct.setTimeout.bind(Ct),t.clearTimeoutFn=Ct.clearTimeout.bind(Ct))}const Sb=1.33;function Cb(t){return typeof t=="string"?Tb(t):Math.ceil((t.byteLength||t.size)*Sb)}function Tb(t){let e=0,n=0;for(let i=0,r=t.length;i<r;i++)e=t.charCodeAt(i),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(i++,n+=4);return n}function jv(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function bb(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function wb(t){let e={},n=t.split("&");for(let i=0,r=n.length;i<r;i++){let s=n[i].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class Eb extends Error{constructor(e,n,i){super(e),this.description=n,this.context=i,this.type="TransportError"}}class ld extends Re{constructor(e){super(),this.writable=!1,Sa(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,i){return super.emitReserved("error",new Eb(e,n,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=cd(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=bb(e);return n.length?"?"+n:""}}class Pb extends ld{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||n()})),this.writable||(i++,this.once("drain",function(){--i||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};fb(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,hb(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=jv()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let Bv=!1;try{Bv=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const _b=Bv;function Rb(){}class xb extends Pb{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,n){const i=this.request({method:"POST",data:e});i.on("success",n),i.on("error",(r,s)=>{this.onError("xhr post error",r,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,i)=>{this.onError("xhr poll error",n,i)}),this.pollXhr=e}}class Yt extends Re{constructor(e,n,i){super(),this.createRequest=e,Sa(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const n=Uv(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var r;i.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=Yt.requestsCount++,Yt.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Rb,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Yt.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Yt.requestsCount=0;Yt.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Rf);else if(typeof addEventListener=="function"){const t="onpagehide"in Ct?"pagehide":"unload";addEventListener(t,Rf,!1)}}function Rf(){for(let t in Yt.requests)Yt.requests.hasOwnProperty(t)&&Yt.requests[t].abort()}const Ib=function(){const t=Vv({xdomain:!1});return t&&t.responseType!==null}();class Ob extends xb{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=Ib&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Yt(Vv,this.uri(),e)}}function Vv(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||_b))return new XMLHttpRequest}catch{}if(!e)try{return new Ct[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const zv=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Fb extends ld{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,i=zv?{}:Uv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,i)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],r=n===e.length-1;ad(i,this.supportsBinary,s=>{try{this.doWrite(i,s)}catch{}r&&ka(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=jv()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const fc=Ct.WebSocket||Ct.MozWebSocket;class Nb extends Fb{createSocket(e,n,i){return zv?new fc(e,n,i):n?new fc(e,n):new fc(e)}doWrite(e,n){this.ws.send(n)}}class Mb extends ld{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=mb(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(n).getReader(),r=pb();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const s=()=>{i.read().then(({done:a,value:c})=>{a||(this.onPacket(c),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],r=n===e.length-1;this._writer.write(i).then(()=>{r&&ka(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Db={websocket:Nb,webtransport:Mb,polling:Ob},Lb=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ab=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function zl(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),i=t.indexOf("]");n!=-1&&i!=-1&&(t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length));let r=Lb.exec(t||""),s={},o=14;for(;o--;)s[Ab[o]]=r[o]||"";return n!=-1&&i!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Ub(s,s.path),s.queryKey=jb(s,s.query),s}function Ub(t,e){const n=/\/{2,9}/g,i=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function jb(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,r,s){r&&(n[r]=s)}),n}const Wl=typeof addEventListener=="function"&&typeof removeEventListener=="function",po=[];Wl&&addEventListener("offline",()=>{po.forEach(t=>t())},!1);class Kn extends Re{constructor(e,n){if(super(),this.binaryType=vb,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const i=zl(e);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=zl(n.host).host);Sa(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{const r=i.prototype.name;this.transports.push(r),this._transportsByName[r]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=wb(this.opts.query)),Wl&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},po.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Av,n.transport=e,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Kn.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Kn.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(n+=Cb(r)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ka(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,i){return this._sendPacket("message",e,n,i),this}send(e,n,i){return this._sendPacket("message",e,n,i),this}_sendPacket(e,n,i,r){if(typeof n=="function"&&(r=n,n=void 0),typeof i=="function"&&(r=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const s={type:e,data:n,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(Kn.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Wl&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=po.indexOf(this._offlineEventListener);i!==-1&&po.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}Kn.protocol=Av;class Bb extends Kn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),i=!1;Kn.priorWebsocketSuccess=!1;const r=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",d=>{if(!i)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Kn.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=n.name,this.emitReserved("upgradeError",h)}}))};function s(){i||(i=!0,u(),n.close(),n=null)}const o=d=>{const h=new Error("probe error: "+d);h.transport=n.name,s(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function c(){o("socket closed")}function l(d){n&&d.name!==n.name&&s()}const u=()=>{n.removeListener("open",r),n.removeListener("error",o),n.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};n.once("open",r),n.once("error",o),n.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&n.push(e[i]);return n}}let Vb=class extends Bb{constructor(e,n={}){const i=typeof e=="object"?e:n;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(r=>Db[r]).filter(r=>!!r)),super(e,i)}};function zb(t,e="",n){let i=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),i=zl(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const s=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port+e,i.href=i.protocol+"://"+s+(n&&n.port===i.port?"":":"+i.port),i}const Wb=typeof ArrayBuffer=="function",qb=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Wv=Object.prototype.toString,Kb=typeof Blob=="function"||typeof Blob<"u"&&Wv.call(Blob)==="[object BlobConstructor]",Hb=typeof File=="function"||typeof File<"u"&&Wv.call(File)==="[object FileConstructor]";function ud(t){return Wb&&(t instanceof ArrayBuffer||qb(t))||Kb&&t instanceof Blob||Hb&&t instanceof File}function mo(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,i=t.length;n<i;n++)if(mo(t[n]))return!0;return!1}if(ud(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return mo(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&mo(t[n]))return!0;return!1}function $b(t){const e=[],n=t.data,i=t;return i.data=ql(n,e),i.attachments=e.length,{packet:i,buffers:e}}function ql(t,e){if(!t)return t;if(ud(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=ql(t[i],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=ql(t[i],e));return n}return t}function Gb(t,e){return t.data=Kl(t.data,e),delete t.attachments,t}function Kl(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Kl(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Kl(t[n],e));return t}const Qb=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Jb=5;var Q;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(Q||(Q={}));class Yb{constructor(e){this.replacer=e}encode(e){return(e.type===Q.EVENT||e.type===Q.ACK)&&mo(e)?this.encodeAsBinary({type:e.type===Q.EVENT?Q.BINARY_EVENT:Q.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===Q.BINARY_EVENT||e.type===Q.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=$b(e),i=this.encodeAsString(n.packet),r=n.buffers;return r.unshift(i),r}}function xf(t){return Object.prototype.toString.call(t)==="[object Object]"}class dd extends Re{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const i=n.type===Q.BINARY_EVENT;i||n.type===Q.BINARY_ACK?(n.type=i?Q.EVENT:Q.ACK,this.reconstructor=new Xb(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(ud(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const i={type:Number(e.charAt(0))};if(Q[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===Q.BINARY_EVENT||i.type===Q.BINARY_ACK){const s=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(s,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");i.attachments=Number(o)}if(e.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););i.nsp=e.substring(s,n)}else i.nsp="/";const r=e.charAt(n+1);if(r!==""&&Number(r)==r){const s=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}i.id=Number(e.substring(s,n+1))}if(e.charAt(++n)){const s=this.tryParse(e.substr(n));if(dd.isPayloadValid(i.type,s))i.data=s;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case Q.CONNECT:return xf(n);case Q.DISCONNECT:return n===void 0;case Q.CONNECT_ERROR:return typeof n=="string"||xf(n);case Q.EVENT:case Q.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Qb.indexOf(n[0])===-1);case Q.ACK:case Q.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Xb{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Gb(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Zb=Object.freeze(Object.defineProperty({__proto__:null,Decoder:dd,Encoder:Yb,get PacketType(){return Q},protocol:Jb},Symbol.toStringTag,{value:"Module"}));function Ft(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const ew=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class qv extends Re{constructor(e,n,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ft(e,"open",this.onopen.bind(this)),Ft(e,"packet",this.onpacket.bind(this)),Ft(e,"error",this.onerror.bind(this)),Ft(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var i,r,s;if(ew.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const o={type:Q.EVENT,data:n};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const u=this.ids++,d=n.pop();this._registerAckCallback(u,d),o.id=u}const a=(r=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||r===void 0?void 0:r.writable,c=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,n){var i;const r=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(r===void 0){this.acks[e]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},r),o=(...a)=>{this.io.clearTimeoutFn(s),n.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...n){return new Promise((i,r)=>{const s=(o,a)=>o?r(o):i(a);s.withError=!0,n.push(s),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...s)=>i!==this._queue[0]?void 0:(r!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(r)):(this._queue.shift(),n&&n(null,...s)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Q.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Q.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Q.EVENT:case Q.BINARY_EVENT:this.onevent(e);break;case Q.ACK:case Q.BINARY_ACK:this.onack(e);break;case Q.DISCONNECT:this.ondisconnect();break;case Q.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const i of n)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let i=!1;return function(...r){i||(i=!0,n.packet({type:Q.ACK,id:e,data:r}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Q.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const i of n)i.apply(this,e.data)}}}function hr(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}hr.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};hr.prototype.reset=function(){this.attempts=0};hr.prototype.setMin=function(t){this.ms=t};hr.prototype.setMax=function(t){this.max=t};hr.prototype.setJitter=function(t){this.jitter=t};class Hl extends Re{constructor(e,n){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Sa(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((i=n.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new hr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const r=n.parser||Zb;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Vb(this.uri,this.opts);const n=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const r=Ft(n,"open",function(){i.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Ft(n,"error",s);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{r(),s(new Error("timeout")),n.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ft(e,"ping",this.onping.bind(this)),Ft(e,"data",this.ondata.bind(this)),Ft(e,"error",this.onerror.bind(this)),Ft(e,"close",this.onclose.bind(this)),Ft(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){ka(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new qv(this,e,n),this.nsps[e]=i),i}_destroy(e){const n=Object.keys(this.nsps);for(const i of n)if(this.nsps[i].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let i=0;i<n.length;i++)this.engine.write(n[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},n);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Rr={};function go(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=zb(t,e.path||"/socket.io"),i=n.source,r=n.id,s=n.path,o=Rr[r]&&s in Rr[r].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Hl(i,e):(Rr[r]||(Rr[r]=new Hl(i,e)),c=Rr[r]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(go,{Manager:Hl,Socket:qv,io:go,connect:go});const tw="http://localhost:5000";function nw({onAuthSuccess:t}){const[e,n]=q.useState("login"),[i,r]=q.useState({name:"",email:"",password:"",avatar:"👨"}),[s,o]=q.useState(""),[a,c]=q.useState(!1),l=["👨","👩","👦","👧","🧑","👴","👵","🤖"],u=h=>{const{name:g,value:y}=h.target;r({...i,[g]:y})},d=async h=>{var g,y;h.preventDefault(),c(!0),o("");try{const k=await fetch(`${tw}/api/auth/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name,email:i.email,password:i.password,avatar:i.avatar})}),E=await k.json();if(!k.ok)throw new Error(E.error||"Failed");localStorage.setItem("token",E.token),localStorage.setItem("user_name",((g=E.user)==null?void 0:g.name)||""),(y=E.user)!=null&&y.avatar&&localStorage.setItem("user_avatar",E.user.avatar),t==null||t(),window.location.reload()}catch(k){o(k.message)}finally{c(!1)}};return T.jsx("div",{className:"auth-wrapper",children:T.jsxs("div",{className:"auth-card",children:[T.jsxs("div",{className:"auth-header",children:[T.jsx("div",{className:"auth-title",children:e==="login"?"Welcome back":"Create your account"}),T.jsx("div",{className:"auth-subtitle",children:"Virtual Office"})]}),s&&T.jsx("div",{className:"auth-error",children:s}),T.jsxs("form",{onSubmit:d,className:"auth-form",children:[e==="register"&&T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"name",children:"Name"}),T.jsx("input",{id:"name",name:"name",value:i.name,onChange:u,required:!0})]}),T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"email",children:"Email"}),T.jsx("input",{id:"email",type:"email",name:"email",value:i.email,onChange:u,required:!0})]}),T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"password",children:"Password"}),T.jsx("input",{id:"password",type:"password",name:"password",value:i.password,onChange:u,required:!0})]}),e==="register"&&T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"avatar",children:"Avatar"}),T.jsx("div",{className:"avatar-grid",children:l.map(h=>T.jsx("button",{type:"button",className:`avatar-item ${i.avatar===h?"selected":""}`,onClick:()=>r({...i,avatar:h}),"aria-pressed":i.avatar===h,children:T.jsx("span",{className:"avatar-emoji",role:"img","aria-label":"avatar",children:h})},h))})]}),T.jsx("button",{type:"submit",className:"btn auth-submit",disabled:a,children:a?"Please wait…":e==="login"?"Login":"Register"})]}),T.jsx("div",{className:"auth-switch",children:e==="login"?T.jsxs("span",{children:["Need an account?",T.jsx("button",{className:"link-btn",onClick:()=>n("register"),children:"Register"})]}):T.jsxs("span",{children:["Have an account?",T.jsx("button",{className:"link-btn",onClick:()=>n("login"),children:"Login"})]})})]})})}const $l={"main-office":{name:"Main Office",grid:[["W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","W"],["W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W","W"]]}},If={"main-office":[{type:"desk-wood",x:2,y:2,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!0,hasLamp:!1,hasCoffee:!0,hasNotebook:!0,hasPhone:!1,hasBooks:!0},{type:"office-chair",x:2,y:3,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:5,y:2,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!1,hasLamp:!0,hasCoffee:!1,hasNotebook:!1,hasPhone:!0,hasBooks:!1},{type:"office-chair",x:5,y:3,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:8,y:2,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!0,hasLamp:!1,hasCoffee:!1,hasNotebook:!0,hasPhone:!1,hasBooks:!0},{type:"office-chair",x:8,y:3,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:11,y:2,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!1,hasLamp:!0,hasCoffee:!0,hasNotebook:!1,hasPhone:!0,hasBooks:!1},{type:"office-chair",x:11,y:3,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:2,y:6,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!0,hasPhone:!0,hasBooks:!1},{type:"office-chair",x:2,y:7,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:5,y:6,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!0,hasLamp:!0,hasCoffee:!0,hasNotebook:!1,hasPhone:!1,hasBooks:!0},{type:"office-chair",x:5,y:7,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:8,y:6,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!0,hasPhone:!0,hasBooks:!1},{type:"office-chair",x:8,y:7,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:11,y:6,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!0,hasLamp:!1,hasCoffee:!0,hasNotebook:!1,hasPhone:!1,hasBooks:!0},{type:"office-chair",x:11,y:7,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"kitchen-counter",x:15,y:4,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"sink",x:16,y:4,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"refrigerator",x:17,y:4,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"coffee-machine",x:15,y:5,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"microwave",x:16,y:5,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"water-cooler",x:17,y:5,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"lounge-sofa",x:20,y:8,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"coffee-table",x:21,y:8,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"lounge-chair",x:22,y:8,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"lounge-chair",x:20,y:9,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-table",x:6,y:10,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:5,y:11,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:7,y:11,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:6,y:12,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"filing-cabinet",x:24,y:2,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"printer",x:24,y:4,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"filing-cabinet",x:25,y:2,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"plant-large",x:18,y:12,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"plant-large",x:26,y:8,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"window",x:27,y:14,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"window",x:27,y:16,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:2,y:10,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!1,hasLamp:!0,hasCoffee:!1,hasNotebook:!0,hasPhone:!0,hasBooks:!1},{type:"office-chair",x:2,y:11,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"desk-wood",x:5,y:10,hasComputer:!0,hasMonitor:!0,hasKeyboard:!0,hasMouse:!0,hasPlant:!0,hasLamp:!1,hasCoffee:!0,hasNotebook:!1,hasPhone:!1,hasBooks:!0},{type:"office-chair",x:5,y:11,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-table",x:15,y:12,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:14,y:13,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:16,y:13,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1},{type:"conference-chair",x:15,y:14,hasComputer:!1,hasMonitor:!1,hasKeyboard:!1,hasMouse:!1,hasPlant:!1,hasLamp:!1,hasCoffee:!1,hasNotebook:!1,hasPhone:!1,hasBooks:!1}]},iw=({currentRoom:t,children:e})=>{const n=$l[t]||$l["main-office"],i=If[t]||If["main-office"],[r,s]=q.useState(1),[o,a]=q.useState({x:0,y:0}),[c,l]=q.useState(!1),[u,d]=q.useState({x:0,y:0}),h=q.useRef(null),g=f=>{f.preventDefault();const v=f.deltaY>0?.9:1.1,C=Math.max(.5,Math.min(3,r*v)),b=h.current.getBoundingClientRect(),P=f.clientX-b.left,_=f.clientY-b.top,N=C/r,I=P-(P-o.x)*N,j=_-(_-o.y)*N;s(C),a({x:I,y:j})},y=f=>{f.button===0&&(l(!0),d({x:f.clientX-o.x,y:f.clientY-o.y}))},k=f=>{c&&a({x:f.clientX-u.x,y:f.clientY-u.y})},E=()=>{l(!1)},p=()=>{s(1),a({x:0,y:0})};q.useEffect(()=>{const f=()=>l(!1);return document.addEventListener("mouseup",f),()=>document.removeEventListener("mouseup",f)},[]);const m=f=>{const v={position:"absolute",left:`${f.x*3.33}%`,top:`${f.y*4}%`,width:"3.33%",height:"4%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",zIndex:10};switch(f.type){case"desk-wood":return T.jsx("div",{style:v,className:"office-object desk-wood",children:T.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",height:"100%",position:"relative"},children:[T.jsx("div",{style:{fontSize:"14px",marginBottom:"1px"},children:"🖥️"}),f.hasComputer&&T.jsx("div",{style:{fontSize:"10px"},children:"💻"}),f.hasMonitor&&T.jsx("div",{style:{fontSize:"12px",position:"absolute",top:"1px",left:"50%",transform:"translateX(-50%)"},children:"🖥️"}),f.hasKeyboard&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",bottom:"1px",left:"1px"},children:"⌨️"}),f.hasMouse&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",bottom:"1px",right:"1px"},children:"🖱️"}),f.hasPlant&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",top:"1px",right:"1px"},children:"🌱"}),f.hasLamp&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",top:"1px",left:"1px"},children:"💡"}),f.hasCoffee&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",bottom:"1px",left:"1px"},children:"☕"}),f.hasNotebook&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",bottom:"1px",right:"1px"},children:"📓"}),f.hasPhone&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:"📱"}),f.hasBooks&&T.jsx("div",{style:{fontSize:"8px",position:"absolute",bottom:"1px",right:"1px"},children:"📚"})]})},`${f.type}-${f.x}-${f.y}`);case"office-chair":return T.jsx("div",{style:v,className:"office-object office-chair",children:"🪑"},`${f.type}-${f.x}-${f.y}`);case"kitchen-counter":return T.jsx("div",{style:v,className:"office-object kitchen-counter",children:"🍽️"},`${f.type}-${f.x}-${f.y}`);case"sink":return T.jsx("div",{style:v,className:"office-object sink",children:"🚰"},`${f.type}-${f.x}-${f.y}`);case"refrigerator":return T.jsx("div",{style:v,className:"office-object refrigerator",children:"🧊"},`${f.type}-${f.x}-${f.y}`);case"coffee-machine":return T.jsx("div",{style:v,className:"office-object coffee-machine",children:"☕"},`${f.type}-${f.x}-${f.y}`);case"microwave":return T.jsx("div",{style:v,className:"office-object microwave",children:"🔥"},`${f.type}-${f.x}-${f.y}`);case"lounge-sofa":return T.jsx("div",{style:v,className:"office-object lounge-sofa",children:"🛋️"},`${f.type}-${f.x}-${f.y}`);case"coffee-table":return T.jsx("div",{style:v,className:"office-object coffee-table",children:"🫖"},`${f.type}-${f.x}-${f.y}`);case"lounge-chair":return T.jsx("div",{style:v,className:"office-object lounge-chair",children:"🪑"},`${f.type}-${f.x}-${f.y}`);case"plant-large":return T.jsx("div",{style:v,className:"office-object plant-large",children:"🌳"},`${f.type}-${f.x}-${f.y}`);case"window":return T.jsx("div",{style:v,className:"office-object window",children:"🪟"},`${f.type}-${f.x}-${f.y}`);case"conference-table":return T.jsx("div",{style:v,className:"office-object conference-table",children:"🗣️"},`${f.type}-${f.x}-${f.y}`);case"conference-chair":return T.jsx("div",{style:v,className:"office-object conference-chair",children:"🪑"},`${f.type}-${f.x}-${f.y}`);case"filing-cabinet":return T.jsx("div",{style:v,className:"office-object filing-cabinet",children:"📁"},`${f.type}-${f.x}-${f.y}`);case"printer":return T.jsx("div",{style:v,className:"office-object printer",children:"🖨️"},`${f.type}-${f.x}-${f.y}`);case"water-cooler":return T.jsx("div",{style:v,className:"office-object water-cooler",children:"💧"},`${f.type}-${f.x}-${f.y}`);default:return T.jsx("div",{style:v,className:"office-object",children:"📦"},`${f.type||"obj"}-${f.x}-${f.y}`)}};return T.jsxs("div",{className:"office-grid-container",children:[T.jsxs("div",{className:"zoom-controls",children:[T.jsx("button",{title:"Zoom in",onClick:()=>s(Math.min(3,r+.2)),className:"zoom-btn",children:"+"}),T.jsxs("span",{className:"zoom-level",children:[Math.round(r*100),"%"]}),T.jsx("button",{title:"Zoom out",onClick:()=>s(Math.max(.5,r-.2)),className:"zoom-btn",children:"−"}),T.jsx("button",{title:"Reset view",onClick:p,className:"reset-btn",children:"⌂"})]}),T.jsxs("div",{ref:h,className:"office-grid",style:{display:"grid",gridTemplateColumns:`repeat(${n.grid[0].length}, 1fr)`,gridTemplateRows:`repeat(${n.grid.length}, 1fr)`,width:"100%",height:"100%",position:"relative",transform:`scale(${r}) translate(${o.x/r}px, ${o.y/r}px)`,transformOrigin:"0 0",cursor:c?"grabbing":"grab"},onWheel:g,onMouseDown:y,onMouseMove:k,onMouseUp:E,children:[n.grid.map((f,v)=>f.map((C,b)=>T.jsx("div",{className:`office-tile ${C==="W"?"wall":"floor"}`},`${b}-${v}`))),T.jsx("div",{className:"office-objects",children:i.map(f=>m(f))}),T.jsx("div",{className:"characters-container",children:e})]})]})},Of=({user:t,onMove:e,isCurrentUser:n,showRadius:i=!1,radiusTiles:r=3})=>{const s=q.useRef(null);q.useEffect(()=>{if(!n)return;const a=c=>{const l={...t.position};let u={...l};switch(c.key){case"ArrowUp":case"w":case"W":u.y=Math.max(1,l.y-1);break;case"ArrowDown":case"s":case"S":u.y=Math.min(23,l.y+1);break;case"ArrowLeft":case"a":case"A":u.x=Math.max(1,l.x-1);break;case"ArrowRight":case"d":case"D":u.x=Math.min(28,l.x+1);break;default:return}(u.x!==l.x||u.y!==l.y)&&e(u)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[t.position,e,n]);const o=a=>({"👨":"#4A90E2","👩":"#E91E63","👦":"#8BC34A","👧":"#FF9800","🧑":"#9C27B0","👴":"#607D8B","👵":"#FF5722","🤖":"#795548"})[a]||"#64FFDA";return T.jsxs("div",{style:{position:"absolute",left:`${t.position.x*3.33}%`,top:`${t.position.y*4}%`,zIndex:1e3},children:[i&&T.jsx("div",{"aria-hidden":!0,style:{position:"absolute",left:"-50%",top:"-50%",width:`${r*2*3.33}%`,height:`${r*2*4}%`,borderRadius:"50%",border:"2px dashed rgba(100,255,218,0.5)",background:"radial-gradient(circle, rgba(100,255,218,0.08) 0%, rgba(100,255,218,0.02) 60%, rgba(0,0,0,0) 70%)",transform:"translate(-50%, -50%)",pointerEvents:"none"}}),T.jsxs("div",{ref:s,className:"character",style:{position:"relative",backgroundColor:o(t.avatar),border:n?"3px solid #64FFDA":"2px solid #ffffff"},title:t.name,children:[t.avatar,T.jsx("div",{className:"character-name",children:t.name})]})]})},rw=({onJoinOffice:t,onRoomChange:e,currentRoom:n,user:i,account:r,collapsed:s,onToggle:o})=>{const[a,c]=q.useState({name:(r==null?void 0:r.name)||localStorage.getItem("user_name")||"",avatar:(r==null?void 0:r.avatar)||localStorage.getItem("user_avatar")||"👨"}),l=["👨","👩","👦","👧","🧑","👴","👵","🤖"],u=[{id:"main-office",name:"Main Office"},{id:"meeting-room",name:"Meeting Room"},{id:"break-room",name:"Break Room"}],d=g=>{g.preventDefault(),localStorage.getItem("token")&&a.name.trim()&&t(a)},h=g=>{c({...a,[g.target.name]:g.target.value})};return i?T.jsxs("div",{className:"controls",children:[T.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[T.jsx("h3",{children:"Office Controls"}),T.jsx("button",{className:"panel-close",onClick:o,"aria-label":s?"Open controls":"Close controls",children:s?"⚙":"✕"})]}),s?null:T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"control-group",children:[T.jsx("label",{children:"Current Room:"}),T.jsx("select",{value:n,onChange:g=>e(g.target.value),children:u.map(g=>T.jsx("option",{value:g.id,children:g.name},g.id))})]}),T.jsxs("div",{className:"control-group",children:[T.jsx("label",{children:"Movement:"}),T.jsx("p",{style:{fontSize:"12px",color:"#b0b0b0",marginTop:"5px"},children:"Use WASD or Arrow Keys to move"})]}),T.jsxs("div",{className:"control-group",children:[T.jsx("label",{children:"Current User:"}),T.jsxs("p",{style:{color:"#64ffda",marginTop:"5px"},children:[i.name," (",i.avatar,")"]})]})]})]}):T.jsxs("div",{className:"controls",children:[T.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[T.jsx("h3",{children:"Join Virtual Office"}),T.jsx("button",{className:"panel-close",onClick:o,"aria-label":s?"Open controls":"Close controls",children:s?"⚙":"✕"})]}),s?null:T.jsxs("form",{onSubmit:d,children:[T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"name",children:"Your Name:"}),T.jsx("input",{type:"text",id:"name",name:"name",value:a.name,onChange:h,placeholder:"Enter your name",required:!0})]}),T.jsxs("div",{className:"control-group",children:[T.jsx("label",{htmlFor:"avatar",children:"Choose Avatar:"}),T.jsx("select",{id:"avatar",name:"avatar",value:a.avatar,onChange:h,children:l.map(g=>T.jsxs("option",{value:g,children:[g," ",g==="👨"?"Person":""]},g))})]}),T.jsx("button",{type:"submit",className:"btn",children:"Enter Office"})]})]})},sw=({messages:t,onSendMessage:e,currentUser:n,account:i,users:r=[],dmPeerId:s,onSelectPeer:o,dmThreads:a={},unreadByUserId:c={},onClose:l})=>{const[u,d]=q.useState(""),h=q.useRef(null),g=()=>{var p;(p=h.current)==null||p.scrollIntoView({behavior:"smooth"})};q.useEffect(()=>{g()},[t]);const y=p=>{p.preventDefault(),u.trim()&&(e(u),d(""))},k=p=>new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),E=p=>p.fromUserId===(i==null?void 0:i.id);return T.jsx("div",{className:"chat-panel",style:{display:"flex",height:"100%",flexDirection:"column"},children:s?T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"chat-header",style:{display:"flex",alignItems:"center",gap:8},children:[T.jsxs("button",{className:"back-btn",onClick:()=>o==null?void 0:o(null),children:[T.jsx("span",{style:{marginRight:6},children:"←"}),"Back"]}),T.jsx("div",{style:{fontWeight:600},children:(()=>{const p=r.find(m=>m.id===s);return p?p.name:""})()})]}),T.jsxs("div",{className:"chat-messages",children:[t.map((p,m)=>T.jsx("div",{className:`message ${E(p)?"me":"them"}`,children:T.jsxs("div",{className:"bubble",children:[T.jsxs("div",{className:"meta",children:[T.jsx("span",{className:"name",children:E(p)?"You":p.fromName}),T.jsx("span",{className:"time",children:k(p.timestamp)})]}),T.jsx("div",{className:"text",children:p.message})]})},m)),T.jsx("div",{ref:h})]}),T.jsx("form",{onSubmit:y,className:"chat-input",children:T.jsx("input",{type:"text",value:u,onChange:p=>d(p.target.value),placeholder:"Type a message...",maxLength:200})})]}):T.jsxs(T.Fragment,{children:[T.jsxs("div",{className:"chat-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[T.jsx("span",{children:"Chats"}),l&&T.jsx("button",{className:"panel-close",onClick:()=>l==null?void 0:l(),"aria-label":"Close chat",children:"✕"})]}),T.jsx("div",{style:{padding:"12px 15px 10px",borderBottom:"1px solid rgba(245,158,11,0.18)"},children:T.jsx("input",{type:"text",className:"chat-search",placeholder:"Search users…",onChange:p=>{const m=p.target.value.toLowerCase();Array.from(document.querySelectorAll(".chat-user-item")).forEach(v=>{const C=(v.getAttribute("data-name")||"").toLowerCase();v.style.display=C.includes(m)?"flex":"none"})}})}),T.jsx("div",{style:{overflowY:"auto",padding:"0 15px 12px",flex:1},children:r.map(p=>{const m=c[p.id]||0;return T.jsxs("button",{className:"chat-user-item","data-name":p.name,onClick:()=>o==null?void 0:o(p.id),style:{width:"100%",display:"flex",alignItems:"center",gap:12,textAlign:"left",padding:"12px 10px",background:"transparent",border:"none",color:"#fff",cursor:"pointer",borderRadius:10},children:[T.jsx("span",{style:{fontSize:18,width:26,textAlign:"center"},children:p.avatar||"👤"}),T.jsx("span",{style:{fontWeight:600,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.name}),m>0&&T.jsx("span",{style:{background:"#4F46E5",color:"#fff",borderRadius:999,padding:"2px 6px",fontSize:12,fontWeight:700},children:m})]},p.id)})})]})})},ow=({currentRoom:t,userCount:e,isConnected:n})=>{const i=$l[t];return T.jsxs("div",{className:"room-info",children:[T.jsxs("div",{className:"ri-header",children:[T.jsxs("div",{className:"ri-title",children:[T.jsx("span",{className:"ri-room-icon","aria-hidden":!0,children:"🏢"}),T.jsx("span",{className:"ri-room-name",children:(i==null?void 0:i.name)||"Unknown Room"})]}),T.jsx("span",{className:`ri-status ${n?"ok":"down"}`,children:n?"Connected":"Disconnected"})]}),T.jsxs("div",{className:"ri-body",children:[T.jsxs("div",{className:"ri-item",title:"Users online",children:[T.jsx("span",{className:"ri-item-icon","aria-hidden":!0,children:"👥"}),T.jsxs("span",{className:"ri-item-text",children:[e," online"]})]}),T.jsx("div",{className:"ri-divider"}),T.jsxs("div",{className:"ri-item",title:"Room id",children:[T.jsx("span",{className:"ri-item-icon","aria-hidden":!0,children:"🗂️"}),T.jsx("span",{className:"ri-item-text",children:t})]})]})]})};function aw(){const[t,e]=q.useState(null),[n,i]=q.useState(null),[r,s]=q.useState([]);q.useState([]);const[o,a]=q.useState({}),[c,l]=q.useState("main-office"),[u,d]=q.useState(!1),[h,g]=q.useState(!0),[y,k]=q.useState(null),[E,p]=q.useState([]),[m,f]=q.useState(null),[v,C]=q.useState({}),[b,P]=q.useState(!1),[_,N]=q.useState(!1),I=q.useRef(null),[j,K]=q.useState(null),[de,Ue]=q.useState(!1),[$e,Cn]=q.useState(null),nn=3,A=q.useRef(null);function W(){try{const U=A.current;if(!U)return;for(;U.firstChild;)U.removeChild(U.firstChild)}catch{}}const z=q.useMemo(()=>{var ae,ye,ne,Fe;if(!n)return null;const U=r.filter(Ne=>Ne.room===n.room);let V=1/0,ee=null;for(const Ne of U){const Ee=(((ae=Ne.position)==null?void 0:ae.x)||0)-(((ye=n.position)==null?void 0:ye.x)||0),fr=(((ne=Ne.position)==null?void 0:ne.y)||0)-(((Fe=n.position)==null?void 0:Fe.y)||0),hd=Math.hypot(Ee,fr);hd<V&&(V=hd,ee=Ne)}return V<=nn?ee:null},[r,n]);q.useEffect(()=>{if(Cn((z==null?void 0:z.id)||null),!z&&j){try{j.disconnect()}catch{}K(null),Ue(!1)}},[z]);async function re(U){const V=localStorage.getItem("token"),ee=y,ae=await fetch("/api/livekit/token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V}`},body:JSON.stringify({room:U,identity:ee==null?void 0:ee.id,name:ee==null?void 0:ee.name})});if(!ae.ok)throw new Error("failed token");return ae.json()}async function he(){if(!n||!$e)return null;const U=`${n.room}__pair__${[t.id,$e].sort().join("__")}`;if(j&&j.name===U)return j;try{if(j){try{await j.disconnect()}catch{}K(null)}const{token:V,url:ee}=await re(U),ae=new cr({adaptiveStream:!0});return await ae.connect(ee,V,{autoSubscribe:!0}),K(ae),ae.on("disconnected",()=>{K(null),Ue(!1),W()}),ae.on("trackSubscribed",(ye,ne,Fe)=>{var Ne;try{if((ne==null?void 0:ne.source)==="screen_share"&&ye.kind==="video"){const Ee=document.createElement("video");Ee.autoplay=!0,Ee.muted=!0,Ee.playsInline=!0,Ee.style.maxWidth="380px",Ee.style.maxHeight="240px",Ee.style.width="auto",Ee.style.height="auto",Ee.style.borderRadius="10px",Ee.style.boxShadow="0 12px 28px rgba(0,0,0,0.35)",Ee.dataset.participantSid=Fe.sid,ye.attach(Ee),(Ne=A.current)==null||Ne.appendChild(Ee)}}catch(Ee){console.error("attach screen track failed",Ee)}}),ae.on("trackUnsubscribed",(ye,ne,Fe)=>{try{if((ne==null?void 0:ne.source)==="screen_share"&&ye.kind==="video"){const Ne=A.current;if(!Ne)return;const Ee=Array.from(Ne.querySelectorAll("video"));for(const fr of Ee)if(fr.dataset.participantSid===Fe.sid){try{ye.detach(fr)}catch{}Ne.removeChild(fr)}}}catch{}}),ae.on("participantDisconnected",ye=>{try{const ne=A.current;if(!ne)return;const Fe=Array.from(ne.querySelectorAll("video"));for(const Ne of Fe)Ne.dataset.participantSid===ye.sid&&ne.removeChild(Ne)}catch{}}),ae}catch(V){return console.error("LiveKit join failed",V),null}}async function Vt(){if(!$e)return;const U=await he();if(!U)return;if(U.localParticipant.getTrackPublications().find(ee=>ee.source==="screen_share")&&de){await U.localParticipant.setScreenShareEnabled(!1),Ue(!1);return}try{await U.localParticipant.setScreenShareEnabled(!0),Ue(!0)}catch(ee){console.error("Screen share failed",ee),Ue(!1)}}q.useEffect(()=>{const U=localStorage.getItem("token");if(!U){k(null);return}fetch("/api/auth/me",{headers:{Authorization:`Bearer ${U}`}}).then(async V=>{if(!V.ok)throw new Error("unauthorized");return V.json()}).then(({user:V})=>{k(V),V!=null&&V.name&&localStorage.setItem("user_name",V.name),V!=null&&V.avatar&&localStorage.setItem("user_avatar",V.avatar)}).catch(()=>{localStorage.removeItem("token"),localStorage.removeItem("user_name"),localStorage.removeItem("user_avatar"),k(null)})},[]),q.useEffect(()=>{fetch("/api/users").then(U=>U.json()).then(({users:U})=>p(U||[])).catch(()=>p([]))},[]),q.useEffect(()=>{const U=localStorage.getItem("token");if(!U){e(null);return}const V=go("http://localhost:5000",{auth:{token:U}});return e(V),V.on("connect",()=>{d(!0),console.log("Connected to server")}),V.on("disconnect",()=>{d(!1),console.log("Disconnected from server")}),()=>{V.close()}},[]),q.useEffect(()=>{if(!t)return;const U=ye=>s(ne=>[...ne.filter(Fe=>Fe.id!==ye.id),ye]),V=ye=>s(ne=>ne.filter(Fe=>Fe.id!==ye)),ee=ye=>s(ne=>ne.map(Fe=>Fe.id===ye.id?{...Fe,position:ye.position,room:ye.room}:Fe)),ae=ye=>s(ye.filter(ne=>ne.id!==t.id));return t.on("user-joined",U),t.on("user-left",V),t.on("user-moved",ee),t.on("room-users",ae),()=>{t.off("user-joined",U),t.off("user-left",V),t.off("user-moved",ee),t.off("room-users",ae)}},[t]),q.useEffect(()=>{if(!t)return;const U=V=>{a(ne=>{const Fe=y==null?void 0:y.id,Ne=V.fromUserId===Fe?V.toUserId:V.fromUserId,Ee=ne[Ne]||[];return{...ne,[Ne]:[...Ee,V]}});const ee=y==null?void 0:y.id,ae=V.fromUserId===ee?V.toUserId:V.fromUserId;(!(ae===m)||document.visibilityState!=="visible")&&C(ne=>({...ne,[ae]:(ne[ae]||0)+1}))};return t.on("new-direct-message",U),()=>{t.off("new-direct-message",U)}},[t,y==null?void 0:y.id,m]),q.useEffect(()=>{if(!m&&E.length>0){const U=E.find(V=>V.id!==(y==null?void 0:y.id))||E[0];U!=null&&U.id&&(f(U.id),yt(U.id))}},[E,y==null?void 0:y.id]),q.useEffect(()=>{function U(V){_&&I.current&&!I.current.contains(V.target)&&N(!1)}return document.addEventListener("mousedown",U),()=>document.removeEventListener("mousedown",U)},[_]);const yt=U=>{const V=localStorage.getItem("token");!V||!U||fetch(`/api/chat/dm/${encodeURIComponent(U)}?limit=200`,{headers:{Authorization:`Bearer ${V}`}}).then(ee=>ee.json()).then(({messages:ee})=>a(ae=>({...ae,[U]:ee||[]}))).catch(()=>a(ee=>({...ee,[U]:[]})))},Tn=U=>{if(t){const V=U.avatar||(y==null?void 0:y.avatar)||localStorage.getItem("user_avatar")||"👨",ee=U.name||(y==null?void 0:y.name)||localStorage.getItem("user_name")||"Guest",ae={...U,name:ee,avatar:V,id:t.id,position:{x:15,y:12},room:c};localStorage.setItem("user_avatar",V),i(ae),t.emit("join-office",ae)}},ct=U=>{if(t&&n){const V={...n,position:U};i(V),t.emit("user-move",{position:U,room:c})}},Ci=U=>{t&&m&&t.emit("send-direct-message",{toUserId:m,message:U})},Kv=U=>{if(l(U),n&&t){const V={x:15,y:12},ee={...n,position:V,room:U};i(ee),t.emit("user-move",{position:V,room:U})}};return localStorage.getItem("token")?u?T.jsxs("div",{className:"office-container",children:[T.jsxs("div",{ref:I,style:{position:"fixed",top:12,right:12,zIndex:12e3},children:[T.jsx("button",{className:"user-menu-button","aria-label":"User menu",onClick:()=>N(U=>!U),title:(y==null?void 0:y.name)||"Account",children:T.jsx("span",{style:{fontSize:18},children:(y==null?void 0:y.avatar)||localStorage.getItem("user_avatar")||"👤"})}),_&&T.jsxs("div",{className:"user-menu",children:[T.jsxs("div",{className:"user-menu-header",children:[T.jsx("div",{className:"user-menu-avatar",children:(y==null?void 0:y.avatar)||"👤"}),T.jsx("div",{className:"user-menu-name",children:(y==null?void 0:y.name)||"User"}),(y==null?void 0:y.email)&&T.jsx("div",{className:"user-menu-email",children:y.email})]}),T.jsxs("div",{className:"user-menu-actions",children:[T.jsx("button",{className:"user-menu-item",onClick:()=>N(!1),children:"Profile"}),T.jsx("button",{className:"user-menu-item danger",onClick:()=>{try{t==null||t.disconnect()}catch{}localStorage.removeItem("token"),localStorage.removeItem("user_name"),localStorage.removeItem("user_avatar"),window.location.reload()},children:"Logout"})]})]})]}),T.jsxs(iw,{currentRoom:c,children:[n&&T.jsx(Of,{user:n,onMove:ct,isCurrentUser:!0,showRadius:!0,radiusTiles:nn}),r.filter(U=>U.room===c).map(U=>T.jsx(Of,{user:U,onMove:()=>{},isCurrentUser:!1},U.id))]}),T.jsx(rw,{onJoinOffice:Tn,onRoomChange:Kv,currentRoom:c,user:n,account:y,collapsed:!h,onToggle:()=>g(U=>!U)}),T.jsx(ow,{currentRoom:c,userCount:r.length+(n?1:0),isConnected:u}),n&&b&&T.jsx(sw,{messages:o[m]||[],onSendMessage:Ci,currentUser:n,account:y,users:E.filter(U=>U.id!==(y==null?void 0:y.id)),dmThreads:o,unreadByUserId:v,dmPeerId:m,onSelectPeer:U=>{f(U),yt(U),C(V=>({...V,[U]:0}))},onClose:()=>P(!1)}),n&&T.jsx("div",{style:{position:"fixed",bottom:20,left:20,display:"flex",gap:8,zIndex:11e3},children:T.jsx("button",{"aria-label":"Toggle screen share",onClick:Vt,disabled:!$e,style:{padding:"10px 14px",borderRadius:10,border:"none",background:$e?"#64FFDA":"#3a3a3a",color:"#111",cursor:$e?"pointer":"not-allowed",boxShadow:"0 10px 28px rgba(100,255,218,0.25)"},title:$e?"Start/Stop screen share with nearby user":"Move closer to a user to enable screen share",children:de?"Stop Share":"Share Screen"})}),j&&T.jsx("div",{ref:A,style:{position:"fixed",bottom:90,left:20,display:"flex",gap:10,padding:6,borderRadius:12,background:"rgba(17,17,17,0.55)",backdropFilter:"blur(6px)",zIndex:11e3,maxWidth:"80vw",overflowX:"auto"}}),n&&!b&&T.jsx("button",{"aria-label":"Open chat",onClick:()=>P(!0),style:{position:"fixed",bottom:20,right:20,width:56,height:56,borderRadius:"50%",border:"none",background:"#F59E0B",color:"#111111",fontSize:22,cursor:"pointer",zIndex:11e3,boxShadow:"0 10px 28px rgba(245,158,11,0.35)"},children:"💬"})]}):T.jsx("div",{className:"office-container",children:T.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[T.jsx("h1",{style:{color:"#64ffda",marginBottom:"20px"},children:"Virtual Office"}),T.jsx("p",{style:{color:"#b0b0b0"},children:"Connecting to server..."})]})}):T.jsx("div",{className:"office-container",children:T.jsx(nw,{onAuthSuccess:()=>d(!1)})})}pc.createRoot(document.getElementById("root")).render(T.jsx(cy.StrictMode,{children:T.jsx(aw,{})}));
